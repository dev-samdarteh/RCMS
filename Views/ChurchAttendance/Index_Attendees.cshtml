

@model RhemaCMS.Models.ViewModels.vm_cl.ChurchAttendanceModel
 

@{
    ViewData["Title"] = (!string.IsNullOrEmpty(ViewBag.AppName) ? ViewBag.AppName : "") + " - Church Attendance";
}

<body id="page-top" class="w-100">
    <input type="hidden" id="_promptUserMsg" data-value="@ViewBag.promptUserMsg" />

    <!-- Sidebar -->
    <div id="wrapper">
        <!-- Sidebar -->
        @*@{ await Html.RenderPartialAsync("_MemSideMenu");}*@

        <div class="container-fluid-zero-margin " style="">
            <!-- content -->
            <div class="panel panel-default">
                <div class="card mb-3 " style="background-color: transparent; width: 100%; ">
                    <div class="card-header bg-w " style="color: #2c2f5b ;">
                        <div>
                            <i class="fas fa-users fa-lg" style="color: grey"></i>&nbsp;&nbsp;
                            <span style=" font-size: x-large; text-transform:uppercase"> Church Attendance - </span>
                            <span style="font-size: x-large; font-variant-caps: titling-caps; color: #0094ff">
                                @Model.oChurchBody?.Name
                            </span>
                        </div>
                    </div>

                    <div class="card-header rounded-bottom border-0 bg-white" style="color: #000; margin-left:auto; margin: 1px ">
                        <div class="text-md ">
                            <br />
                            @{
                                if (!string.IsNullOrEmpty(Model.strCurrTaskDesc))
                                {
                                    if (Model.strAttnLongevity == "C")
                                    {
                                        <div class="panel-heading" style="border-bottom: 2px solid lightgray; font-size:large ; font-variant-caps: titling-caps; color: green">
                                            @Model.strCurrTaskDesc
                                        </div>
                                    }
                                    else if (Model.strAttnLongevity == "H")
                                    {
                                        <div class="panel-heading" style="border-bottom: 2px solid lightgray; font-size:large ; font-variant-caps: titling-caps; color: darkred">
                                            @Model.strCurrTaskDesc
                                        </div>
                                    }

                                }

                                @*if (Model.oChurchBody?.ChurchType == "CH") //  || Model.oChurchBody?.ChurchType == "CF")
                                    {
                                        <i class="fas fa-info-circle "></i>
                                        <span>
                                            Oversight Units : @Model.CurrSubChurchUnits.Count()
                                            &nbsp;&nbsp; | &nbsp;&nbsp;
                                        </span>
                                        <i class="fas fa-info-circle "></i>
                                        <span>
                                            Total Congregations : @Model.CHCF_TotCong
                                            &nbsp;&nbsp; | &nbsp;&nbsp;
                                        </span>
                                    }*@
                            }

                            @*<i class="fas fa-user-friends "></i>
                                Roll : @Model.CHCF_TotAttend_MemOrVis
                                &nbsp;&nbsp; | &nbsp;&nbsp;
                                <i class="fas fa-male fa-lg" style="color:deepskyblue"></i>
                                Males :  @Model.CHCF_TotAttend_M
                                &nbsp;&nbsp; | &nbsp;&nbsp;
                                <i class="fas fa-female fa-lg" style="color:deeppink"></i>
                                Females :  @Model.CHCF_TotAttend_F
                                &nbsp;&nbsp; | &nbsp;&nbsp;
                                <i class="fas fa-question-circle fa-lg" style="color: lightgray"></i>
                                Other :  @Model.CHCF_TotAttend_O*@

                            @*&nbsp;&nbsp; | &nbsp;&nbsp;
                                <i class="fas fa-plus fa-lg" style="color: lightgreen"></i>
                                New Visitors :  @Model.CHCF_TotAttend_M*@

                        </div>
                    </div>
                    <div class="card-body ">
                        <!-- Nav tabs -->
                        <div class="p-3">
                            <ul class="nav nav-tabs" role="tab" style="margin-left: 0px">
                                <li id="l1" class="nav-item active">
                                    <a class="nav-link active" href="#tab_attn_chkin" aria-controls="tab_attn_chkin" role="tab" data-toggle="tab">
                                        <h7 class="breadcrumb-item" >
                                            <i class="fas fa-user-check mr-2" style="color: forestgreen "></i> Congregants Check-in
                                        </h7>
                                    </a>
                                </li>
                                <li id="l2" class="nav-item ">
                                    <a class="nav-link " href="#tab_attn_head" aria-controls="tab_attn_head" role="tab" data-toggle="tab">
                                        <h7 class="breadcrumb-item" >
                                            <i class="fa fa-users text-black-50 mr-2" ></i> Congregants Headcount
                                        </h7>
                                    </a>
                                </li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content shadow-sm w-100">
                                <div role="tabpanel" class="tab-pane active " id="tab_attn_chkin">
                                    <div class="panel panel-default p-3" style="overflow:auto;  font-weight:normal">

                                        <div class="card-header rounded-bottom border-0 bg-secondary text-light mb-4" style=" margin-left:auto; margin: 1px ">
                                            @*@{
                                                    var _strA = "'" + Model.f_strAttendeeTypeCode + "'";
                                                    var _strL = "'" + Model.strAttnLongevity + "'";
                                                }
                                                <a class="dropdown-item-text" asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-strAttendee="M">
                                                    <i class="fas fa-user-check" style="width: 20px; color: #a7c265; "></i> Church Attendance
                                                </a>
                                                <a href="#" class="dropdown-item " onclick="AddEditCurr_Attendee(@Model.currAttendTask, @Model.oChurchBody.Id, @_strA, @_strL, 0, null, null, false, false)"
                                                   data-toggle="tooltip" data-placement="top" title="Record visitor (guest) attendance">
                                                    <i class="fas fa-user-clock " style=" color: deepskyblue; "></i>  &nbsp; Check-in visitors or edit
                                                </a>
                                                &nbsp;&nbsp; |*@

                                            @{
                                                if (Model.oChurchBody?.OrgType == "CH") //  || Model.oChurchBody?.ChurchType == "CF")
                                                {
                                                    <i class="fas fa-info-circle "></i>
                                                    <span>
                                                        Oversight Units : @Model.lsCurrSubChurchUnits.Count()
                                                        &nbsp;&nbsp; | &nbsp;&nbsp;
                                                    </span>
                                                    <i class="fas fa-info-circle "></i>
                                                    <span>
                                                        Total Congregations : @Model.CHCF_TotCong
                                                        &nbsp;&nbsp; | &nbsp;&nbsp;
                                                    </span>
                                                }
                                            }

                                            <i class="fas fa-user-friends"></i>
                                            Roll : @Model.CHCF_TotAttend_MemOrVis
                                            &nbsp;&nbsp; | &nbsp;&nbsp;
                                            <i class="fas fa-male fa-lg" style="color:deepskyblue"></i>
                                            Males :  @Model.CHCF_TotAttend_M
                                            &nbsp;&nbsp; | &nbsp;&nbsp;
                                            <i class="fas fa-female fa-lg" style="color:deeppink"></i>
                                            Females :  @Model.CHCF_TotAttend_F
                                            &nbsp;&nbsp; | &nbsp;&nbsp;
                                            <i class="fas fa-question-circle fa-lg" style="color: lightgray"></i>
                                            Other :  @Model.CHCF_TotAttend_O

                                            @*&nbsp;&nbsp; | &nbsp;&nbsp;
                                                <i class="fas fa-plus fa-lg" style="color: lightgreen"></i>
                                                New Visitors :  @Model.CHCF_TotAttend_M*@

                                        </div>

                                        @if (Model.oChurchBody?.OrgType == "CN")
                                        {
                                            switch (Model.currAttendTask)
                                            {
                                                // Detailed_Attendance : any -- M, V or both
                                                case 1:
                                                case 2:  // Detailed_Attendance_Edit : only M,  V uses modal form
                                                    {
                                                        //EDIT MODE --- Members Only, Visitors use the pop up modal
                                                        @if (Model.currAttendTask == 2)
                                                        {
                                                            using (Html.BeginForm("Index_Attendees", "ChurchAttendance", FormMethod.Post, new { @id = "currForm_Attendee_FD" }))
                                                            {
                                                                var strA = "'" + Model.f_strAttendeeTypeCode + "'";
                                                                var strL = "'" + Model.strAttnLongevity + "'";
                                                                //var evId = Model.f_ChurchEventId != null ? Model.f_ChurchEventId : -1;
                                                                //var dtAttn = "'" + (Model.f_DateAttended != null ? (Model.f_DateAttended.Value.Year + "-" + Model.f_DateAttended.Value.Month + "-" + Model.f_DateAttended.Value.Day) : "-1" ) + "'";

                                                                <div class="p-3 rounded justify-content-center" style="background-color:gainsboro">
                                                                    <input type="hidden" asp-for="oChurchBodyId" id="_hdnChuBodyId" />
                                                                    <input type="hidden" asp-for="strAttnLongevity" id="_strAttnLongevity" />
                                                                    <input type="hidden" asp-for="f_strAttendeeTypeCode" id="_strAttendeeTypeCode" />
                                                                    <div class="form-row col-sm  pr-0 p-1 ">
                                                                        <div class="form-group col-sm-2">
                                                                            <label class="control-label" asp-for="f_DateAttended">Date Attended</label>
                                                                            <input id="_m_DateAttended" asp-for="f_DateAttended" class="form-control" onchange="popChurchEvents(this.value);" />
                                                                            <span asp-validation-for="f_DateAttended" class="text-danger"></span>
                                                                        </div>
                                                                        <div class="form-group col-sm-6">
                                                                            <label class="control-label" asp-for="f_ChurchEventDetailId">Church Event</label>
                                                                            <select id="_m_ChurchEventDetailId" asp-for="f_ChurchEventDetailId" class="form-control" asp-items="@Model.lkpChuCalEvents " onchange="AddEditCurr_Attendee(@Model.currAttendTask, @Model.oChurchBody.Id, @strA, @strL, 0, null, null, false, false )"></select> @*name="f_ChurchEventId" *@
                                                                            <span asp-validation-for="f_ChurchEventDetailId" class="text-danger"></span>
                                                                        </div>
                                                                        <div class="form-group ">
                                                                            <div class="form-row col-sm ">
                                                                                <div class="form-group col">
                                                                                    <label class="control-label">&nbsp;</label>
                                                                                    Church Event
                                                                                    <a href="#" class="btn btn-light btn-sm"
                                                                                        @*var AddEditCurr_Attendee = function (currTask, currChuBodyId, _strAttendee, _strLongevity, currId, evtId, evtDate, dbReload = false, isViewOnly = false) *@
                                                                                       onclick="AddEditCurr_Attendee(2, @Model.oChurchBody.Id, @strA, @strL, -1, null, null, false, false )"

                                                                                       @*asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-reqChurchBodyId="@Model.oChurchBodyId" asp-route-strLongevity="@Model.strAttnLongevity" asp-route-currAttendTask="2"*@
                                                                                       data-toggle="tooltip" data-placement="top" title="Record member attendance">
                                                                                        <i class="fas fa-refresh " style=" color: deepskyblue; "></i>
                                                                                    </a>
                                                                                </div>
                                                                                <div class="form-group col">
                                                                                    <label class="control-label">&nbsp;</label>
                                                                                    @*<input id="btnSaveChanges" type="submit" value="Save" class="btn btn-info btn-sm" />*@
                                                                                    <button id="btnSaveChanges_FD" type="button" class="btn btn-info btn-sm save-data" style="width:100px"><i class="fa fa-database"></i> &nbsp; Save </button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <hr class="cus-div" style="width:100%; border: 1px inset white;" />

                                                                    @*@if (!string.IsNullOrEmpty(ViewBag.promptUserMsg))
                                                                                {
                                                                                    if (((string)ViewBag.promptUserMsg).ToLower().Contains("success"))
                                                                                    {<p class="bg-light text-success   "> <i class="fa fa-check fa-lg"></i> &nbsp; @ViewBag.promptUserMsg</p> }
                                                                                else
                                                                                { <p class="bg-light text-danger "> <i class="fa fa-times  fa-lg"></i> &nbsp; @ViewBag.promptUserMsg</p>}
                                                                        }
                                                                    *@


                                                                    @*<table id="tblAttendees_MemEdit" class="table table-sm  table-bordered table-striped table-responsive-sm table-hover bg-white  pl-0 " cellspacing="0" style="border: 1px solid #2c2f5b">*@
                                                                    <table id="tblAttendees_MemEdit" class="table table-sm table-light table-bordered table-striped table-responsive-sm table-hover " cellspacing="0" style="border: 1px solid #2c2f5b">
                                                                        <thead>
                                                                            <tr style="text-align: left;">
                                                                                <th width="0" hidden></th>
                                                                                <th width="0" hidden></th>
                                                                                <th width="0" hidden></th>
                                                                                <th style=" vertical-align: middle">
                                                                                    &nbsp; Member Name
                                                                                </th>
                                                                                <th width="30px" align="center" style="vertical-align: middle">
                                                                                    GDR
                                                                                </th>
                                                                                <th style="vertical-align: middle">
                                                                                    Age Group
                                                                                </th>
                                                                                <th style="vertical-align: middle">
                                                                                    Location
                                                                                </th>
                                                                                <th style="text-align: center; vertical-align: middle">
                                                                                    Phone
                                                                                </th>
                                                                                <th align="center" style="text-align: center;  vertical-align: middle; background-color: #d4d3c0">
                                                                                    Temp (°C)
                                                                                </th>
                                                                                <th class="justify-content-center" align="center" style=" width: auto; vertical-align: middle; background-color: #d4d3c0">
                                                                                    <i class="fas fa-check fa-lg" style="color:#2c2f5b" data-toggle="tooltip" data-placement="bottom" title="Check-in member"></i>&nbsp;Check-in
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody id="tblAttendees_MemEditBody">
                                                                            @for (int i = 0; i < Model.lsChurchAttendanceModels_MultiEdit.Count; i++)
                                                                            {
                                                                                <tr style="text-align:left">
                                                                                    <td class="row-hide" width="0" hidden>@Html.HiddenFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].oAttend_Id)</td>
                                                                                    <td class="row-hide" width="0" hidden>@Html.HiddenFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].oChurchBodyId)</td>
                                                                                    <td class="row-hide" width="0" hidden>@Html.HiddenFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].oChurchMemberId)</td>

                                                                                    <td class="row-hide" style="vertical-align: middle">
                                                                                        &nbsp; <i class="fas fa-user" style="color:deepskyblue"></i> &nbsp;
                                                                                        <a asp-controller="ChurchMembers" asp-action="AddOrEdit" asp-route-id="@Model.lsChurchAttendanceModels_MultiEdit[i].oChurchMemberId" asp-route-reqChurchBodyId="@Model.lsChurchAttendanceModels_MultiEdit[i].oChurchBodyId">
                                                                                            @Html.DisplayFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].strAttendeeName)
                                                                                        </a>
                                                                                    </td>
                                                                                    <td class="row-hide" align="center" style="vertical-align: middle">@Html.DisplayFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].strGender)</td>
                                                                                    <td style="vertical-align: middle">
                                                                                        @Html.DisplayFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].strAgeGroup)
                                                                                    </td>
                                                                                    <td class="row-hide" style="vertical-align: middle">
                                                                                        @{
                                                                                            var strLocDesc = Model.lsChurchAttendanceModels_MultiEdit[i].strResidenceLoc;
                                                                                            if (!string.IsNullOrEmpty(Model.lsChurchAttendanceModels_MultiEdit[i].strResidenceLoc) && !string.IsNullOrEmpty(Model.lsChurchAttendanceModels_MultiEdit[i].strNationality))
                                                                                            { strLocDesc += ", "; }
                                                                                            strLocDesc += Model.lsChurchAttendanceModels_MultiEdit[i].strNationality;
                                                                                        }
                                                                                        @Html.DisplayFor(modelItem => strLocDesc)
                                                                                    </td>
                                                                                    <td class="row-hide" align="center" style="vertical-align: middle">
                                                                                        @Html.DisplayFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].strPhone)
                                                                                    </td>
                                                                                    <td class="row-hide" align="center" style="vertical-align: middle; background-color: #d4d3c0">
                                                                                        @Html.TextBoxFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].decTempRec, new { @style = "width: 100px", @class = "form-control text-center" })
                                                                                    </td>
                                                                                    <td class="pr-3 row-hide" align="center" style="vertical-align: middle; background-color: #d4d3c0">
                                                                                        @Html.CheckBoxFor(modelItem => Model.lsChurchAttendanceModels_MultiEdit[i].f_ChkMemAttend)
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            }

                                                            //
                                                            @*<hr class="cus-div" style="width:100%; border: 2px inset white;" />*@
                                                        }

                                                        @*general*@
                                                        else if (Model.currAttendTask == 1)
                                                        {
                                                            @*<table id="tblAttendees" class="table table-sm  table-bordered table-striped table-responsive-sm table-hover bg-white  pl-0 " cellspacing="0" style="border: 1px solid #2c2f5b">*@
                                                            <table id="tblAttendees" class="table table-sm table-light table-striped table-responsive-sm table-hover p-1" cellspacing="0" style="border: 1px solid #2c2f5b">
                                                                <thead>
                                                                    <tr style="text-align: left; ">
                                                                        <th style=" vertical-align: middle">

                                                                            @{ var strName = "Attendee"; if (Model.f_strAttendeeTypeCode == "C") { strName = "Member Name"; } else if (Model.f_strAttendeeTypeCode == "V") { strName = "Visitor Name"; } }
                                                                            <span>@strName  </span>
                                                                        </th>
                                                                        <th width="30px" align="center" style="vertical-align: middle">
                                                                            GDR
                                                                        </th>
                                                                        <th style="vertical-align: middle">
                                                                            Age Group
                                                                        </th>
                                                                        <th style="vertical-align: middle">
                                                                            Location
                                                                        </th>
                                                                        <th style="text-align: center; vertical-align: middle">
                                                                            Phone
                                                                        </th>
                                                                        <th style="vertical-align: middle">
                                                                            Church Event (Occasion)
                                                                        </th>
                                                                        <th align="right" class="pl-3" style="vertical-align: middle">
                                                                            Date Attended
                                                                        </th>
                                                                        @if (Model.f_strAttendeeTypeCode == null)
                                                                        {
                                                                            <th class="pl-3" style="vertical-align: middle">
                                                                                Status
                                                                            </th>
                                                                        }
                                                                        <th class="justify-content-end" align="right" style=" width: 140px; vertical-align: middle">
                                                                            @if (Model.oChurchBody.Id == Model.oLoggedChurchBody.Id)
                                                                            {
                                                                                var strA = "'" + Model.f_strAttendeeTypeCode + "'";
                                                                                var strL = "'" + Model.strAttnLongevity + "'";
                                                                                var strTypeDesc = Model.f_strAttendeeTypeCode == "V" ? "Check-in visitor or edit" : "Check-in members or edit";

                                                                                @*<a href="#" id="btnAddEdit" class="btn btn-warning btn-sm " data-backdrop="static" data-keyboard="false"
                                                                                       onclick="AddEditCurr_Attendee(@strA, @strL, 0, @Model.oChurchBody.Id, false, false )" style="font-size:small"
                                                                                       data-toggle="tooltip" data-placement="bottom" title="Add new church visitor">
                                                                                        <i class="fa fa-plus fa-sm smaller"></i>
                                                                                    </a>*@

                                                                                <div class="btn-group dropright">
                                                                                    <button type="button" class="btn btn-light dropdown-toggle btn-sm" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                                                                            data-placement="top" title="Record attendance">
                                                                                        <i class="fas fa-user-edit"></i>&nbsp;
                                                                                    </button>
                                                                                    <div class="dropdown-menu ">

                                                                                        @if (Model.f_strAttendeeTypeCode == null || Model.f_strAttendeeTypeCode == "C")
                                                                                        {
                                                                                            //var evId = Model.f_ChurchEventId != null ? Model.f_ChurchEventId : -1;
                                                                                            //var dtAttn = "'" + (Model.f_DateAttended != null ? (Model.f_DateAttended.Value.Year + "-" + Model.f_DateAttended.Value.Month + "-" + Model.f_DateAttended.Value.Day) :
                                                                                            //                    (DateTime.Now.Year + "-" + DateTime.Now.Month + "-" + DateTime.Now.Day)
                                                                                            //                    ) + "'";
                                                                                            <a href="#" class="dropdown-item " onclick="AddEditCurr_Attendee(2, @Model.oChurchBody.Id, @strA, @strL, 0, null, null, false, false )"
                                                                                               @*asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-reqChurchBodyId="@Model.oChurchBodyId" asp-route-strLongevity="@Model.strAttnLongevity" asp-route-currAttendTask="2"*@
                                                                                               data-toggle="tooltip" data-placement="top" title="Record member attendance">
                                                                                                <i class="fas fa-user-check" style=" color: darkseagreen; "></i>  &nbsp; @strTypeDesc
                                                                                            </a>

                                                                                            if (Model.f_strAttendeeTypeCode == null)
                                                                                            { <div class="dropdown-divider"></div>}
                                                                                        }

                                                                                        @if (Model.f_strAttendeeTypeCode == null || Model.f_strAttendeeTypeCode == "V")
                                                                                        {
                                                                                            <a href="#" class="dropdown-item " onclick="AddEditCurr_Attendee(@Model.currAttendTask, @Model.oChurchBody.Id, @strA, @strL, 0, null, null, false, false)"
                                                                                               data-toggle="tooltip" data-placement="top" title="Record visitor (guest) attendance">
                                                                                                <i class="fas fa-user-clock " style=" color: deepskyblue; "></i>  &nbsp; Check-in visitors or edit
                                                                                            </a>
                                                                                        }
                                                                                    </div>
                                                                                </div>
                                                                            }

                                                                            <a class="btn btn-light btn-sm " asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-reqChurchBodyId="@Model.oChurchBody.Id" asp-route-strAttendee="@Model.f_strAttendeeTypeCode" asp-route-currAttendTask="@Model.currAttendTask" data-backdrop="static" data-keyboard="false"
                                                                               data-toggle="tooltip" data-placement="bottom" title="Reload table data">
                                                                                <i class="fas fa-refresh" style="color:green "></i>
                                                                            </a>

                                                                            @{ var strHist = "H";}
                                                                            <a class="btn btn-light btn-sm " asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-reqChurchBodyId="@Model.oChurchBody.Id" asp-route-strAttendee="@Model.f_strAttendeeTypeCode" asp-route-strLongevity="@strHist" data-backdrop="static" data-keyboard="false"
                                                                               data-toggle="tooltip" data-placement="bottom" title="Visitors history">
                                                                                <i class="fas fa-history" style="color:#000 "></i>
                                                                            </a>
                                                                        </th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    @foreach (var item in Model.lsChurchAttendanceModels)
                                                                    {
                                                                        <tr style="text-align:left">
                                                                            @*<td class="row-hide" width="0" hidden>@Html.HiddenFor(modelItem => item.oAttend_Id)</td>*@

                                                                            <td style="vertical-align: middle">
                                                                                <div class="checkbox "></div>
                                                                                &nbsp;
                                                                                <i class="fas fa-user" style="color:deepskyblue"></i>
                                                                                &nbsp;
                                                                                @if (item.oChurchAttendee.AttendeeType == "C")
                                                                                {
                                                                                    <a asp-controller="ChurchMembers" asp-action="AddOrEdit" asp-route-id="@item.oChurchMemberId" asp-route-reqChurchBodyId="@item.oChurchBodyId">
                                                                                        @Html.DisplayFor(modelItem => item.strAttendeeName)
                                                                                    </a>
                                                                                }
                                                                                else
                                                                                { @Html.DisplayFor(modelItem => item.strAttendeeName)}
                                                                            </td>
                                                                            <td align="center" style="vertical-align: middle">
                                                                                @{ var strG = item.strGender; if (item.strGender.Length > 0) { strG = item.strGender.Substring(0, 1); }}
                                                                                @Html.DisplayFor(modelItem => strG)
                                                                            </td>
                                                                            <td style="vertical-align: middle">
                                                                                @Html.DisplayFor(modelItem => item.strAgeGroup)
                                                                            </td>
                                                                            <td style="vertical-align: middle">
                                                                                @{
                                                                                    var strLocDesc = item.strResidenceLoc;
                                                                                    if (!string.IsNullOrEmpty(item.strResidenceLoc) && !string.IsNullOrEmpty(item.strNationality))
                                                                                    { strLocDesc += ", "; }
                                                                                    strLocDesc += item.strNationality;
                                                                                }
                                                                                @Html.DisplayFor(modelItem => strLocDesc)
                                                                            </td>
                                                                            <td align="center" style="vertical-align: middle">
                                                                                @Html.DisplayFor(modelItem => item.strPhone)
                                                                            </td>
                                                                            <td class="pr-3" style="vertical-align: middle">
                                                                                @Html.DisplayFor(modelItem => item.strChurchEventDesc)
                                                                            </td>
                                                                            <td class="pr-3" align="right" style="vertical-align: middle">
                                                                                @Html.DisplayFor(modelItem => item.strDateAttended)
                                                                            </td>
                                                                            @if (Model.f_strAttendeeTypeCode == null)
                                                                            {
                                                                                <td class="pr-3" align="right" style="vertical-align: middle">
                                                                                    @Html.DisplayFor(modelItem => item.strAttendeeTypeDesc)
                                                                                </td>
                                                                            }

                                                                            <td class="p-1" style="vertical-align: middle; text-align:center ">
                                                                                @{
                                                                                    var strA = "'" + Model.f_strAttendeeTypeCode + "'";
                                                                                    var strL = "'" + Model.strAttnLongevity + "'";
                                                                                    var strDesc = '"' + item.strAttendeeName + '"';
                                                                                }
                                                                                <div class="btn-group ">
                                                                                    <button type="button" class="btn btn-outline-light btn-sm dropdown-toggle border-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                        <i class="fa fa-ellipsis-v text-gray text-lg"></i>
                                                                                    </button>
                                                                                    <div class="dropdown-menu p-1">
                                                                                        <ul class="m-0 p-0" style="list-style-type: none;">

                                                                                            @if (item.oChurchAttendee.AttendeeType == "C")
                                                                                            {
                                                                                                <li>
                                                                                                    <a role="button" id="btnAddEdit" data-remote="false" class="btn btn-light text-left w-100 border-0" data-backdrop="static"
                                                                                                       onclick="AddEditCurr_Attendee(2, @Model.oChurchBody.Id, @strA, @strL, @item.oAttend_Id, @item.f_ChurchEventDetailId, @item.f_DateAttended, true, true)">
                                                                                                        <span><i class="fa fa-eye" style="width:25px"></i></span><span class="text-md-left ml-1"> View </span>
                                                                                                    </a>
                                                                                                </li>
                                                                                            }

                                                                                            else if (item.oChurchAttendee.AttendeeType == "V")
                                                                                            {
                                                                                                @*<li>
                                                                                                    <a role="button" id="btnAddEdit" data-remote="false" class="btn btn-light text-left w-100 border-0" data-backdrop="static"
                                                                                                       onclick="SaveCurr_AddAttendeeAsNC(@Model.oChurchBodyId, @item.oChurchAttendee.Id)">
                                                                                                        <span><i class="fas fa-user-clock" style="width:25px"></i></span> <span class="text-sm-left ml-1"> Add as New Convert </span>
                                                                                                    </a>
                                                                                                </li>
                                                                                                <li> <div class="dropdown-divider mt-1"></div></li>*@
                                                                                                <li>
                                                                                                    <a role="button" id="btnAddEdit" data-remote="false" class="btn btn-light text-left w-100 border-0" data-backdrop="static"
                                                                                                        @*var AddEditCurr_Attendee = function (currTask, currChuBodyId, _strAttendee, _strLongevity, currId, evtId, evtDate, dbReload = false, isViewOnly = false) *@
                                                                                                       onclick="AddEditCurr_Attendee(@strA, @strL, @item.oChurchAttendee?.Id, @Model.oChurchBody.Id, @item.oAttend_Id, @item.f_ChurchEventDetailId, false, true )">
                                                                                                        <span><i class="fa fa-eye" style="width:25px"></i></span><span class="text-sm-left ml-1"> View </span>
                                                                                                    </a>
                                                                                                </li>
                                                                                            }

                                                                                            @if (item.oChurchBodyId == Model.oChurchBodyId_Logged)
                                                                                            {

                                                                                                if (item.oChurchAttendee.AttendeeType == "C")
                                                                                                {
                                                                                                    <li>
                                                                                                        <a role="button" id="btnAddEdit" data-remote="false" class="btn btn-light text-left w-100 border-0" data-backdrop="static"
                                                                                                            @*var AddEditCurr_Attendee = function (currTask, currChuBodyId, _strAttendee, _strLongevity, currId, evtId, evtDate, dbReload = false, isViewOnly = false) *@
                                                                                                           onclick="AddEditCurr_Attendee(2, @Model.oChurchBody.Id, @strA, @strL, @item.oAttend_Id, @item.f_ChurchEventDetailId, @item.f_DateAttended, true, false)">
                                                                                                            <span><i class="fa fa-edit" style="width:25px"></i></span><span class="text-sm-left ml-1"> Edit </span>
                                                                                                        </a>
                                                                                                    </li>
                                                                                                }

                                                                                                else if (item.oChurchAttendee.AttendeeType == "V")
                                                                                                {
                                                                                                    <li>
                                                                                                        <a role="button" id="btnAddEdit" data-remote="false" class="btn btn-light text-left w-100 border-0" data-backdrop="static"
                                                                                                            @*var AddEditCurr_Attendee = function (currTask, currChuBodyId, _strAttendee, _strLongevity, currId, evtId, evtDate, dbReload = false, isViewOnly = false) *@
                                                                                                           onclick="AddEditCurr_Attendee(@strA, @strL, @item.oChurchAttendee?.Id, @Model.oChurchBody.Id, @item.oAttend_Id, @item.f_ChurchEventDetailId, false, false )">
                                                                                                            <span><i class="fa fa-edit" style="width:25px"></i></span><span class="text-sm-left ml-1"> Open or Edit </span>
                                                                                                        </a>
                                                                                                    </li>
                                                                                                }


                                                                                                @if (item.isUserRoleAdmin_Logged ||
                                                                                         (item.oChurchBodyId == Model.oChurchBodyId_Logged && item.oChurchAttendee.CreatedByUserId == Model.oUserId_Logged))
                                                                                                {
                                                                                                    <li>
                                                                                                        <a role="button" class="btn btn-light text-danger text-left w-100 border-0"
                                                                                                           onclick="DeleteCurrDataCM_moMPC(@item.oChurchBodyId, @item.oChurchMemberId, false, '')">
                                                                                                            <span><i class="fa fa-trash" style="width:25px"></i></span><span class="text-sm-left ml-1" style="color:#000"> Delete </span>
                                                                                                        </a>
                                                                                                    </li>
                                                                                                }
                                                                                            }
                                                                                        </ul>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        }

                                                        break;
                                                    }


                                                case 3:  // Summ_Attendance : any -- M, V or both
                                                    {

                                                        break;
                                                    }
                                                case 4: // Summ_Attendance_Edit : only M,  V uses modal form
                                                    {

                                                        break;
                                                    }
                                                default:
                                                    {

                                                        break;
                                                    }

                                            }

                                        }

                                        else if (Model.oChurchBody?.OrgType == "CH")
                                        {
                                            <div class="panel panel-default" style=" background-color:white; overflow:auto; margin-top:10px ">
                                                <table id="tblCong" class="table table-sm table-bordered table-responsive-sm table-hover p-1" cellspacing="0" cellpadding="0"
                                                       style="border: 1px solid #2c2f5b; ">
                                                    @*  <table id="tblCong" class="table table-sm table-responsive-sm table-bordered table-hover nowrap w-100 bg-white" cellspacing="0" style=" ">*@
                                                    <thead>
                                                        <tr class="bg-secondary" style="text-align:center ; color: #ededed; ">
                                                            <th align="left" style="text-align:left; vertical-align: middle;  "> &nbsp; Name of Head Unit /Congregation </th>
                                                            <th style="vertical-align: middle"> Congregations (+) </th>
                                                            <th style="vertical-align: middle"> Members </th>
                                                            @*<th style="vertical-align: middle"> New Members* </th>*@
                                                            <th style="vertical-align: middle"> Leader </th>
                                                            <th align="center" width="50px" class="justify-content-center " style="vertical-align: middle">
                                                                <a class="btn btn-light btn-sm w-100" asp-controller="MemberPane" asp-action="Index" asp-route-reqChurchBodyId="@Model.oChurchBody.Id">
                                                                    <i class="fas fa-refresh" style="color:green "></i>
                                                                </a>
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var item in Model.lsCurrSubChurchUnits)
                                                        {
                                                            <tr style=" text-align:center ">
                                                                <td align="left" style="vertical-align: middle">
                                                                    <div class="checkbox "> </div>
                                                                    &nbsp;
                                                                    <i class="fas fa-church " style="color: #525252"></i> &nbsp;
                                                                    <a asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-reqChurchBodyId="@item.Id"
                                                                       asp-route-strAttendee="@Model.f_strAttendeeTypeCode" asp-route-strLongevity="@Model.strAttnLongevity">
                                                                        @item.Name
                                                                    </a>
                                                                </td>
                                                                <td style="vertical-align: middle">
                                                                    @Html.DisplayFor(modelItem => item.CH_TotSubUnits)
                                                                </td>
                                                                <td style="vertical-align: middle">
                                                                    @Html.DisplayFor(modelItem => item.CH_TotMem)
                                                                </td>
                                                                @*<td style="vertical-align: middle">
                                                                        @Html.DisplayFor(modelItem => item.CH_TotNewMem)
                                                                    </td>*@
                                                                @if (@item.oCH_InChargeMLR != null)
                                                                {
                                                                    <td style="vertical-align: middle">
                                                                        <a asp-controller="ChurchMembers" asp-action="AddOrEdit" asp-route-id="@item.oCH_InChargeMLR?.ChurchMemberId">
                                                                            @item.strCH_InCharge
                                                                        </a>
                                                                    </td>
                                                                }
                                                                else
                                                                {
                                                                    <td style="vertical-align: middle">
                                                                        @Html.DisplayFor(modelItem => item.strCH_InCharge)
                                                                    </td>
                                                                }

                                                                <td style="text-align: center; vertical-align: middle ">
                                                                    <a class="btn  btn-sm btn-outline-light" asp-controller="ChurchAttendance" asp-action="Index_Attendees" asp-route-reqChurchBodyId="@item.Id">
                                                                        <i class="fa fa-ellipsis-h fa-sm " style="color: #2c2f5b;"></i>
                                                                    </a>

                                                                    @*<a href="#" class="btn btn-sm btn-outline-danger" onclick="ConfirmDelete(@item.MemberId)"><i class="fa fa-trash-alt fa-sm smaller"></i></a>*@
                                                                </td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                                <input type="hidden" id="hdnCurrId" />
                                            </div>
                                        }

                                    </div>
                                </div>

                                <div role="tabpanel" class="tab-pane " id="tab_attn_head" style=" background-color: transparent">

                                </div>
                            </div>
                        </div>


                    </div>

                    @*<div class="card-footer small text-muted">Loaded on @DateTime.Now.ToLongDateString().ToString() at @DateTime.Now.ToShortTimeString().ToString()</div>*@

                </div>
            </div>
        </div>
        <!-- /.content-wrapper -->
    </div>

    <div style="text-align:center; display:none" id="divLoader">
        <img src="~/css/images/load.gif" width="100" />
    </div>

    <!-- /#wrapper -->
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>


    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Logout!</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body"> Logout to end your current session. Sure?</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" asp-area="" asp-controller="UserLogin" asp-action="LoginUserAcc">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal-->
    <div class="modal fade" id="divPopModal_AddEdit" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document"
             style="font-family:Verdana, Geneva, Tahoma, sans-serif;  width:auto ; height:auto; max-height: 75%;">
            <div class="modal-content">
                <div class="modal-header " style="color:#2c2f5b; background-color: lightgray  ">
                    @*style="background-color: lightgrey;*@
                    <h5 class="modal-title text-md"> Church Visitor Attendance   </h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>

                @*<div class="modal-header bg-light">
                        <div id="_sticky_fixed_nav" class="justify-content-center align-bottom pb-2 pt-2" style="margin-left:auto; margin-right: auto; width:100%">
                            <div class="btn-toolbar justify-content-center" role="toolbar" aria-label="Toolbar with button groups">
                                <div class="btn-group mr-2" role="group" aria-label="First group">
                                    <button id="_btnViewAll" type="button" class="btn btn-outline-dark border-secondary" data-toggle="tooltip" data-placement="bottom" title="View everything: all member data"
                                            style="width:50px; ">
                                        <i class="fas fa-ellipsis-h fa-sm"></i>
                                    </button>
                                    <button id="_btnReloadData" type="button" class="btn btn-outline-dark border-secondary" data-toggle="tooltip" data-placement="bottom" title="Reload member data" style="width:50px">
                                        <i class="fas fa-refresh fa-sm"></i>
                                    </button>
                                </div>
                                <div class="btn-group mr-2" role="group" aria-label="Second group">
                                    <button id="_btnPersData" type="button" class="btn btn-outline-info" data-toggle="tooltip" data-placement="bottom" title="Personal Data" style="width:50px">
                                        <i class="fas fa-user fa-lg"></i>
                                    </button>
                                    <button id="_btnLocAddr" type="button" class="btn btn-outline-info" data-toggle="tooltip" data-placement="bottom" title="Address and Location Details" style="width:50px">
                                        <i class="fas fa-phone fa-lg"></i>
                                    </button>
                                    <button id="_btnEducWork" type="button" class="btn btn-outline-info" data-toggle="tooltip" data-placement="bottom" title="Education and Working Life" style="width:50px">
                                        <i class="fas fa-user-graduate fa-lg"></i>
                                    </button>
                                    <button id="_btnConPers" type="button" class="btn btn-outline-info" data-toggle="tooltip" data-placement="bottom" title="Primary Contact Person" style="width:50px">
                                        <i class="fas fa-user-edit fa-lg"></i>
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>*@

                <div id="divModalBody_AddEdit" class="modal-body bg-light" style=" font-size: 10pt; ">

                </div>
                <div id="_divFooterCommit" class="modal-footer " style="background-color:   lightgrey; left:auto; right: auto">
                    <a href="#" class="btn btn-outline-light text-md" data-dismiss="modal"> Cancel </a>
                    <button id="btnSaveChanges_NC" type="button" class="btn btn-light save-data text-md"><i class="fas fa-user-clock text-primary "></i> Add to New Converts </button>
                    <button id="btnSaveChanges" type="button" class="btn btn-light save-data text-md"><i class="fas fa-check-double text-success "></i> Check-in Guest </button>
                </div>
            </div>
        </div>
    </div>



    <!-- Add/Edit Modal-->
    <div class="modal fade" id="divPopModal_AddEdit_norm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" style="background-color:transparent">
        <div class="modal-dialog modal-lg modal-dialog-scrollable  " role="document" style="width:auto ; height:auto">
            <div class="modal-content">
                <div class="modal-header" style="background-color:lightgray; color:white">
                    <h5 class="modal-title"> Member Family Relation</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body" id="divModalBody_AddEdit_norm">

                </div>

                @*<div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                        <a href="#" class="btn btn-success" onclick="AddEditUserProfile()"> Save </a>

                        @*<a class="btn btn-primary" asp-area="" asp-controller="UserLogin" asp-action="LoginUserAcc">Logout</a>
                    </div>*@
            </div>
        </div>
    </div>


    @*<partial name="_CookieConsentPartial" />*@
</body>


 
@*<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">*@

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

       


    <script type="text/javascript">
        $(function () {
            // This will make every element with the class "date-picker" into a DatePicker element
            $('.date-picker').datepicker();
        })
    </script>

    <script>

        $(document).ready(function () {
            window.onload = function () {
               // var _prompt = $("#_promptUser").data("value");
                var _promptMsg = $("#_promptUserMsg").data("value");
              //  alert('loaded _promptMsg: ' + _promptMsg);
                if (_promptMsg != "") {

                   // $("#_promptUser").data("value", false);
                    $("#_promptUserMsg").data("value", "");
                }
              // alert('loaded.');
            };

            //$('#tblAttendees').DataTable({
            //    'processing': true,
            ////    'destroy': true,
            ////    'paging': true,
            ////    'lengthChange': true,
            ////    'searching': true,
            ////    'ordering': true,
            ////    'info': true,
            ////    'autoWidth': true,
            //    "columnDefs": [
            ////        { "orderable": false, "targets": [0] },
            ////        { "orderable": true, "targets": [1] },
            ////        { "orderable": true, "targets": [2] },
            ////        { "orderable": true, "targets": [3] },
            //        { "orderable": false, "targets": [7] }
            //    ]
            //});


            $('#tblAttendees').DataTable({
                "processing": true,
                "columnDefs": [
                    { "searchable": false, "orderable": false, "targets": [7]},
                ],
            });

            $('#tblCong').DataTable({
                "processing": true,
                //columnDefs: [{
                //    orderable: false,
                //    targets: [1, 2, 3]
                //}],
            });

            $('#tblAttendees_MemEdit').DataTable({
                "processing": true,
                "columnDefs": [
                    { "searchable": false, "orderable": false, "targets": [9] },
                ],
            });

            //$(document).ready(function ()
            //{
            // // alert("hi mem");

            //    $('#tblMember').DataTable({
            //        "processing": true,
            //        "columnDefs": [
            //            {  "width": "5%",  "targets": [1] },
            //            {  "width": "7%", "searchable": false, "orderable": false, "targets": [9] },
            //        ],
            //    });
            //});



         $(document).on('change', '.custom-file-input', function (e) {
                                    e.preventDefault();

                                    // alert("in...");

                                    //  var fullFile = $(this).val();
                                    //   alert(fullFile);
                                    //  document.getElementById("imgFile").src = "~/content/img/df_user_p.png";


                                    var fileName = $(this).val().split("\\").pop();
               //alert(fileName);
            $(this).next('.custom-file-label').html(fileName);

                                    //$('.card-img-top').attr('src', fullFile);

                                });


        $(document).on('click', '#btnSaveCurr', function (e) {
                                    e.preventDefault();

                                    //  alert(this.val());
                                    var currId = $("#_hdnCurrId").val();
                // alert("#_hdnCurrId: " + currId);

                //var currFile = $("#_hdnCurrPhotoId").val();
                //alert("saving upd: " + currFile);

                $("#divLoader").show();

                                    //window.location.href = "/AppGlobalOwner/AddOrEdit";

                                    // var currFormData = $("#currForm").serialize(); // + "&churchLogoFile="+currFile;

                                    var formdata = new FormData($("#currForm").get(0));
               //  alert(formdata.keys().next());

                 $.ajax({
                                    //url: '@Url.Action("AddOrEdit", "MemberPane")',
                                    type: 'POST',
                         data: formdata,
                         processData: false,
                         contentType: false,

                    //type: "POST",
                    url: "/ChurchMembers/AddOrEdit",
                   // data: currFormData,
                    success: function (res) {
                        //alert("saved upd: " + res);

                        $("#divLoader").hide();
                                            //$("#divPopModal_AddEdit").modal("hide");
                                            //alert("saved upd: " + res);
                                            if (res == true) {
                                                alert("Saved changes of member successfully");

                                                //if (currId != 0) {
                                                //    window.location.href = "/MemberPane/AddOrEdit?id=" + currId;
                                                //}
                                                //else {
                                                //    window.location.href = "/MemberPane/Index";
                                                //}
                                            }
                                            else {
                                                alert("Saving of changes failed. Details: " + ViewBag.UserMsg);
                                            }
                                        }
                                    })

            })
        });



        //window.location.href = '/MemberPane/Index?reqChurchBodyId=' + currChuBodyId;
        var AddEditCurr_VisPersPro = function (currId) {
            window.location.href = "/ChurchMembers/AddOrEdit?id=" + currId

        }

        var AddEditCurr_VisChuLife  = function (currId) {
            window.location.href = "/ChurchMembers/AddOrEdit_Churchlife?id=" + currId
        }


        var popChurchEvents = function (dob) {
            if (dob != null) {
              //  alert('dob: ' + dob);
                var churchBodyId = $("#_hdnChuBodyId").val();
                var url = '@Url.Content("~/")' + 'ChurchAttendance/GetChurchEventsByAttendDate';
                $('#_m_ChurchEventDetailId').empty();
             //   $('#tblAttendees_MemEditBody').html('');
                //public JsonResult GetChurchEventsByAttendDate(int oCurrChuBodyId, string strDate, bool addEmpty = false)
                $.getJSON(url, { oCurrChuBodyId: churchBodyId, strDate: dob, addEmpty: true }, function (data) {
                    if (Object.keys(data).length > 0) {
                        var items = '';
                        $.each(data, function (i, oData) {
                            items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                        });
                        // items += "<option value=''> Select </option>";
                        $('#_m_ChurchEventDetailId').html(items);
                    }
                });


                //  var dt = dob.value;
                //alert("dob: " + dt);
                //  strAge = calcMemDateDiff(dt, new Date());
            }

            // alert('age: ' + strAge);
           // $("#_strMemberAge").val(strAge);
        }

        var popChurchEventsMod = function (dob) {
            if (dob != null) {
              //  alert('dob: ' + dob);
                var churchBodyId = $("#_hdnChuBodyId").val();
                var url = '@Url.Content("~/")' + 'ChurchAttendance/GetChurchEventsByAttendDate';
                $('#_ChurchEventDetailId').empty();
                $.getJSON(url, { oCurrChuBodyId: churchBodyId, strDate: dob, addEmpty: true }, function (data) {
                    if (Object.keys(data).length > 0) {
                        var items = '';
                        $.each(data, function (i, oData) {
                            items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                        });
                        // items += "<option value=''> Select </option>";
                        $('#_ChurchEventDetailId').html(items);
                    }
                });
            }
        }


        var AddEditCurr_Attendee = function (currTask, currChuBodyId, _strAttendee, _strLongevity, currId, evtId, evtDate, dbReload = false, isViewOnly = false) { //, _statusVis) {
           // alert("currId.. isViewOnly ... =  " + isViewOnly + ' .. ' + _strAttendee + ' .. ' + _strLongevity);// + ' evtId= ' + evtId + ' evtDate= ' + evtDate);
            //var sd = Model.f_DateAttended.Value.ToString();           f_ChurchEventId

            if (evtDate == null) { evtDate = $("#_m_DateAttended").val(); }
            if (evtId == null) { evtId = $("#_m_ChurchEventDetailId").val(); }

          //alert('...')
            //var date = evtDate.split("-");
            ////var newDt = new Date(date[0], date[1], date[2]);
            //var newDt = new Date(2020, 8, 5);

            //alert("currId.. newDt =  " + newDt);

           //public IActionResult AddOrEdit_Attendees(string strAttendee, string strLongevity = "C", int id = 0, int? oCurrChuBodyId = null, bool dbload = true)
            var url = '';
           // var _evtDate = evtDate != -1 ? evtDate : null;

            //if (_strAttendee == 'M') {
            //    // public IActionResult AddOrEdit_Attendees_MemEdit(int? reqChurchBodyId = null, string strLongevity = "C")
            //    url = "/ChurchAttendance/AddOrEdit_Attendees_MemEdit?reqChurchBodyId=" + currChuBodyId + "&strLongevity=" + _strLongevity;
            //}
            //else
            //{
            //    url = "/ChurchAttendance/AddOrEdit_Attendees?id=" + currId + "&oCurrChuBodyId=" + currChuBodyId + "&dbload=" + dbReload + "&strAttendee=" + _strAttendee; + "&strLongevity=" + _strLongevity;
            //}


            //   public IActionResult Index_Attendees(int currAttendTask = 1, int ? reqChurchBodyId = null, string strAttendee = "M", string strLongevity = "C", int ? id = null, int ? eventId = null, DateTime ? eventDate = null ) //, char? filterIndex = null, int? filterVal = null)
            if (_strAttendee == "C") {
                url = "/ChurchAttendance/Index_Attendees?currAttendTask=" + currTask + "&reqChurchBodyId=" + currChuBodyId + "&strAttendee=" + _strAttendee + "&strLongevity=" + _strLongevity +
                    "&id=" + currId + "&eventId=" + evtId + "&eventDate=" + evtDate;

                window.open(url, "_top");
            }

            // public IActionResult AddOrEdit_Attendees(string strAttendee="V", string strLongevity = "C", int id = 0, int? oCurrChuBodyId = null, bool dbload = true)  strAttendee=" + currTask  "&
            else if (_strAttendee == "V") {

                url = "/ChurchAttendance/AddOrEdit_Attendees?strAttendee=" + _strAttendee + "&strLongevity=" + _strLongevity + "&id=" + currId + "&oCurrChuBodyId=" + currChuBodyId + "&dbload=" + dbReload;



               // alert(url)
                if (isViewOnly == false) {
                    $('#divPopModal_AddEdit').modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                }

                $('#btnSaveChanges_NC').prop('hidden', _strAttendee != 'V'); // check if guest is not made NC or M already!

                $('#divPopModal_AddEdit .modal-dialog').draggable({
                    handle: ".modal-header"
                });

                //$(document).on('load', '#divModalBody_AddEdit', function (e) {
                //     alert("currId add_edit b : " + currId);
                //     $("#_hdnCurrId").val(currId);
                //     $("#divPopModal_AddEdit").modal('show');
                //})

                $("#divModalBody_AddEdit").load(url, function () {
                    //  alert("currId add_edit b : " + currId);
                    $("#_hdnCurrId").val(currId); 

                    //alert('currId: ' + currId);

                    $('#_divChuVisMoreDetails').prop('hidden', currId == 0);
                    $('#btnSaveChanges').prop('hidden', isViewOnly);

                    if (isViewOnly == true) {
                        disable_hideEditControls();
                    }
                    else {
                        $('#_divFooterCommit').prop('hidden', false);
                    }


                    //$('#btnSaveChanges_NC').prop('hidden', $("#_AttendeeType").val() != 'V'); 

                    $("#divPopModal_AddEdit").modal('show');
                });
            }
        };

        var disable_hideEditControls = function () {
            $('#_divFooterCommit').prop('hidden', true);

            $("#currForm_Attendee :input").prop("disabled", true);
        }




        $(document).on('click', '#btnSaveChanges', function (e) {
            e.preventDefault();

         // alert('save.. ? ');
            //alert($("#_setIndex").val());

          // var currVisitorId = $("#_hdnCurrId").val();
          //  var currChuBodyId = $("#_hdnChuBodyId").val();
           // var isNewConVis = $("#_hdnIsNewConVis").val();
          //  var _strLongevity = $("#_strAttnLongevity").val();
          //  var _strAttendee = $("#_strAttendeeTypeCode").val();

         //   alert('save.. cb: ' + currChuBodyId + '.. id: ' + currVisitorId + '.. isMigratedVis: ' + isMigratedVis);
            SaveCurr_Attendee(); //currVisitorId, currChuBodyId, _strAttendee, _strLongevity);
        })



        var SaveCurr_Attendee = function () {  // (_strAttendee, _strLongevity) {
          //  alert('saving... ' + currId + ' .. cb:' + currChuBodyId);
          //  var currId = $("#_currDivId").val();
            alert('saving... ');

          //  CommitChanges_MLS();

           var formdata = $("#currForm_Attendee").serialize();
            //var data = table.$('input, select').serialize();

          //  var formdata = new FormData($("#currForm_Attendee").get(0));


          //  alert('data : ' + formdata.substring(0, 10));  // + ' .. cb:' + currChuBodyId);

            $.ajax({
                // public async Task<IActionResult> Index_Attendees(ChurchAttendanceVM vmMod, IFormCollection f)
                type: 'POST',
                url: "/ChurchAttendance/AddOrEdit_Attendees",
                data: formdata,   //{ data: currFormData, taskIndx: oTask },  //
                 contentType: 'application/x-www-form-urlencoded; charset=UTF-8',  //
               // contentType: false,
                processData: false,
                success: function (res) {
                   //  alert(res.userMess );
                    if (res.taskSuccess == true) {
                        var currChuBodyId = $("#_hdnChuBodyId").val();
                        var _strLongevity = $("#_strAttnLongevity").val();
                        var _strAttendee = $("#_strAttendeeTypeCode").val();
                        //var currParDiv = $("#_parDivId").val();
                      //  alert('Successful');
                     //  alert('saved... msg: ' + res.userMess + ' id: ' + currId + ' .. cb:' + currChuBodyId);
                        //reset fields... was it update or new... reset only at new

                        // return Json(new { taskSuccess = true, userMess = ViewBag.UserMsg, currTask = vmMod.currAttendTask, oCurrId = -1, evtId = oEvId, evtDate = dtEv});
                        DisplaySuccessInfo(res.userMess, res.currTask, res.oCurrId, currChuBodyId, _strAttendee, _strLongevity, res.evtId, res.evtDate, false);

                        //if (currId > 0) {
                        //    DisplaySuccessInfo(res.userMess, currId, currChuBodyId, false);
                        //}
                        //else { DisplaySuccessInfo(res.userMess, currId, currChuBodyId, true); }
                    }
                    else {
                         alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                        $.alert({
                            title: 'Unsuccessful!',
                            content: res.userMess,
                            type: 'red',
                            typeAnimated: true,
                        });
                    }
                }
            })
        }



        $(document).on('click', '#btnSaveChanges_NC', function (e) {
            e.preventDefault();

            //  alert('saving... ' + currId + ' .. cb:' + currChuBodyId);
            //  var currId = $("#_currDivId").val();
            alert('saving... NC');

            //  CommitChanges_MLS();

            var formdata = $("#currForm_Attendee").serialize();

            //var data = table.$('input, select').serialize();
            //  var formdata = new FormData($("#currForm_Attendee").get(0));
            //  alert('data : ' + formdata.substring(0, 10));  // + ' .. cb:' + currChuBodyId);

            //url: "/ChurchAttendance/AddOrEdit_Attendees",

            $.ajax({
                // public async Task<IActionResult> Index_Attendees(ChurchAttendanceVM vmMod, IFormCollection f)
                type: 'POST',
                url: '@Url.Action("AddOrEdit_AttendeesNC", "ChurchAttendance")', 
                data: formdata,   //{ data: currFormData, taskIndx: oTask },  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',  //
                // contentType: false,
                processData: false,
                success: function (res) {
                    //  alert(res.userMess );
                    if (res.taskSuccess == true) {
                        var currChuBodyId = $("#_hdnChuBodyId").val();
                        var _strLongevity = $("#_strAttnLongevity").val();
                        var _strAttendee = $("#_strAttendeeTypeCode").val();
                        //var currParDiv = $("#_parDivId").val();
                        //  alert('Successful');
                        //  alert('saved... msg: ' + res.userMess + ' id: ' + currId + ' .. cb:' + currChuBodyId);
                        //reset fields... was it update or new... reset only at new

                        // return Json(new { taskSuccess = true, userMess = ViewBag.UserMsg, currTask = vmMod.currAttendTask, oCurrId = -1, evtId = oEvId, evtDate = dtEv});
                        DisplaySuccessInfo(res.userMess, res.currTask, res.oCurrId, currChuBodyId, _strAttendee, _strLongevity, res.evtId, res.evtDate, false);

                        //if (currId > 0) {
                        //    DisplaySuccessInfo(res.userMess, currId, currChuBodyId, false);
                        //}
                        //else { DisplaySuccessInfo(res.userMess, currId, currChuBodyId, true); }
                    }
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                        $.alert({
                            title: 'Unsuccessful!',
                            content: res.userMess,
                            type: 'red',
                            typeAnimated: true,
                        });
                    }
                }
            })
        })


        var SaveCurr_AddAttendeeAsNC_bck = function (_oCBid, _currAttendId) {  // (_strAttendee, _strLongevity) {
            //  alert('saving... ' + currId + ' .. cb:' + currChuBodyId);
            //  var currId = $("#_currDivId").val();

            alert('saving NC... ');

            //  CommitChanges_MLS();

            // var formdata = $("#currForm_Attendee").serialize();
            //var data = table.$('input, select').serialize();

            //  var formdata = new FormData($("#currForm_Attendee").get(0));


            //  alert('data : ' + formdata.substring(0, 10));  // + ' .. cb:' + currChuBodyId);

            //var formAction = $(this).attr("action");
            var fdata = new FormData();

            //var fileInput = $('#uploadfile')[0];
            //var file = fileInput.files[0];

            fdata.append("oCBid", _oCBid);
            fdata.append("oAttendid", _currAttendId);


            @*$.ajax({
                url: @Url.Action("AddOrEdit_AttendeesNC", "ChurchAttendance") + '?oCBid=' + _oCBid + '&oAttendid=' + _currAttendId ,
                type: 'POST',
                // ... other ajax options ...
            });*@

            //url: "/ChurchAttendance/AddOrEdit_AttendeesNC",


            alert('fdata: ');

            $.ajax({
                    url: '@Url.Action("AddOrEdit_AttendeesNC", "ChurchAttendance")' + '?oCBid=' + _oCBid + '&oAttendid=' + _currAttendId ,

                   // url: "/ChurchMembers/AddModCM_BD",
                    data: fdata,   //{ data: currFormData, taskIndx: oTask },  //
                    //contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    contentType: false,
                    processData: false,

                success: function (res) {
                    //  alert(res.userMess );
                    if (res.taskSuccess == true) {
                        //var currChuBodyId = $("#_hdnChuBodyId").val();
                        //var _strLongevity = $("#_strAttnLongevity").val();
                        //var _strAttendee = $("#_strAttendeeTypeCode").val();
                        //var currParDiv = $("#_parDivId").val();
                        //  alert('Successful');
                        //  alert('saved... msg: ' + res.userMess + ' id: ' + currId + ' .. cb:' + currChuBodyId);
                        //reset fields... was it update or new... reset only at new

                        // return Json(new { taskSuccess = true, userMess = ViewBag.UserMsg, currTask = vmMod.currAttendTask, oCurrId = -1, evtId = oEvId, evtDate = dtEv});
                        DisplaySuccessInfo(res.userMess, res.currTask, res.oCurrId, currChuBodyId, _strAttendee, _strLongevity, res.evtId, res.evtDate, false);

                        //if (currId > 0) {
                        //    DisplaySuccessInfo(res.userMess, currId, currChuBodyId, false);
                        //}
                        //else { DisplaySuccessInfo(res.userMess, currId, currChuBodyId, true); }
                    }
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                        $.alert({
                            title: 'Unsuccessful!',
                            content: res.userMess,
                            type: 'red',
                            typeAnimated: true,
                        });
                    }
                }
            })
        }



        $(document).on('click', '#btnSaveChanges_FD', function (e) {
            e.preventDefault();

          //  alert('save.. FD? ');
            //alert($("#_setIndex").val());

            // var currVisitorId = $("#_hdnCurrId").val();
            //  var currChuBodyId = $("#_hdnChuBodyId").val();
            // var isNewConVis = $("#_hdnIsNewConVis").val();
            //  var _strLongevity = $("#_strAttnLongevity").val();
            //  var _strAttendee = $("#_strAttendeeTypeCode").val();

            //   alert('save.. cb: ' + currChuBodyId + '.. id: ' + currVisitorId + '.. isMigratedVis: ' + isMigratedVis);
            SaveCurr_Attendee_FD(); //currVisitorId, currChuBodyId, _strAttendee, _strLongevity);
        })

        var SaveCurr_Attendee_FD = function () {  // (_strAttendee, _strLongevity) {
            //  alert('saving... ' + currId + ' .. cb:' + currChuBodyId);
            //  var currId = $("#_currDivId").val();
            //  alert('saving... ');

            //  CommitChanges_MLS();

            //var table = $('#tblAttendees_MemEdit').DataTable({
            //    columnDefs: [{
            //        orderable: false,
             //       targets: [1, 2, 3]
             //   }]
           // });

          //  var tbl = $('#tblAttendees_MemEdit').DataTable();
           // $('button').click(function () {
           // var data = tbl.$('input, select').serialize();
           //     alert(
            //        "The following data would have been submitted to the server: \n\n" +
             //       data.substr(0, 200) + '...'
             //   );
           // });


          //  var formdata = $("#currForm_Attendee").serialize();


            var tbl = $('#tblAttendees_MemEdit').DataTable();
            var tbl_data = tbl.$('input, select').serializeArray();
         //   alert("tab len: " + tbl_data.length);
            //$.each(tbl_data, function (i, tab_f) {
            //    alert('tab...');
            //    alert(tab_f.name + ' == ' + tab_f.value);
            //});


            //{ title = "_rowdata" }  $('input[name!=security]', this).serialize();

          var formdata = $("#currForm_Attendee_FD").serializeArray();
           // var formdata = $('#currForm_Attendee').find('input[title!=_rowdata]').serializeArray();
           // var formdata = $("#currForm_Attendee :not(.row-hide) > :input").serializeArray();
          //  var formdata = $("#currForm_Attendee :not(.row-hide)").serializeArray();
         //   var formdata = $("#currForm_Attendee").not(".row-hide").serializeArray();

         //   alert("len 1: " + formdata.length);
            //$.each(formdata, function (i, field) {
            //       alert(field.name + ' == ' + field.value);
            //})
          //  $.each(formdata, function (i, field) {
             //   alert(field.name + ' == ' + field.value);

                $.each(tbl_data, function (i, tab_f) {
                   // alert('tab...');
                   // alert(tab_f.name + ' == ' + tab_f.value);

                   // if (field.name == tab_f.name) {
                   // formdata.push({ name: tab_f.name, value: tab_f.value });

                   // formdata.append(tab_f.name, tab_f.value);

                    var attr_found = false;
                    $.each(formdata, function (i, field) {
                       //
                        if (field.name == tab_f.name) {
                           // alert(field.name + ' == ' + tab_f.name);
                            field.value = tab_f.value;
                            attr_found = true;

                            return false;
                        }
                    });

                   // alert('attr_found: ' + attr_found);
                    if (attr_found == false) {
                      //  alert('adding.. ' + tab_f.name)
                      //  formdata.append(tab_f.name, tab_f.value);

                        formdata.push({ name: tab_f.name, value: tab_f.value });
                    }


                       // field.value = tab_f.value;
                       // formdata[field.name] = tab_f.value;
                   // }
                });

               // alert('...' + field.name + ' == ' + field.value);

                //alert(formdata[field.name] + ' == ' + field.value);
          //  });

        //    alert("len 2: " + formdata.length);
            //$.each(formdata, function (i, field) {
            //    alert(field.name + ' == ' + field.value);
            //})
           // alert('done...'  );
           // alert('formdata: ' + formdata);

            //var data = table.$('input, select').serialize();

            //  var formdata = new FormData($("#currForm_Attendee").get(0));


            //  alert('data : ' + formdata.substring(0, 10));  // + ' .. cb:' + currChuBodyId);

            $.ajax({
                // public async Task<IActionResult> Index_Attendees(ChurchAttendanceVM vmMod, IFormCollection f)
                type: 'POST',
                url: "/ChurchAttendance/Index_Attendees",
                data:   formdata,   //{ data: currFormData, taskIndx: oTask },  //
                // contentType: 'application/x-www-form-urlencoded; charset=UTF-8',  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
               // contentType: false,
               // processData: false,
                success: function (res) {
                    //  alert(res.userMess );
                    if (res.taskSuccess == true) {
                        var currChuBodyId = $("#_hdnChuBodyId").val();
                        var _strLongevity = $("#_strAttnLongevity").val();
                        var _strAttendee = $("#_strAttendeeTypeCode").val();
                        //var currParDiv = $("#_parDivId").val();
                        //  alert('Successful');
                        //  alert('saved... msg: ' + res.userMess + ' id: ' + currId + ' .. cb:' + currChuBodyId);
                        //reset fields... was it update or new... reset only at new

                        // return Json(new { taskSuccess = true, userMess = ViewBag.UserMsg, currTask = vmMod.currAttendTask, oCurrId = -1, evtId = oEvId, evtDate = dtEv});
                        DisplaySuccessInfo(res.userMess, res.currTask, res.oCurrId, currChuBodyId, _strAttendee, _strLongevity, res.evtId, res.evtDate, false);

                        //if (currId > 0) {
                        //    DisplaySuccessInfo(res.userMess, currId, currChuBodyId, false);
                        //}
                        //else { DisplaySuccessInfo(res.userMess, currId, currChuBodyId, true); }
                    }
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                        $.alert({
                            title: 'Unsuccessful!',
                            content: res.userMess,
                            type: 'red',
                            typeAnimated: true,
                        });
                    }
                }
            })
        }




        var DisplaySuccessInfo = function (msg, currTask, currId, currChuBodyId, strAttendee, strLongevity, evId, evDate, reset = false) {
             // alert('reset: ' + reset);

            if (reset) {
                //   public IActionResult AddOrEdit_Attendees(string strAttendee, string strLongevity = "C", int id = 0, int? oCurrChuBodyId = null, bool dbload = true)
                AddEditCurr_Attendee(currTask, currChuBodyId, strAttendee, strLongevity, currId, evId, evDate, true, false);
            }
            //else {
            //    ReloadCurrPage_Attendee(currChuBodyId, strAttendee, strLongevity); //window.location.href = "/ChurchBodyConfig/Index?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;
            //}

            $.alert({
                title: 'Done!',
                type: 'green',
                typeAnimated: true,
                content: msg,
                closeIcon: true,
                closeIconClass: 'fa fa-close'
            });
        };

        //  public IActionResult Index_Attendees(string strAttendee, string strLongevity, int? reqChurchBodyId = null)
        var ReloadCurrPage_Attendee = function (currChuBodyId, _strAttendee, _strLongevity) { // (currSetIndex, parId = null) {         //, chuCategId = null, showAllCong = true) {
           // alert('load..');
            window.location.href = '/ChurchAttendance/Index_Attendees?reqChurchBodyId=' + currChuBodyId + '&strAttendee=' + _strAttendee + '&strLongevity=' + _strLongevity;

        }



        $(document).on('click', '#btnSaveChangesFD_HC', function (e) {
            e.preventDefault();

            alert('save.. FD? ');
            //alert($("#_setIndex").val());

            // var currVisitorId = $("#_hdnCurrId").val();
            //  var currChuBodyId = $("#_hdnChuBodyId").val();
            // var isNewConVis = $("#_hdnIsNewConVis").val();
            //  var _strLongevity = $("#_strAttnLongevity").val();
            //  var _strAttendee = $("#_strAttendeeTypeCode").val();

            //   alert('save.. cb: ' + currChuBodyId + '.. id: ' + currVisitorId + '.. isMigratedVis: ' + isMigratedVis);
            SaveCurr_AttendeeFD_HC(); //currVisitorId, currChuBodyId, _strAttendee, _strLongevity);
        })


        var SaveCurr_AttendeeFD_HC = function () {  // (_strAttendee, _strLongevity) {
            //  alert('saving... ' + currId + ' .. cb:' + currChuBodyId);

            // var formdata = $("#currForm_Attendee_HC").serialize();


            //var tbl = $('#tblAttendees_MemEdit').DataTable();
            //var tbl_data = tbl.$('input, select').serializeArray();
            ////   alert("tab len: " + tbl_data.length);
            ////$.each(tbl_data, function (i, tab_f) {
            ////    alert('tab...');
            ////    alert(tab_f.name + ' == ' + tab_f.value);
            ////});


            ////{ title = "_rowdata" }  $('input[name!=security]', this).serialize();

            //var formdata = $("#currForm_Attendee").serializeArray();
            //// var formdata = $('#currForm_Attendee').find('input[title!=_rowdata]').serializeArray();
            //// var formdata = $("#currForm_Attendee :not(.row-hide) > :input").serializeArray();
            ////  var formdata = $("#currForm_Attendee :not(.row-hide)").serializeArray();
            ////   var formdata = $("#currForm_Attendee").not(".row-hide").serializeArray();

            ////   alert("len 1: " + formdata.length);
            ////$.each(formdata, function (i, field) {
            ////       alert(field.name + ' == ' + field.value);
            ////})
            ////  $.each(formdata, function (i, field) {
            ////   alert(field.name + ' == ' + field.value);

            //$.each(tbl_data, function (i, tab_f) {
            //    // alert('tab...');
            //    // alert(tab_f.name + ' == ' + tab_f.value);

            //    // if (field.name == tab_f.name) {
            //    // formdata.push({ name: tab_f.name, value: tab_f.value });

            //    // formdata.append(tab_f.name, tab_f.value);


            //    var attr_found = false;
            //    $.each(formdata, function (i, field) {
            //        //
            //        if (field.name == tab_f.name) {
            //            // alert(field.name + ' == ' + tab_f.name);
            //            field.value = tab_f.value;
            //            attr_found = true;
            //            return false;
            //        }
            //    });

            //    // alert('attr_found: ' + attr_found);
            //    if (attr_found == false) {
            //        //  alert('adding.. ' + tab_f.name)
            //        //  formdata.append(tab_f.name, tab_f.value);
            //        formdata.push({ name: tab_f.name, value: tab_f.value });
            //    }


            //    // field.value = tab_f.value;
            //    // formdata[field.name] = tab_f.value;
            //    // }
            //});

            // alert('...' + field.name + ' == ' + field.value);

            //alert(formdata[field.name] + ' == ' + field.value);
            //  });

            //    alert("len 2: " + formdata.length);
            //$.each(formdata, function (i, field) {
            //    alert(field.name + ' == ' + field.value);
            //})
            // alert('done...'  );
            // alert('formdata: ' + formdata);

            //var data = table.$('input, select').serialize();



            var formdata = $("#currForm_Attendee_HC").serialize();
            // var formdata = new FormData($("#currForm_Attendee").get(0));


            //  alert('data : ' + formdata.substring(0, 10));  // + ' .. cb:' + currChuBodyId);

            $.ajax({
                // public async Task<IActionResult> Index_Attendees(ChurchAttendanceVM vmMod, IFormCollection f)
                type: 'POST',
                url: "/ChurchAttendance/Index_Headcount",
                data: formdata,   //{ data: currFormData, taskIndx: oTask },  //
                // contentType: 'application/x-www-form-urlencoded; charset=UTF-8',  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                // contentType: false,
                // processData: false,
                success: function (res) {
                    //  alert(res.userMess );
                    if (res.taskSuccess == true) {
                        var currChuBodyId = $("#_hdnChuBodyId_HC").val();
                        var _strLongevity = $("#_strAttnLongevity_HC").val();
                        //  var _strAttendee = $("#_strAttendeeTypeCode_HC").val();
                        //var currParDiv = $("#_parDivId").val();
                        //  alert('Successful');
                        //  alert('saved... msg: ' + res.userMess + ' id: ' + currId + ' .. cb:' + currChuBodyId);
                        //reset fields... was it update or new... reset only at new

                        // return Json(new { taskSuccess = true, userMess = ViewBag.UserMsg, currTask = vmMod.currAttendTask, oCurrId = -1, evtId = oEvId, evtDate = dtEv});
                        DisplaySuccessInfo_HC(res.userMess, res.currTask, res.oCurrId, currChuBodyId, _strLongevity, res.evtId, res.evtDate, false);

                        //if (currId > 0) {
                        //    DisplaySuccessInfo(res.userMess, currId, currChuBodyId, false);
                        //}
                        //else { DisplaySuccessInfo(res.userMess, currId, currChuBodyId, true); }
                    }
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                        $.alert({
                            title: 'Unsuccessful!',
                            content: res.userMess,
                            type: 'red',
                            typeAnimated: true,
                        });
                    }
                }
            })
        }


        var DisplaySuccessInfo_HC = function (msg, task, currId, currChuBodyId, strLongevity, evtId, attnDt, reset = false) {
            // alert('reset: ' + reset);
            $.alert({
                title: 'Done!',
                type: 'green',
                typeAnimated: true,
                content: msg,
                closeIcon: true,
                closeIconClass: 'fa fa-close'
            });

            if (reset) {
                //   public IActionResult AddOrEdit_Attendees(string strAttendee, string strLongevity = "C", int id = 0, int? oCurrChuBodyId = null, bool dbload = true)
                AddEditCurr_Attendee_HC(task, currChuBodyId, strLongevity, currId, evtId, attnDt, reset);
            }
            //else {
            //    ReloadCurrPage_Attendee(currChuBodyId, strAttendee, strLongevity); //window.location.href = "/ChurchBodyConfig/Index?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;
            //}


        };



    </script>


    <script>

    var hideAllDivs = function () {
      //  alert('hiding');
        jQuery('.cus-panel').hide();
        jQuery('.cus-div').hide();
        //jQuery("[aria-describedby='slick-slide01']")
    }

    var showAllDivs = function () {
       // alert('showing');
        jQuery('.cus-panel').show();
        jQuery('.cus-div').show();
        //jQuery("[aria-describedby='slick-slide01']")
    }

    $(document).on('click', '#_btnViewAll', function (e) {
        showAllDivs();

        //$('#_divPersData').prop('hidden', false);
        //$('#_divGenChurchLife').prop('hidden', false);
        //$('#_divMemLocAddr').prop('hidden', false);
        //$('#_divMemContact').prop('hidden', false);
    })
    $(document).on('click', '#_btnPersData', function (e) {
        hideAllDivs();
        jQuery('#_divPersData').show();
        jQuery('#_divPersData_2').show();
    })

        //
        $(document).on('click', '#_btnLocAddr', function (e) {
        hideAllDivs();
        jQuery('#_divLocAddr').show(); //$('#_divMemLocAddr').prop('hidden', false);
    })
        $(document).on('click', '#_btnEducWork', function (e) {
        hideAllDivs();
            jQuery('#_divEducWork').show(); //$('#_divMemLangSpkn').prop('hidden', false);
    })
        $(document).on('click', '#_btnConPers', function (e) {
        hideAllDivs();
            jQuery('#_divConPers').show(); //$('#_divMemEducHist').prop('hidden', false);
        })



                    //var AddEditCurrData_norm = function (currId) {
                    //  //  alert("currId add: " + currId);
                    //    var url = "/ChurchMembers/AddOrEdit_MemFamRel?id=" + currId;
                    //    //var url = "/MemberPane/AddOrEdit?id=" + currId;
                    //   // alert("clicked mem  pane: " + url);

                    //    $('#divPopModal_AddEdit_norm').modal({
                    //        backdrop: 'static',
                    //        keyboard: false
                    //    });

                    //    $("#divModalBody_AddEdit_norm").load(url, function () {
                    //    $("#divPopModal_AddEdit_norm").modal('show');
                    //    });
                    //    };

     $(document).on('change', '#_NationalityId', function (e) {
            e.preventDefault();

            var ctryId = $("#_NationalityId").val();
          //  alert('ctryId: ' + ctryId);

            var url = '@Url.Content("~/")' + 'ChurchMembers/GetCountryRegionsByCountry';
            $('#_HometownRegionId').empty();
            //GetCountryRegionsByCountry( int? ctryId, bool addEmpty = false)
             $.getJSON(url, { ctryId: ctryId, addEmpty: true}, function (data) {
                if (Object.keys(data).length > 0)
                {
                    var items = '';
                    $.each(data, function (i, ctryReg) {
                        items += "<option value='" + ctryReg.value + "'>" + ctryReg.text + "</option>";   // alert(items);
                    });
                   // items += "<option value=''> Select </option>";
                    $('#_HometownRegionId').html(items);
                }
            });

         //_MotherTongueId
         var url = '@Url.Content("~/")' + 'ChurchMembers/GetLanguagesByCountry';
         $('#_MotherTongueId').empty();
             $.getJSON(url, { ctryId: ctryId, addEmpty: true}, function (data) {
                if (Object.keys(data).length > 0)
                {
                    var items = '';
                    $.each(data, function (i, oVal) {
                        items += "<option value='" + oVal.value + "'>" + oVal.text + "</option>";   // alert(items);
                    });
                   // items += "<option value=''> Select </option>";
                    $('#_MotherTongueId').html(items);
                }
             });

     });

     $(document).on('change', '#_CountryId_LocAddr', function (e) {
            e.preventDefault();

            var ctryId = $("#_CountryId_LocAddr").val();
          //  alert('ctryId: ' + ctryId);

            var url = '@Url.Content("~/")' + 'ChurchMembers/GetCountryRegionsByCountry';
            $('#_RegionId_LocAddr').empty();
            //GetCountryRegionsByCountry( int? ctryId, bool addEmpty = false)
             $.getJSON(url, { ctryId: ctryId, addEmpty: true}, function (data) {
                if (Object.keys(data).length > 0)
                {
                    var items = '';
                    $.each(data, function (i, ctryReg) {
                        items += "<option value='" + ctryReg.value + "'>" + ctryReg.text + "</option>";   // alert(items);
                    });
                   // items += "<option value=''> Select </option>";
                    $('#_RegionId_LocAddr').html(items);
                }
            });


     });

     $(document).on('change', '#_CountryId_MemPrimCont', function (e) {
            e.preventDefault();

            var ctryId = $("#_CountryId_MemPrimCont").val();
          //  alert('ctryId: ' + ctryId);

            var url = '@Url.Content("~/")' + 'ChurchMembers/GetCountryRegionsByCountry';
            $('#_RegionId_MemPrimCont').empty();
            //GetCountryRegionsByCountry( int? ctryId, bool addEmpty = false)
             $.getJSON(url, { ctryId: ctryId, addEmpty: true}, function (data) {
                if (Object.keys(data).length > 0)
                {
                    var items = '';
                    $.each(data, function (i, ctryReg) {
                        items += "<option value='" + ctryReg.value + "'>" + ctryReg.text + "</option>";   // alert(items);
                    });
                   // items += "<option value=''> Select </option>";
                    $('#_RegionId_MemPrimCont').html(items);
                }
            });
        });

     $(document).on('change', '#_MaritalStatus', function (e) {
            e.preventDefault();

         var strVal = $("#_MaritalStatus").val();
         //alert('marr stat: ' + strVal);
         //  strVal = $("#_MaritalStatus").text(); //.val();
         //   alert('marr stat: ' + strVal);
            $('#_MarriageType').prop('disabled', idType != 'M');  //networked

         if (strVal != 'M') {
             $("#_MarriageType").val('');
             $("#_MarriageRegNo").val('');
         }
     });

    $(document).on('change', '#_MarriageType', function (e) {
            e.preventDefault();

         var strVal = $("#_MarriageType").val();
        // alert('marr stat: ' + strVal);
         //  strVal = $("#_MaritalStatus").text(); //.val();
         //   alert('marr stat: ' + strVal);
            $('#_MarriageRegNo').prop('disabled', idType != 'O');  //networked

         if (strVal != 'O') {
             $("#_MarriageRegNo").val('');
         }
    });

     $(document).on('change', '#_IDTypeId', function (e) {
            e.preventDefault();

         var idType = $("#_IDTypeId").val().trim();
          //  alert('idType: ' + idType);
            $('#_NationalIDNum').prop('disabled', idType == '');  //networked

         if (idType == '') {  $("#_NationalIDNum").val(''); }
     });

    //chk_Deceased
        $(document).on('change', '#chk_IsCurrentMem', function (e) {
            e.preventDefault();
            var _isAvail = $("#chk_IsCurrentMem").is(":checked");     // alert('chk: ' + _isAvail);
            $('#chk_IsDeceased').prop('disabled', _isAvail);
            $('#_divDepart').prop('hidden', _isAvail);

            if ($("#chk_IsDeceased").is(":disabled")) { $('#chk_IsDeceased').prop('checked', false) };
            if ($("#_divDepart").is(":hidden")) { $("#_Departed").val(''); $("#_DepartReason").val('') };
        })

        $(document).on('change', '#chk_IsCurrentStat', function (e) {
            e.preventDefault();
            var _isAvail = $("#chk_IsCurrentStat").is(":checked");
            $('#_divStatUntil').prop('hidden', _isAvail);

            if ($("#_divStatUntil").is(":hidden")) { $("#_StatUntil").val($("#_StatSince").val()); };
        })

        $(document).on('change', '#chk_IsCurrentRank', function (e) {
            e.preventDefault();
            var _isAvail = $("#chk_IsCurrentRank").is(":checked");
            $('#_divRankUntil').prop('hidden', _isAvail);

            if ($("#_divRankUntil").is(":hidden")) { $("#_RankUntil").val(''); };
        })

    $(document).on('change', '#chk_ResAddrSameAsPostAddr_LocAddr', function (e) {
            e.preventDefault();
            var _isAvail = $("#chk_ResAddrSameAsPostAddr_LocAddr").is(":checked");     // alert('chk: ' + _isAvail);
            $('#_PostalAddress_LocAddr').prop('disabled', _isAvail);

            if ($("#_PostalAddress_LocAddr").is(":disabled")) { $("#_PostalAddress_LocAddr").val(''); };
    })

     $(document).on('change', '#chk_IsMemCommunicant', function (e) {
            e.preventDefault();
            var _isAvail = $("#chk_IsMemCommunicant").is(":checked");     // alert('chk: ' + _isAvail);
            //$('#chk_IsDeceased').prop('disabled', _isAvail);
            $('#_divNonCommReason').prop('hidden', _isAvail);

             if ($("#_divNonCommReason").is(":hidden")) { $("#_NonCommReason").val('')};
        })

    //mem contact
        $(document).on('change', '#_ChurchFellow_MemCon', function (e) {
            e.preventDefault();

            var idType = $("#_ChurchFellow_MemCon").val().trim();
            //  alert('idType: ' + idType);
            $('#divInternalContactId_MemCon').prop('hidden', idType == '');  //networked

            if (idType == '') { $("#_InternalContactId_MemCon").val(''); }
        });


        var calcPersAge = function (dob) {
            var strAge = '';
            if (dob != null) {
                var dt = dob.value;
                 //alert("dob: " + dt);
                strAge = calcMemDateDiff(dt, new Date());
            }
          // alert('age: ' + strAge);
            $("#_strVisitorAge").val(strAge);
        }

        var calcPersLongevity = function (dt_enroll) {
            var strLong = '';
            if (dt_enroll != null) {
                var dt = dt_enroll.value;
               // alert("dt_enroll: " + dt);
                strLong = calcMemDateDiff(dt, new Date());
            }
             // alert('long: ' + strLong);
            $("#_strLongevity").val(strLong);
        }

        var calcMemDateDiff = function (dt1, dt2) {
           // var dt = dt1.value;
           // alert("dt: " + dt1);
            //var mdate = $("#birth_date").val().toString();
            var mdate = dt1.toString();
            var yearThen = parseInt(mdate.substring(0, 4), 10);
            var monthThen = parseInt(mdate.substring(5, 7), 10);
            var dayThen = parseInt(mdate.substring(8, 10), 10);

            //var dt2 = new Date();
            var birthday = new Date(yearThen, monthThen - 1, dayThen);

            var differenceInMilisecond = dt2.valueOf() - birthday.valueOf();

            var year_age = Math.floor(differenceInMilisecond / 31536000000);
            //  var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

            //if ((today.getMonth() == birthday.getMonth()) && (today.getDate() == birthday.getDate())) {
            //    alert("Happy B'day!!!");
            //}
            var strDiff = '';
            if (year_age >= 0) {
                //var month_age = Math.floor(day_age / 30);

                //day_age = day_age % 30;

                if (isNaN(year_age)) { // || isNaN(month_age) || isNaN(day_age)) {
                    strDiff = 'N/A';

                    // $("#_strMemberAge").text("Invalid birthday - Please try again!");
                }
                else {
                    strDiff = year_age + ' years';

                    //$("#exact_age").html("You are<br/><span id=\"age\">" + year_age + " years " + month_age + " months " + day_age + " days</span> old");
                }
            }

            return strDiff;

            // alert('age: ' + strAge);
            //$("#_strMemberAge").val(strAge);
        }


        $(document).on('click', '#btnReloadLangSpkn', function (e) {
            e.preventDefault();

            GetMemLangSpoken();
        });

        $(document).on('change', '#_LanguageSpokenId', function (e) {
            e.preventDefault();
            var strVal = $("#_LanguageSpokenId").val();

            $('#chk_PrimaryLanguage').prop('disabled', strVal == '');
            $('#_ProficiencyLevel').prop('disabled', strVal == '');

            if (strVal == '') {
                $('#chk_PrimaryLanguage').prop('checked', false)
            //    $("#_ProficiencyLevel").val('');
                $("#_ProficiencyLevel")[0].selectedIndex = 0;
            };
        })

        $(document).on('click', '#btnAddLangSpkn', function (e) {
            e.preventDefault();

            $('#_tblLangSpknTab').prop('hidden', false);
            var items = $('#_tblBodyAddLangSpkn').html().trim();
            //var lang_items = '';

            var langSel = $("#_LanguageSpokenId option:selected").val();
            var isChkVal = $("#chk_PrimaryLanguage").is(":checked");
            var _isChk = ''; if (isChkVal) _isChk = 'checked="true"';

          //  alert('langSel: ' + langSel);
            //alert( items);
           // alert(_isChk);
            if (langSel  != '' && !(items.includes('lang_' + langSel, 0))){ //&& items.includes($("#_LanguageSpokenId").text(), 0))) { && items.includes($("#chk_PrimaryLanguage").val(), 0))) {
                //lang_items += '<td id=lang_"' + $("#_LanguageSpokenId option:selected").val() + '">' + $("#_LanguageSpokenId option:selected").text() + '</td>';
                //
                if (!(items.includes('checked="true"', 0) && $("#chk_PrimaryLanguage").is(":checked"))) {
                    items += '<tr >';
                    items += '<td id="' + langSel + '" name="lang_' + langSel + '">' + $("#_LanguageSpokenId option:selected").text() + '</td>';
                    items += '<td id="' + $("#_ProficiencyLevel option:selected").val() + '">' + $("#_ProficiencyLevel option:selected").text() + '</td>';
                    items += '<td class="text-center"><input type="checkbox" id=chk_"' + langSel + '" disabled ' + _isChk + '/></td>';

                    items += '<td class="text-center"><a href="#" id="row_del_MLS" class="btn btn-link btn-sm"><i class="fa fa-close fa-sm" style="color: darkred" ></i></a></td> ';
                    items += '</tr>';

                    $('#_tblBodyAddLangSpkn').html(items);
                    //reset
                    $("#_LanguageSpokenId")[0].selectedIndex = 0; $("#_ProficiencyLevel")[0].selectedIndex = 0; $('#chk_PrimaryLanguage').prop('checked', false);
                }
                else {
                    $.alert({
                        title: 'Sorry!',
                        content: 'Member can have only one primary language',
                        type: 'orange',
                        typeAnimated: true,
                    });
                }

                // alert(items); <input type='checkbox'id='"+item.Id+"' name='chooseRecipient' class='my_chkBox' /></td>

            }
            else {
                $.alert({
                    title: 'Sorry!',
                    content: 'Language already added',
                    type: 'orange',
                    typeAnimated: true,
                });
            }

        });

        $(document).on('click', '#row_del_MLS', function (e) {
        //$("#_tblLangSpknTab").on("click", "#row_del_MLS", function () {
           // alert('del...');
            $(this).closest("tr").remove();
        });




        //$(document).on('change', '#_FirstName', function (e) {
        //    e.preventDefault();

        var filterData = function () {

           // alert('search...')
            var churchBodyId = $("#_hdnChuBodyId").val();
            var strAttendee = $("#_strAttendeeTypeCode").val();
            var strLong = $("#_strAttnLongevity").val();

            var strFn = $("#_FirstName").val();
            var strMn = $("#_MiddleName").val();
            var strLn = $("#_LastName").val();
            var strLoc= $("#_ResidenceLoc").val();
            var strPho = $("#_MobilePhone1").val();

            //  alert($("#_FirstName").val());
            //  alert('ctryId: ' + ctryId);
            //public JsonResult GetAttendanceByFilters(int? oChurchBodyId, string strAttendee, string strLongevity, string strAttendName, string strAttendPho)

            var url = '@Url.Content("~/")' + 'ChurchAttendance/GetAttendanceListByAttendeeFilters';

            $.getJSON(url, { oChurchBodyId: churchBodyId, strAttendee: strAttendee, strLongevity: strLong, strFirstName: strFn, strMiddleName: strMn, strLastName: strLn, strAttendLoc: strLoc, strAttendPho: strPho }, function (data) {
                if (Object.keys(data).length > 0) {
                    // var items = '';
                    var roll = Object.keys(data).length;
                    $('#_lblSearchRoll').html(roll);

                    if (roll > 0) {

                        $('#_divSearchRoll').prop("hidden", false);
                        //$('#_divChuVisMoreDetails').prop("hidden", false);
                        $('#_lblDetailInfo').prop("hidden", true);

                        //public IActionResult AddOrEdit_AttendHistory(int ? oChurchBodyId, string strAttendee, string strLongevity, string strFirstName, string strMiddleName, string strLastName, string strAttendLoc, string strAttendPho)
                        ///
                        var url_2 = "@Url.Action("AddOrEdit_AttendHistory", "ChurchAttendance")?oChurchBodyId=" + churchBodyId + "&strAttendee=" + strAttendee + "&strLongevity=" + strLong +
                            "&strFirstName=" + strFn + "&strMiddleName=" + strMn + "&strLastName=" + strLn + "&strAttendLoc=" + strLoc + "&strAttendPho=" + strPho;
                        $('#divTabData_MCAH').load(url_2, function () {
                            if ($.fn.dataTable.isDataTable('#tabData_MCAH')) {
                                $('#tabData_MCAH').DataTable();
                            }
                            else {
                                $('#tabData_MCAH').DataTable({
                                    "responsive": true,
                                    "autoWidth": false,
                                    "paging": false,
                                    //"lengthChange": false,
                                    "searching": false,
                                    //  "orderable": true,
                                    //"info": true,
                                    "order": [],

                                    //"columnDefs": [{
                                    //    "targets": [0, 2],
                                    //    "orderable": false,
                                    //}]
                                });
                            }
                        });
                    }
                    else {

                        $('#_btnAddGuest').prop("hidden", false);    
                    }
                }
            });
             
        }

     //});


        $(document).on('click', '#_btnAddGuest', function (e) {
            e.preventDefault();

            $('#_divChuVisMoreDetails').prop("hidden", false); 
            $('#_divSearchRoll').prop("hidden", false);

        });


        var filterData_bck = function () {

           // alert('search...')
            var churchBodyId = $("#_hdnChuBodyId").val();
            var strAttendee = $("#_strAttendeeTypeCode").val();
            var strLong = $("#_strAttnLongevity").val();

            var strFn = $("#_FirstName").val();
            var strMn = $("#_MiddleName").val();
            var strLn = $("#_LastName").val();
            var strLoc= $("#_ResidenceLoc").val();
            var strPho = $("#_MobilePhone1").val();

            //  alert($("#_FirstName").val());
            //  alert('ctryId: ' + ctryId);
            //public JsonResult GetAttendanceByFilters(int? oChurchBodyId, string strAttendee, string strLongevity, string strAttendName, string strAttendPho)

            var url = '@Url.Content("~/")' + 'ChurchAttendance/GetAttendanceListByAttendeeFilters';

             
            //$('#_divSearchRoll').hide();
            //$('#tblAttendFilter_Body').empty();

            //public JsonResult GetAttendanceListByAttendeeFilters(int? oChurchBodyId, string strAttendee, string strLongevity, string strFirstName, string strLastName, string strAttendPho)
            $.getJSON(url, { oChurchBodyId: churchBodyId, strAttendee: strAttendee, strLongevity: strLong, strFirstName: strFn, strMiddleName: strMn, strLastName: strLn, strAttendLoc: strLoc, strAttendPho: strPho }, function (data) {
                if (Object.keys(data).length > 0) {
                    // var items = '';
                    var roll = Object.keys(data).length;

                    if (roll > 0) {
                        $('#_divSearchRoll').prop("hidden", false);

                        var strA = "V"; var strL = "C";
                      //  var strId = '';
                        var rows = ''; // $('#tblAttendFilter_Body').html().trim();

                        $('#tblAttendFilter_Body').empty();

                        $.each(data, function (i, sVal) {
                            // items += "<option value='" + ctryReg.value + "'>" + ctryReg.text + "</option>";   // alert(items);
                            rows += '<tr >';

                            //    var AddEditCurr_Attendee = function (currTask, currChuBodyId, _strAttendee, _strLongevity, currId, evtId, evtDate, dbReload = false, isViewOnly = false)
                            rows += '<td id="' + sVal.oAttend_Id + '" name="_' + sVal.oAttend_Id + '">' //+ sVal.strAttendeeName + '</td >'
                            '<a href = "#" class="text-body " id = "btnAddEdit_"' + sVal.oAttend_Id + ' class="btn  btn-sm btn-outline-light" data - backdrop="static" data - keyboard="false" data - toggle="tooltip" data - placement="top" title = "Edit attendance details" >' + sVal.strAttendeeName + '</a></td>'
                              //  'onclick="AddEditCurr_Attendee(' + 2 + ', ' + churchBodyId + ', ' + strA + ', ' + strL + ', ' + sVal.oAttend_Id + ', ' + null + ', ' + null + ', ' + false + ', ' + false + ')"> ' + sVal.strAttendeeName + '</a></td>'

                            rows += '<td id="' + sVal.oAttend_Id + '" name="_' + sVal.oAttend_Id + '">' + sVal.strChurchEventDesc + '</td>';
                            rows += '<td id="' + sVal.oAttend_Id + '" name="_' + sVal.oAttend_Id + '">' + sVal.strPhone + '</td>';
                            rows += '<td id="' + sVal.oAttend_Id + '" name="_' + sVal.oAttend_Id + '">' + sVal.strDateAttended + '</td>';

                            //public IActionResult AddFrom_AttendeesItem(int? oCurrChuBodyId, int currAttendId)
                            rows += '<td id="' + sVal.oAttend_Id + '" name="_' + sVal.oAttend_Id + '"><a href="#"  asp-controller="ChurchAttendance" asp-action="AddFrom_AttendeesItem" asp-route-oCurrChuBodyId="' + churchBodyId + '" asp-route-currAttendId="' + sVal.oAttend_Id + '"><i class="fa fa-plus fa-sm " style="color: #000; width:30px"></i></a></td>';

                            @*
                                <a class="btn  btn-sm btn-outline-light" asp-controller="ChurchAttendance" asp-action="AddOrEdit_AttendeesItem" asp-route-currAttendVm="@Model" asp-route-id="0">
                                    <i class="fa fa-plus fa-sm " style="color: #000;"></i>
                                </a>
                                <a class="btn  btn-sm btn-outline-light" asp-controller="ChurchAttendance" asp-action="AddOrEdit_AttendeesItem" asp-route-currAttendVm="@Model" asp-route-id="1">
                                </a>
                            *@

                            rows += '</tr>';

                           // $('#tblAttendFilter_Body').append(rows);
                            $('#tblAttendFilter_Body').html(rows);

                            $('#btnAddEdit_' + sVal.oAttend_Id).removeAttr('onclick');
                            $('#btnAddEdit_' + sVal.oAttend_Id).attr('onClick', 'AddEditCurr_Attendee(' + 2 + ', ' + churchBodyId + ', ' + strA + ', ' + strL + ', ' + sVal.oAttend_Id + ', ' + null + ', ' + null + ', ' + false + ', ' + false + ');');

                       //    alert('items: ' + items)
                        });

                        //$('#_divSearchRoll').show();
                       // $('#tblAttendFilter_Body').html(items);
                       // $('#_lblSearchRoll').html(roll);
                    }

                    else {
                        $('#_divSearchRoll').prop('hidden','hidden');
                        $('#_divSearchRoll').prop('hidden','hidden');
                    }


                  //  $('#tblAttendFilter_Body').html(rows);
                    $('#_lblSearchRoll').html(roll);



                    //var row = $("<tr></tr>");
                    //row.append($("<td></td>").text(keys[k]));
                    //if (keys[k] == 'url') {
                    //    row.append($("<td></td>").html('<a href="' + properties[keys[k]] + '">' + properties[keys[k]] + '</a>'));
                    //}
                    //else {
                    //    row.append($("<td></td>").text(properties[keys[k]]));
                    //}
                    //table.append(row);






                    //// items += "<option value=''> Select </option>";
                    // $('#_HometownRegionId').html(items);


                    //var lang_items = '';

                    //var langSel = $("#_LanguageSpokenId option:selected").val();
                    //var isChkVal = $("#chk_PrimaryLanguage").is(":checked");
                    //var _isChk = ''; if (isChkVal) _isChk = 'checked="true"';

                    ////  alert('langSel: ' + langSel);
                    ////alert( items);
                    //// alert(_isChk);
                    //if (!(items.includes('lang_' + langSel, 0))) {
                    //    if (!(items.includes('checked="true"', 0) && $("#chk_PrimaryLanguage").is(":checked"))) {
                    //        items += '<tr >';
                    //        items += '<td id="' + langSel + '" name="lang_' + langSel + '">' + $("#_LanguageSpokenId option:selected").text() + '</td>';
                    //        items += '<td id="' + $("#_ProficiencyLevel option:selected").val() + '">' + $("#_ProficiencyLevel option:selected").text() + '</td>';
                    //        items += '<td class="text-center"><input type="checkbox" id=chk_"' + langSel + '" disabled ' + _isChk + '/></td>';

                    //        items += '<td class="text-center"><a href="#" id="row_del_MLS" class="btn btn-link btn-sm"><i class="fa fa-close fa-sm" style="color: darkred" ></i></a></td> ';
                    //        items += '</tr>';

                    //        $('#_tblBodyAddLangSpkn').html(items);
                    //        //reset
                    //        $("#_LanguageSpokenId")[0].selectedIndex = 0; $("#_ProficiencyLevel")[0].selectedIndex = 0; $('#chk_PrimaryLanguage').prop('checked', false);
                    //    }
                    //    else {
                    //        $.alert({
                    //            title: 'Sorry!',
                    //            content: 'Member can have only one primary language',
                    //            type: 'orange',
                    //            typeAnimated: true,
                    //        });
                    //    }

                    //    // alert(items); <input type='checkbox'id='"+item.Id+"' name='chooseRecipient' class='my_chkBox' /></td>

                    //}



                }
            });
        }




        $(document).on('change', '#_FirstName', function (e) {
            e.preventDefault();
            filterData();
        });

        $(document).on('change', '#_MiddleName', function (e) {
            e.preventDefault();

            filterData();
        });

        $(document).on('change', '#_LastName', function (e) {
            e.preventDefault();

            filterData();
        });

        $(document).on('change', '#_ResidenceLoc', function (e) {
            e.preventDefault();

            filterData();
        });

        $(document).on('change', '#_MobilePhone1', function (e) {
            e.preventDefault();

            filterData();
        });







        $(document).on('change', '#_strFilter_AttendeePhone', function (e) {
            e.preventDefault();

            var churchBodyId = $("#_hdnChuBodyId").val();
            var strAttendee = $("#_strAttendeeTypeCode").val();
            var strLong = $("#_strAttnLongevity").val();
            var strName = $("#_strFilter_AttendeeName").val();
            var strPho = $("#_strFilter_AttendeePhone").val();

          //  alert('ctryId: ' + ctryId);
            //public JsonResult GetAttendanceByFilters(int? oChurchBodyId, string strAttendee, string strLongevity, string strAttendName, string strAttendPho)
            var url = '@Url.Content("~/")' + 'ChurchAttendance/GetAttendanceListByAttendeeFilters';
            $('#_HometownRegionId').empty();
            //GetCountryRegionsByCountry( int? ctryId, bool addEmpty = false)
            $.getJSON(url, { oChurchBodyId: churchBodyId, strAttendee: strAttendee, strLongevity: strLong, strAttendName: strName, strAttendPho: strPho}, function (data) {
                if (Object.keys(data).length > 0)
                {
                    var items = '';
                    $.each(data, function (i, ctryReg) {
                        items += "<option value='" + ctryReg.value + "'>" + ctryReg.text + "</option>";   // alert(items);
                    });
                   // items += "<option value=''> Select </option>";
                    $('#_HometownRegionId').html(items);
                }
            });

     });

        $(function () {
            $("#_FirstName").autocomplete({

                source: function (request, response) {
                    $.ajax({
                        url: "/ChurchAttendance/GetAttendListByFilters_AC/",
                        data: "{'strAttendName':'" + request + "'}",
                        datatype: "json",
                        type: "POST",
                        contentType: "application/json; charset-utf-8",
                        success: function (data) {
                            response($.map(data, function (item) {
                                return item;
                            }))},
                    });
                },
                minLenth:1
            });
        });


    </script>


}


