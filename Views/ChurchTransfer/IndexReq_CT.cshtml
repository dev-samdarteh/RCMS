
@model RhemaCMS.Models.ViewModels.vm_cl.ChurchTransferModel

@{
    ViewData["Title"] = (!string.IsNullOrEmpty(ViewBag.AppName) ? ViewBag.AppName : "") + " - Church Transfer";
}



@if (Model != null)
{
    <body id="page-top" class="hold-transition sidebar-mini-md sidebar-toggled layout-fixed w-100">
        <input type="hidden" id="_oSetIndex" data-value="@Model.setIndex" />

        <input type="hidden" id="_oChurchBodyId_Logged" data-value="@Model.oChurchBodyId_Logged" />
        <input type="hidden" id="_oAppGloOwnId_Logged" data-value="@Model.oAppGloOwnId_Logged" />
        <input type="hidden" id="_oUserId_Logged" data-value="@Model.oUserId_Logged" />

        @{
            var oCBid = Model.oChurchBodyId != null ? Model.oChurchBodyId : -1;
            var oCMid = Model.oChurchMemberId != null ? Model.oChurchMemberId : -1;
        }
        <div class="wrapper" id="divSetupMain">
            <div class="content-header border-bottom mb-0 pb-0 mb-5">
                <div class="row m-0">
                    <div class="col-sm">
                        @{ var _strHeader = Model.strTransferType + " - " + Model.strTransferDxn;}
                        <h4 class="text-primary" style="font-family:Verdana, Geneva, Tahoma, sans-serif; font-size: x-large; ">

                            Church Transfers
                            <span class="text-black-50 text-md"> @_strHeader </span>
                        </h4>
                    </div>

                    <div class="col-sm-3">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item active">
                                <a class="text-black-50" asp-controller="ChurchTransfer" asp-action="IndexReq_CT" asp-route-oCurrChuBodyId="@Model.oChurchBodyId">
                                    <i class="fas fa-refresh mr-1"></i>
                                </a>
                            </li>

                            @*<li class="breadcrumb-item active">
                                    <a asp-controller="Home" asp-action="Index_CA" class="nav-link bg-light">
                                        <i class="nav-icon fas fa-building text-teal"></i>
                                        <p>
                                            Profile
                                        </p>
                                    </a>
                                </li>*@

                        </ol>
                    </div>
                </div>
            </div>

            <section class="content">
                <div class="container-fluid-zero-margin mt-2">
                    @*@{ var strDescRaw = (Model.oMemberBioModel != null ? Model.oMemberBioModel.strMemDisplayName : "Member Profile");
                        var strDesc = '"' + strDescRaw + '"'; }*@

                    <div class="card border-0 shadow-none p-1 pl-3" style="font-family:Verdana, Geneva, Tahoma, sans-serif;">
                        <div class="row ">
                            <div class="col-md-3 p-1" style="max-width:300px; min-width: 100px">
                                @*<div class="card card-light border shadow-sm p-1">*@
                                @*style="background-color: gainsboro"*@
                                @*<div class="card-body box-profile">*@
                                <ul class="list-group list-group ">
                                    @* list-group-unbordered *@
                                    <li class="list-group-item pl-3">
                                        <a href="#" class="text-sm " onclick="ReloadCurrPageReq_CT(@oCBid, 0, 1, 'MT', false, false)">
                                            <i class="fas fa-location-arrow text-primary mr-1"></i> Transfer Requests
                                        </a>
                                    </li>
                                    <li class="list-group-item pl-3">
                                        <a href="#" class="text-sm " onclick="ReloadCurrPageReq_CT(@oCBid, 0, 2, 'MT', false, false)">
                                            <i class="fas fa-stamp text-success mr-1"></i> Transfer Approvals
                                        </a>
                                    </li>
                                    <li class="list-group-item pl-3">
                                        <a href="#" class="text-sm " onclick="ReloadCurrPageReq_CT(@oCBid, 0, 1, 'MT', true, false)">
                                            <i class="fas fa-history text-black-50 mr-1"></i> History (Archive)
                                        </a>
                                    </li>
                                </ul>
                                @*</div>*@
                                @*</div>*@
                            </div>

                            <div class="col-md-9 shadow-none p-0 border-top-0 border-bottom-0 border-right-0 border-left">
                                <div class="card-header card-light">
                                    <ul class="nav nav-pills justify-content-center mb-3 text-sm">
                                        <li class="nav-item">
                                            <a class="nav-link active" href="#item1" data-toggle="tab">
                                                <i class="fas fa-arrow-up fa-lg text-warning mr-2"></i>
                                                Outgoing Requests
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="#item2" data-toggle="tab">
                                                <i class="fas fa-arrow-down fa-lg text-lime mr-2"></i>
                                                Incoming Requests
                                            </a>
                                        </li>
                                        @*<li class="nav-item"><a class="nav-link" href="#item3" data-toggle="tab"> History </a></li>*@
                                    </ul>
                                </div>
                                <div class="card-body mt-1">
                                    <div class="tab-content">
                                        <div class="active tab-pane" id="item1">
                                            <div id="divListReq_CTOT" class="m-0 p-0">
                                                @{ var strDesc2 = "New Transfer Request"; strDesc2 = '"' + strDesc2 + '"'; }
                                                <div class="card-header border-bottom-0">
                                                    <button type="button" class="btn btn-default border-0 float-md-left mr-1" data-toggle="tooltip" data-placement="top" title="Modify"
                                                            onclick="AddEditCurrDataReq_CT(@oCBid, 2, 1, 'MT', @oCMid, 1, 0, @strDesc2)">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-default border-0 float-md-left mr-1" data-toggle="tooltip" data-placement="top" title="Refresh data"
                                                            onclick="ReloadCurrPageReq_CT(@oCBid, 2, 1, 'MT', false, true)">
                                                        <i class="fa fa-refresh fa-secondary"></i>
                                                    </button>
                                                </div>
                                                <div class="card-body mt-1 pt-0">
                                                    <div id="divTabDataReq_CTOT" class="overlay-wrapper pt-0">
                                                        <div class="se-pre-con"></div>

                                                        @{ await Html.RenderPartialAsync("_vwIndexReq_CTOT", Model); }
                                                    </div>
                                                </div>
                                            </div>

                                            <div id="divOpenReq_CTOT" class="m-0 p-0" hidden>
                                                <div class="card-header border-bottom-0">
                                                    <button type="button" class="btn btn-default border-0 float-md-left mr-1 border" data-toggle="tooltip" data-placement="top" title="Back to Request List"
                                                            onclick="ReloadCurrPageReq_CT(@oCBid, 2, 1, 'MT', false, true)">

                                                        <i class="fa fa-list fa-secondary"></i>
                                                    </button>
                                                    <button type="button" class="btn btn-default border-0 float-md-left mr-1 border" data-toggle="tooltip" data-placement="top" title="Refresh"
                                                            onclick="OpenCurrReq_MT(@oCBid, 2, 1, 'MT', @oCMid, 2, -1)">
                                                        <i class="fa fa-refresh fa-secondary"></i>
                                                    </button>
                                                </div>
                                                <div class="card-body border-0 shadow-none mt-1 p-0">
                                                    <div id="divDataOpenReq_CTOT" class="overlay-wrapper p-0">
                                                        <div class="se-pre-con"></div>

                                                        @{ await Html.RenderPartialAsync("_vwOpenReq_MT", Model); }
                                                    </div>
                                                </div>

                                                <div class="modal-footer card-white justify-content-center " style="background-color: transparent; border-top: 2px solid #b7b5b5">
                                                    <!-- 1 ... 5 -->
                                                    <div id="_divApplicantFxns">
                                                        <a role="button" class="btn btn-light border" data-dismiss="modal" data-toggle="tooltip" data-placement="top" title="Back to Request List"
                                                           onclick="ReloadCurrPageReq_CT(@oCBid, 2, 1, 'MT', false, true)">
                                                            <span class=" text-xs"> <i class="fa fa-list fa-secondary"></i> Back </span>
                                                        </a>
                                                        <a id="btnSaveChanges_CT" role="button" class="btn btn-light border">
                                                            <i class="fas fa-database text-black-50 mr-1"></i> <span class="text-xs"> Save changes </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_SendReq" role="button" class="btn btn-outline-warning btn-lg border shadow-sm float-none">
                                                            <span class="text-black-50 text-bold text-xs"> Send Request </span><i class="fas fa-arrow-right text-primary ml-1"></i>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_RecallReq" role="button" class="btn btn-outline-warning btn-lg border shadow-sm float-none">
                                                            <i class="fas fa-arrow-left text-info mr-1"></i> <span class="text-black-50 text-bold text-xs"> Recall Request </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_CancelReq" role="button" class="btn btn-outline-warning btn-lg border shadow-sm float-none">
                                                            <i class="fas fa-times text-black-50 mr-1"></i> <span class="text-black-50 text-bold text-xs"> Terminate Request </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_ResubmitReq" role="button" class="btn btn-outline-warning btn-lg border shadow-sm float-none">
                                                            <i class="fas fa-redo text-dark mr-1"></i> <span class="text-black-50 text-bold text-xs"> Resubmit Request </span>
                                                        </a>
                                                    </div>

                                                    <!-- 6 ... 12 -->
                                                    <div id="_divChWorkerFxns1">
                                                        <a id="btnSaveChanges_CT_AckReq" role="button" class="btn btn-warning btn-lg border shadow-sm float-none">
                                                            <span class="text-black-50 text-bold text-xs"> Acknowledge Request </span><i class="fas fa-check text-primary ml-1"></i>
                                                        </a>
                                                    </div>

                                                    <div id="_divApproverFxns">
                                                        <a id="btnSaveChanges_CT_ApproveReq" role="button" class="btn btn-success btn-lg border border-dark shadow-sm float-none">
                                                            <i class="fas fa-stamp text-light mr-1"></i> <span class="text-black-50 text-bold text-xs"> Approve Request </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_SuspendReq" role="button" class="btn btn-warning btn-lg border border-dark shadow-sm float-none">
                                                            <i class="fas fa-pause text-light mr-1"></i> <span class="text-black-50 text-bold text-xs"> Suspend Request </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_DeclineReq" role="button" class="btn btn-danger btn-lg border border-dark shadow-sm float-none">
                                                            <i class="fas fa-times text-light mr-1"></i> <span class="text-black-50 text-bold text-xs"> Decline Request </span>
                                                        </a>
                                                    </div>

                                                    <div id="_divChWorkerFxns2">
                                                        <a id="btnSaveChanges_CT_ForceCompReq" role="button" class="btn btn-outline-warning btn-lg border shadow-sm float-none" data-toggle="tooltip" data-placement="bottom" title="Waive">
                                                            <i class="fas fa-stamp text-warning mr-1"></i> <span class="text-black-50 text-bold text-xs"> Force Complete </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_CloseReq" role="button" class="btn btn-outline-light btn-lg border shadow-sm float-none">
                                                            <i class="fas fa-lock text-gray mr-1"></i> <span class="text-black-50 text-bold text-xs"> Close Request </span>
                                                        </a>

                                                        <a id="btnSaveChanges_CT_ReOpenReq" role="button" class="btn btn-outline-primary btn-lg border shadow-sm float-none">
                                                            <i class="fas fa-lock-open text-lightblue mr-1"></i> <span class="text-black-50 text-bold text-xs"> Re-open Request </span>
                                                        </a>

                                                        @*<a id="btnSaveChanges_CT_ArchReq" role="button" class="btn btn-light btn-lg border shadow-sm float-none" >
                                                                <i class="fas fa-archive text-gray-dark mr-1"></i> <span class="text-black-50 text-bold text-xs"> Archive Request </span>
                                                            </a>*@
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane" id="item2">
                                            <div class="card-header border-bottom-0">
                                                <button type="button" class="btn btn-default border-0 float-right mr-1"
                                                        onclick="ReloadCurrPageReq_CT(@Model.oChurchBodyId, 1, 1, 'MT', false)">
                                                    <i class="fa fa-refresh fa-secondary"></i>
                                                </button>
                                            </div>
                                            <div class="card-body mt-1 pt-0">
                                                <div id="divTabDataReq_CTIN" class="overlay-wrapper pt-0">
                                                    <div class="se-pre-con"></div>

                                                    @{ await Html.RenderPartialAsync("_vwIndexReq_CTIN", Model); }
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>




        <div class="modal fade" id="divPopModal_AddEdit" tabindex="-1" role="dialog" aria-labelledby="_modalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable " role="document">
                <div class="modal-content">
                    <div class="modal-header bg-pink text-bold">
                        <h5 class="modal-title"> Editing: </h5> @*@Model.strCurrTask style="color: hotpink"*@
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div id="divModalBody_AddEdit_lg" class="modal-body bg-light" style="font-family:Verdana, Geneva, Tahoma, sans-serif; font-size: 10pt">
                    </div>
                    <div class="modal-footer " style="background-color: gainsboro">
                        <div class="justify-content-center">
                            <a role="button" class="btn btn-outline-light " data-dismiss="modal">
                                <span class="text-sm "> Terminate </span>
                            </a>

                            <a id="btnSaveChanges_CTMod" role="button" class="btn btn-outline-light ">
                                <i class="fas fa-database text-black-50 mr-1"></i> <span class="text-bold text-sm"> Save changes </span>
                            </a>

                            <a id="btnSaveChanges_CTMod_SendReq" role="button" class="btn btn-outline-warning border shadow-sm float-none">
                                <span class="text-black-50 text-bold text-sm"> Send Request </span><i class="fas fa-arrow-right text-primary ml-1"></i>
                            </a>
                        </div>

                        @*
                             <a id="btnSaveChanges_CTMod_SendReq" role="button" class="btn btn-outline-warning border shadow-sm float-none">
                                 <span class="text-black-50 text-bold text-xs"> Send Request </span><i class="fas fa-arrow-right text-primary ml-1"></i>
                             </a>

                            <a id="btnSaveChanges_CTMod_SendReq" role="button" class="btn btn-outline-primary border-secondary shadow-sm float-right">
                                 <span class="text-primary text-xs"> Send Request </span><i class="fas fa-arrow-right text-black-50 ml-1"></i>
                             </a>

                             <a id="btnSaveChanges_CT_RecallReq" role="button" class="btn btn-outline-info border-secondary shadow-sm float-right">
                                 <i class="fas fa-arrow-left text-black-50 mr-1"></i> <span class="text-info text-xs"> Recall Request </span>
                             </a>

                             <a id="btnSaveChanges_CT_CancelReq" role="button" class="btn btn-outline-danger border-dark shadow-sm float-right">
                                 <i class="fas fa-times text-black-50 mr-1"></i> <span class="text-danger text-xs"> Terminate Request </span>
                             </a>

                             <a id="btnSaveChanges_CT_ResubmitReq" role="button" class="btn btn-outline-warning border-dark shadow-sm float-right">
                                 <i class="fas fa-redo text-black-50 mr-1"></i> <span class="text-dark text-xs"> Resubmit Request </span>
                             </a>
                        *@




                        @*<a id="btnSaveChanges_CTMod_RecallReq" role="button" class="btn btn-outline-warning border shadow-sm float-none">
                                <i class="fas fa-arrow-left text-info mr-1"></i> <span class="text-black-50 text-bold text-xs"> Recall Request </span>
                            </a>

                            <a id="btnSaveChanges_CTMod_CancelReq" role="button" class="btn btn-outline-warning border shadow-sm float-none">
                                <i class="fas fa-times text-black-50 mr-1"></i> <span class="text-black-50 text-bold text-xs"> Terminate Request </span>
                            </a>

                            <a id="btnSaveChanges_CTMod_ResubmitReq" role="button" class="btn btn-outline-warning border shadow-sm float-none">
                                <i class="fas fa-redo text-dark mr-1"></i> <span class="text-black-50 text-bold text-xs"> Resubmit Request </span>
                            </a>*@

                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="divPopModal_AddEdit_1" tabindex="-1" role="dialog" aria-labelledby="_modalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable " role="document">
                <div class="modal-content">
                    <div class="modal-header text-dark" style="background-color: lightcoral">
                        <h5 class="modal-title"> Editing: </h5> @*@Model.strCurrTask style="color: hotpink"*@
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div id="divModalBody_AddEdit_lg" class="modal-body bg-light" style="font-family:Verdana, Geneva, Tahoma, sans-serif; font-size: 10pt">
                    </div>
                    @*<div class="modal-footer " style="background-color: lightgrey; left:auto; right: auto">
                            <a role="button" class="btn btn-outline-light " data-dismiss="modal"> <span class="text-sm "> Terminate </span> </a>

                            <button id="btnSaveChanges" type="submit" class="btn btn-outline-dark border-0 shadow-sm float-right" style="background-color: lightskyblue">
                                <i class="fas fa-database mr-1"></i> <span class="text-bold"> Save changes </span>
                            </button>
                            <button id="btnSaveChanges_ProcToCMP" type="button" class="btn btn-light float-right" hidden>
                                Proceed to Member Profile <i class="fas fa-arrow-right text-bold ml-1"></i>
                            </button>
                        </div>*@
                </div>
            </div>
        </div>


        <div class="modal fade" id="divPopModal_ImpCB" tabindex="-1" role="dialog" aria-labelledby="_modalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document" style="max-height: 50%">
                <div class="modal-content">
                    <div class="modal-header bg-orange text-light">
                        <h6 class="modal-title text-lg"></h6>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div id="divModalBody_ImpCB" class="modal-body bg-light" style="font-family:Verdana, Geneva, Tahoma, sans-serif; font-size: 10pt">
                    </div>
                    <div class="modal-footer " style="background-color: lightgrey; left:auto; right: auto">
                        <a role="button" class="btn btn-outline-light" data-dismiss="modal">
                            <i class="fas fa-times fa-lg text-secondary"></i> @*   mr-1 Terminate*@
                        </a>
                        <button id="btnOK_ImpCB" type="submit" class="btn btn-outline-light bg-light float-right ">
                            <i class="fas fa-check-double text-success mr-1"></i> OK
                        </button>
                    </div>
                </div>
            </div>
        </div>


        @*<div class="modal fade" id="divPopModal_AddEdit_lg" tabindex="-1" role="dialog" aria-labelledby="_modalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable" role="document">
                    <div class="modal-content">
                        <div class="modal-header bg-fuchsia text-light">
                            <h5 class="modal-title"> Editing: </h5> @Model.strCurrTask
                            <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">×</span>
                            </button>
                        </div>
                        <div id="divModalBody_AddEdit_lg" class="modal-body bg-light" style="font-family:Verdana, Geneva, Tahoma, sans-serif; font-size: 10pt">
                        </div>
                        <div class="modal-footer " style="color: lightgrey; left:auto; right: auto">
                            <a href="#" class="btn btn-outline-light " data-dismiss="modal"> Terminate </a>
                            <button id="btnSaveChanges" type="submit" class="btn btn-light  save-data font-weight-bold"><i class="fa fa-database fa-sm"></i> Save changes </button>

                            <button id="btnSaveChanges" class="btn btn-primary" type="submit" >Submit form</button>
                        </div>
                    </div>
                </div>
            </div>*@

        <!-- Success Modal-->
        @*<div class="modal fade" id="divPopModal_Success" tabindex="-1" role="dialog" aria-hidden="true" style="color:transparent; min-width:75px">
                <div class="modal-dialog modal-sm bg-info" role="document">
                    <div class="modal-content">
                        <div class="modal-header bg-success">
                            <h5 style="color: white; font-weight:bold"> Done! </h5>
                        </div>
                        <div class="modal-body bg-white" style="align-items:center">
                            <label id="lblUserMessage" class="text-sm font-weight-normal text-center"></label>
                        </div>

                        <div class="modal-footer bg-white">
                            <a href="#" id="_btnSuccessOK" class="btn btn-success shadow shadow-sm" data-dismiss="modal">Ok</a>
                        </div>
                    </div>
                </div>
            </div>*@

    </body>

}




@section Scripts {

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}



    @* <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.js"></script>
        <script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>*@
    @*<script type='text/javascript' src='loadImg.js'></script>

        <script type='text/javascript'>
            $(function () {
                $('img').imgPreload()
            })
        </script>*@


    <script>
        //// Wait for window load
        //$(window).load(function () {
        //    // Animate loader off screen
        //    $(".se-pre-con").fadeOut("slow");
        //});

        $(document).ready(function () {
            // Animate loader off screen
            $(".se-pre-con").fadeOut("slow");
        });
    </script>


    <script>


        $(function () {
            $('[data-toggle="popover"]').popover()
        })

        $(document).ready(function () {

            let anchorlinks = document.querySelectorAll('a[href^="#section"]')

            for (let item of anchorlinks) { // relitere
                item.addEventListener('click', (e) => {
                    let hashval = item.getAttribute('href')
                    let target = document.querySelector(hashval)
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    })
                    history.pushState(null, null, hashval)
                    e.preventDefault()
                })
            }

        });



        $(document).ready(function () {

            $('#smartwizard').smartWizard({
                selected: 0,
                theme: 'dots',
                autoAdjustHeight: true,
                transitionEffect: 'fade',
                showStepURLhash: false,

            });
        });

        var DisplaySuccessInfo = function (msg, reload = false) {

            $.alert({
                title: 'Done!',
                type: 'green',
                typeAnimated: true,
                content: msg,
                closeIcon: true,
                closeIconClass: 'fa fa-close'
            });

        };

        var DisplayErrorInfo = function (msg, reload = false) {

            $.alert({
                title: 'Oops!',
                type: 'red',
                typeAnimated: true,
                content: msg,
                closeIcon: true,
                closeIconClass: 'fa fa-close'
            });

        };


        var DisplaySuccessInfo_Reload_CM = function (msg, reload = false, resetNew = false, _setIndex = 6, _subSetIndex = 1, _currCMCode = '') {   //currSubSetIndex,  proScope, subScope,

            // alert('success.. reload: ' + reload);

            $.alert({
                title: 'Done!',
                type: 'green',
                icon: 'success',
                content: '<span style="color:#000">' + msg + '<span>',
                html: true,
                background: 'green',
                typeAnimated: true,
                // closeIcon: false,
                closeIconClass: 'fa fa-close',
                buttons: {
                    ok: function () {
                        if (reload) {
                            ReloadCurrPage_CM(_setIndex, _subSetIndex, _currCMCode);
                        }

                        //if (resetNew == true) {
                        //    AddEditCurrData_CM(0, '', valCMCode,'', 1); //(0, currDenomId, currChuBodyId, currSetIndex, currSubSetIndex, _desc);
                        //}
                        //else {
                        //    $("#divPopModal_AddEdit .close").click();
                        //}
                    }
                }
            });

            //if (reload) {
            //    ReloadCurrPage();   //, currSubSetIndex , proScope, subScope
            //}
        };

        var DisplayErrorInfo_Reload_CM = function (msg, reload = false, _setIndex = 6, _subSetIndex = 1, _currCMCode = '') {
            //  alert('fail.. reload: ' + reload);

            $.alert({
                title: 'Oops!',
                type: 'red',
                //icon: 'fail',
                content: '<span style="color:#000">' + msg + '<span>',
                html: true,
                background: 'red',
                typeAnimated: true,
                //closeIcon: true,
                closeIconClass: 'fa fa-close',
                buttons: {
                    ok: function () {
                        if (reload) {
                            ReloadCurrPage_CM(_setIndex, _subSetIndex, _currCMCode);
                        }
                    }
                }
            });

        };




    </script>


    <!-- CM_BD  no ADD, no DEL, only EDIT -->
    <script>
        //LoadTableCM_BD();

        $(function () {
            if ($.fn.dataTable.isDataTable('#tabDataReq_CTOT')) {
                $('#tabDataReq_CTOT').DataTable();
            }
            else {
                $('#tabDataReq_CTOT').DataTable({
                    "responsive": true,
                    "autoWidth": false,
                    //"paging": true,
                    //"lengthChange": false,
                    "searching": true,
                    //  "orderable": true,
                    //"info": true,
                    "order": [],
                    "columnDefs": [{
                        "targets": [0, 5],
                        "orderable": false,
                    }]
                });
            }
        });

        $(function () {
            if ($.fn.dataTable.isDataTable('#tabDataReq_CTIN')) {
                $('#tabDataReq_CTIN').DataTable();
            }
            else {
                $('#tabDataReq_CTIN').DataTable({
                    "responsive": true,
                    "autoWidth": false,
                    //"paging": true,
                    //"lengthChange": false,
                    "searching": true,
                    //  "orderable": true,
                    //"info": true,
                    "order": [],
                    "columnDefs": [{
                        "targets": [0, 5],
                        "orderable": false,
                    }]
                });
            }
        });

        $(function () {

            if ($.fn.dataTable.isDataTable('#tabDataReq_AAS')) {
                $('#tabDataReq_AAS').DataTable();
            }
            else {
                $('#tabDataReq_AAS').DataTable({
                    "responsive": true,
                    "autoWidth": false,
                    //"paging": true,
                    //"lengthChange": false,
                    "searching": true,
                    //  "orderable": true,
                    //"info": true,
                    "order": [],
                    "columnDefs": [{
                        "targets": [0, 6],
                        "orderable": false,
                    }]
                });
            }

        });



       // var AddEditCurrDataReq_CT = function (currCBId, currDxn = 2, currSvc_ndx = 1, currId, _strItemName) {   //  currVw, currCMid,
        var AddEditCurrDataReq_CT = function (currCBId, currDxn = 2, currSvc_ndx = 1, _strTrxTP = 'MT', currCMid, currVw, currId, _strItemName) {   //  currVw, currCMid,
          //  alert('add OR edit...');

            if (currCBId == null) {
                currCBId = $("#_oChurchBodyId_Logged").data("value");
            }

           // var currUserId_Logged = $("#_oUserId_Logged").data("value");

           // var currCountryCode = $("#_currCountryCode").val();
           // var currParBodyId = null;

            if (currCBId < 0) currCBId = null;
            if (currId < 0) currId = null;
           // if (currDxn < 0) currDxn = null;
           // if (currSvc_ndx < 0) currSvc_ndx = null;

            // public IActionResult AddOrEdit_MT(int? oCBid, int dxn = 2, int svc_ndx = 1, int id = 0)
            //   public IActionResult AddOrEdit_MT( int? oCBid, int dxn = 2, int svc_ndx = 1, string strTrxTP = "MT", int? oCMid = null, int vw = -1, int id = 0 )
            var url = "@Url.Action("AddOrEdit_MT", "ChurchTransfer")?oCBid=" + currCBId + "&dxn=" + currDxn + "&svc_ndx=" + currSvc_ndx + '&strTrxTP=' + _strTrxTP +
                         "&oCMid=" + currCMid + "&vw=" + currVw + "&id=" + currId;

           //  alert(url)  // if (currId > 0) { document.querySelector('#btnSaveChangesCM_BD').innerHTML = 'Update'; }

            if (currId > 0)
            { document.querySelector('#btnSaveChanges_CT').innerHTML = '<i class="fas fa-database text-bold mr-1"></i> Update';}

            $('#divPopModal_AddEdit').modal({
                backdrop: 'static',
                keyboard: false
            });
                        //$('#divPopModal_AddEdit').modal({
                        //    backdrop: false,
                        //    show: true
                        //});

            $('#divPopModal_AddEdit .modal-dialog').draggable({
                handle: ".modal-header"
            });



            //alert('loading modal...')
            $('#divPopModal_AddEdit .modal-body').load(url, function () {

                $('#divPopModal_AddEdit .modal-title').html(_strItemName);


                ///  hide perm groups...
                ///
                $("#_divApplicantFxns").prop('hidden', !(currSvc_ndx == 1 || currSvc_ndx == 3) );
                $("#_divChWorkerFxns1").prop('hidden', !currSvc_ndx == 1);
                $("#_divChWorkerFxns2").prop('hidden', !currSvc_ndx == 1);
                $("#_divApproverFxns").prop('hidden', !currSvc_ndx == 2);



                var strReqStatus = $("#_ReqStatus").val();
                var strCurrentScope = $("#_CurrentScope").val();
                var strApprovalStatus = $("#_ApprovalStatus").val();
                var numUserReqTask = $('#_userRequestTask').val();


                //alert('strReqStatus: ' + strReqStatus)
                //alert('strCurrentScope: ' + strCurrentScope)
                //alert('strApprovalStatus: ' + strApprovalStatus)


                /// N - Draft /New
                $("#btnSaveChanges_CTMod").prop('hidden', !(strReqStatus == 'N' && strCurrentScope == "I"));           // || strReqStatus == 'P' || (strReqStatus == 'R' && strApprovalStatus == 'P' && strCurrentScope == "I")));
                $("#btnSaveChanges_CTMod_SendReq").prop('hidden', !(strReqStatus == 'N'));   // || strReqStatus == 'R' && strCurrentScope == "I")

                //$("#btnSaveChanges_CT_RecallReq").prop('hidden', !(strReqStatus == "P" || strReqStatus == "I"));    // !(((strReqStatus == 'P' || strReqStatus == 'R') && (strApprovalStatus == 'P' || strApprovalStatus == 'I' || strApprovalStatus == 'H') && strCurrentScope == "I") || (strReqStatus == 'P' && strCurrentScope == "E")));
                //$("#btnSaveChanges_CT_CancelReq").prop('hidden', !(strReqStatus == "T" || strReqStatus == "Y" || strReqStatus == "U" || strReqStatus == "C" || strReqStatus == "Z"));
                //$("#btnSaveChanges_CT_ResubmitReq").prop('hidden', !(strReqStatus == 'R' || strReqStatus == 'D' || strReqStatus == 'U'));

                ///()
                $("#divPopModal_AddEdit").modal('show');
            });
        };


        var ReloadCurrPageReq_CT = function (currCBId, _dxn, _svc_ndx, _strTrxTP, _blReqHis, _loadLim = true) {
            //alert('reload.. _svc_ndx: ' + _svc_ndx)
            //

            if (currCBId < 0 || currCBId == null || currCBId == '') currCBId = null;
           // if (_oCMid < 0) _oCMid = null;

            // public IActionResult IndexReq_CT(int? oCBid, int dxn = 0, int svc_ndx = 1, string strTrxTP = "MT", bool blReqHis = false, bool loadLim = false)
            var url = '@Url.Action("IndexReq_CT", "ChurchTransfer")?oCBid=' + currCBId + '&dxn=' + _dxn + '&svc_ndx=' + _svc_ndx + '&strTrxTP=' + _strTrxTP + '&blReqHis=' + _blReqHis + '&loadLim=' + _loadLim;


         //   alert(url)

            $("#divOpenReq_CTOT").prop('hidden', true);
            $("#divListReq_CTOT").prop('hidden', false);

            if (_dxn == 1 && _loadLim) {
                $('#divTabDataReq_CTIN').load(url, function () {
                    if ($.fn.dataTable.isDataTable('#tabDataReq_CTIN')) {
                        $('#tabDataReq_CTIN').DataTable();
                    }
                    else {
                        $('#tabDataReq_CTIN').DataTable({
                            "responsive": true,
                            "autoWidth": false,
                            //"paging": true,
                            //"lengthChange": false,
                            "searching": true,
                            //  "orderable": true,
                            //"info": true,
                            "order": [],
                            "columnDefs": [{
                                "targets": [0, 5],
                                "orderable": false,
                            }]
                        });
                    }
                });
            }

            else if (_dxn == 2 && _loadLim) {
                $('#divTabDataReq_CTOT').load(url, function () {
                    if ($.fn.dataTable.isDataTable('#tabDataReq_CTOT')) {
                        $('#tabDataReq_CTOT').DataTable();
                    }
                    else {
                        $('#tabDataReq_CTOT').DataTable({
                            "responsive": true,
                            "autoWidth": false,
                            //"paging": true,
                            //"lengthChange": false,
                            "searching": true,
                            //  "orderable": true,
                            //"info": true,
                            "order": [],
                            "columnDefs": [{
                                "targets": [0, 5],
                                "orderable": false,
                            }]
                        });
                    }
                });
            }

            else if (!_loadLim) window.location.assign(url);

        }


        var OpenCurrReq_MT = function (currCBId, currDxn = 2, currSvc_ndx = 1, _strTrxTP = 'MT', currCMid, currVw, currId) {   //  currVw, currCMid,

          // alert('OPEN REQ...');

            if (currCBId == null) {
                currCBId = $("#_oChurchBodyId_Logged").data("value");
            }

           // var currUserId_Logged = $("#_oUserId_Logged").data("value");

           // var currCountryCode = $("#_currCountryCode").val();
           // var currParBodyId = null;

            if (currCBId < 0) currCBId = null;
            if (currId < 0) currId = $("#_hdnCurrId_MT").val();

           // if (currId < 0) currId = null;
           // if (currDxn < 0) currDxn = null;
           // if (currSvc_ndx < 0) currSvc_ndx = null;
           // if (currVw < 0) currVw = null;

            // public IActionResult OpenReq_MT(int? oCBid, int dxn = 2, int svc_ndx = 1, string strTrxTP = "MT", int vw = -1, int id = 0 )  // -1 :- view, 0 = list, 1 -add, 2-edit, 3-del
            var url = "@Url.Action("OpenReq_MT", "ChurchTransfer")?oCBid=" + currCBId + "&dxn=" + currDxn + "&svc_ndx=" + currSvc_ndx + "&strTrxTP=" + _strTrxTP +
                        "&oCMid=" + currCMid + "&vw=" + currVw + "&id=" + currId;

          //  alert(url)  // if (currId > 0) { document.querySelector('#btnSaveChangesCM_BD').innerHTML = 'Update'; }

            //if (currId > 0)
            //{ document.querySelector('#btnSaveChanges_CT').innerHTML = '<i class="fas fa-database text-bold mr-1"></i> Update';}

            ///

            $('#divDataOpenReq_CTOT').load(url, function () {
                // load the div content...

               // $('#_divOpenReqApprStepList_CT').load(url, function () {
                    if ($.fn.dataTable.isDataTable('#tabDataReq_AAS')) {
                        $('#tabDataReq_AAS').DataTable();
                    }
                    else {
                        $('#tabDataReq_AAS').DataTable({
                            "responsive": true,
                            "autoWidth": false,
                            //"paging": true,
                            //"lengthChange": false,
                            "searching": true,
                            //  "orderable": true,
                            //"info": true,
                            "order": [],
                            "columnDefs": [{
                                "targets": [0, 6],
                                "orderable": false,
                            }]
                        });
                    }
               // });


                showOrHideTaskBtn();

            });

        };


        var showOrHideTaskBtn = function () {

            $("#divOpenReq_CTOT").prop('hidden', false);
            $("#divListReq_CTOT").prop('hidden', true);

            $("#_divOpenReqApprStepList_CT").prop('hidden', true);

            var strWorkSpanStatus = $("#_WorkSpanStatus").val();
            var strReqStatus = $("#_ReqStatus").val();
            var strCurrentScope = $("#_CurrentScope").val();
            var strApprovalStatus = $("#_ApprovalStatus").val();
            var numUserReqTask = $('#_userRequestTask').val();

            //alert('strReqStatus: ' + strReqStatus)
            //alert('strCurrentScope: ' + strCurrentScope)
            //alert('strApprovalStatus: ' + strApprovalStatus)
            //alert('numUserReqTask: ' + numUserReqTask)


            /// N - Draft /New
            $("#btnSaveChanges_CT").prop('hidden', !(strReqStatus == 'N' && strCurrentScope == "I"));           // || strReqStatus == 'P' || (strReqStatus == 'R' && strApprovalStatus == 'P' && strCurrentScope == "I")));
            $("#btnSaveChanges_CT_SendReq").prop('hidden', !(strReqStatus == 'N'));   // || strReqStatus == 'R' && strCurrentScope == "I")
            $("#btnSaveChanges_CT_RecallReq").prop('hidden', !(strReqStatus == "P" || strReqStatus == "K" || strReqStatus == "I"));    // !(((strReqStatus == 'P' || strReqStatus == 'R') && (strApprovalStatus == 'P' || strApprovalStatus == 'I' || strApprovalStatus == 'H') && strCurrentScope == "I") || (strReqStatus == 'P' && strCurrentScope == "E")));
            $("#btnSaveChanges_CT_CancelReq").prop('hidden', (strReqStatus == "X" || (strReqStatus == "T" || strReqStatus == "Y" || strReqStatus == "U" || strReqStatus == "C" || strReqStatus == "Z")));
            $("#btnSaveChanges_CT_ResubmitReq").prop('hidden', !(strReqStatus == 'R' || strReqStatus == 'D' || strReqStatus == 'U'));

            /// approval action... 6 - 11 // 12
            ///6
            $("#btnSaveChanges_CT_AckReq").prop('hidden', (!((strCurrentScope == "I" && strReqStatus == 'P' && strApprovalStatus == '') || (strCurrentScope == "E" && strReqStatus == 'I' &&
                (strApprovalStatus == 'A' || strApprovalStatus == 'F')) || (strCurrentScope == "I" && strReqStatus == 'A' && (strApprovalStatus == 'A' || strApprovalStatus == 'F')))));
            ///
            var actionStat = (!((strReqStatus == "I" && (strApprovalStatus == "P" || strApprovalStatus == "I" || strApprovalStatus == "H")) || (strReqStatus == "A" || strReqStatus == "D")));
            $("#btnSaveChanges_CT_ApproveReq").prop('hidden', actionStat);  /// 7
            $("#btnSaveChanges_CT_SuspendReq").prop('hidden', actionStat);  /// 8
            $("#btnSaveChanges_CT_DeclineReq").prop('hidden', actionStat); /// 9
            $("#btnSaveChanges_CT_ForceCompReq").prop('hidden', actionStat); /// 10
            ///
            $("#btnSaveChanges_CT_CloseReq").prop('hidden', !(strReqStatus == "Y"));   /// 11
            $("#btnSaveChanges_CT_ReOpenReq").prop('hidden', !(strReqStatus == "C"));  /// 14  ... 12/13 [Return Request... I/E]

            //alert('appr: ' + strApprovalStatus)
            //alert('archive: ' + !(strApprovalStatus == "X" || strApprovalStatus == "U" || strApprovalStatus == "C"))
           // $("#btnSaveChanges_CT_ArchReq").prop('hidden', !(strReqStatus == "X" || strReqStatus == "U" || strReqStatus == "C"));   /// 15


        }


        var DeleteCurrDataCM_BD = function (currCBId, currId, forceDeleteConfirm = false, msg = "") {

        alert('deleting')

        var currUserId_Logged = $("#_oUserId_Logged").data("value");
        var currAGOId_Logged = $("#_oAppGloOwnId_Logged").data("value");
        if (currCBId == null)
            { currCBId = $("#_oChurchBodyId_Logged").data("value");}

            $.confirm({
                title: 'Confirm delete!',
                content: (msg == '' ? 'Are you sure you want to delete the specified church member' : msg) + ' ?',
                type: 'red',
                typeAnimated: true,
                buttons: {
                    cancel: function () {
                        //$.alert('Canceled!');
                    },
                    //info: {
                    //    btnClass: 'btn-blue',
                    //    action: function(){}
                    //},

                    delete: {
                        btnClass: 'btn-danger ',
                        action: function () {
                            $.ajax({
                                type: 'POST',
                                url: '@Url.Action("DeleteCM_BD", "ChurchTransfer")',
                               // url: "/ChurchMembers/DeleteCM_BD",
                               // data: { loggedUserId: currUserId_Logged, id: currId, setIndex: currSetIndex, subSetIndex: currSubSetIndex, forceDeleteConfirm: forceDeleteConfirm },  //forceDeleteConfirm = -1 {denied-error, info}, 0 {denied-dependencies, info}, 1 {denied-confirm to force-delete, task}

                                // public IActionResult DeleteCM_BD(int? oAppGloOwnId, int? oChurchBodyId, int? loggedUserId, int id, int setIndex, int subSetIndex, bool forceDeleteConfirm = false)
                                data: { oAppGloOwnId: currAGOId_Logged, oChurchBodyId: currCBId, loggedUserId: currUserId_Logged, id: currId, forceDeleteConfirm: forceDeleteConfirm },  //forceDeleteConfirm = -1 {denied-error, info}, 0 {denied-dependencies, info}, 1 {denied-confirm to force-delete, task}
                                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                                success: function (res) {
                                    if (res.taskSuccess == true) {
                                        DisplaySuccessInfo(res.userMess);
                                        ReloadCurrPageCM_BD(res.currCBId);
                                    }

                                    else {
                                        if (res.tryForceDelete == true) {
                                            DeleteCurrDataCM_BD(currCBId, currId, true, res.userMess);
                                        }

                                        else {
                                            DisplayErrorInfo(res.userMess);
                                        }
                                    }
                                },

                                error: function () {
                                    alert("Error occured while deleting data");
                                }
                            });
                        }
                    },

                    //,
                }
            });

        };

       var AddEditCurrDataCM_MPC = function (currCBId, currCMId, s_ndx) { // , _strItemName
          //   alert('add OR edit...');

            if (currCBId == null) {
                currCBId = $("#_oChurchBodyId_Logged").data("value");
            }

            if (currCMId < 0) currCMId = null;

            //  public IActionResult AddModCM_vwMPC(int? oCBid = null, int? oCMid = null, int? oParid = null, int s_ndx = 0, int sb_ndx = 0, int vw = 0)
             var url = "@Url.Action("AddModCM_vwMPC", "ChurchTransfer")?oCMid=" + currCMId + "&oCBid=" + currCBId + "&s_ndx=" + s_ndx; // + "&vw=" + 0;     // + "&strCodeCriteria_2=" + null + "&oUserId=" + currUserId_Logged ;

           // alert(url)  // if (currCMId > 0) { document.querySelector('#btnSaveChangesCM_BD').innerHTML = 'Update'; }

            if (s_ndx > 0) {
                $('#divTabDataMPCvd').load(url, function () {

                    alert('load data...')

                });
            }
            else {
                window.location.assign(url); // window.location = url;
            }
        };

       $(document).on('click', '#btnSaveChanges', function (e) {
        e.preventDefault();

        //  alert('click..');
        const form = document.getElementById("currFormCM_BD");
        //alert('val 4 .. ' + form.checkValidity())

        if (form.checkValidity() === true) {

            SaveCurrReq_CTMod(); //currSetIndex, currSubSetIndex);
        }
        else {
            // alert('val 5')
            event.preventDefault();
            event.stopPropagation();

            form.classList.add('was-validated');
        }


        // }, false);

            var SaveCurrReq_CTMod = function () { // (currSetIndex, currSubSetIndex) {
            //    alert('save... ');

             var currFormData = new FormData($("#currFormCM_BD").get(0));
                // var currFormData = $("#currFormCM_BD").serialize();
               // alert('save... submitting...');

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,

                    url: '@Url.Action("AddModCM_BD", "ChurchTransfer")',

                   // url: "/ChurchMembers/AddModCM_BD",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    //contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    contentType: false,
                    processData: false,
                    success: function (res) {

                        if (res.taskSuccess == true) {

                            ReloadCurrPageCM_BD(res.currCBId);   //currId... via AJAX...

                            // var ures = confirm("Add new member?");

                            //alert($('#btnSaveChanges').text())

                            if ($('#btnSaveChanges').text().includes('Save')) {  // newly added...
                               // alert('adding new...')
                               $.confirm({
                                    title: 'Done!',
                                    content: res.userMess + '. >> Add new member - biodata?',
                                    type: 'green',
                                    typeAnimated: true,
                                    closeIcon: true,
                                    closeIconClass: 'fa fa-close',
                                    ///
                                    buttons: {
                                        close: function () {
                                            AddEditCurrDataCM_BD(res.currCBId, res.currId, res.memDispName);
                                            document.querySelector('#btnSaveChanges').innerHTML = '<i class="fas fa-database text-bold mr-1"></i> Update';
                                        },
                                        ///
                                        'ok add new': function () {
                                            AddEditCurrDataCM_BD(res.currCBId, 0, "'[New] Member Transfer Request'");
                                            document.querySelector('#btnSaveChanges').innerHTML = '<i class="fas fa-database text-bold mr-1"></i> Save changes';
                                        },
                                    }
                                });
                            }

                            else {   // update..
                               // alert('updating...')
                                DisplaySuccessInfo(res.userMess);
                                $("#divPopModal_AddEdit .close").click();
                            }
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                })
        }

    })


        $(document).on('click', '#_btnToggleOpenReqApprStep_CT', function (e) {
                e.preventDefault();

            var res = $("#_divOpenReqApprStepList_CT").is(":hidden");
            $("#_divOpenReqApprStepList_CT").prop('hidden', !res);
        })


         $(document).on('click', '#btnSaveChanges_CTMod', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to save transfer details -- as draft ?")
            if (res) SaveCurr_CTMod();
            })

        var SaveCurr_CTMod = function () {
                // alert('save... new');

                $('#_userRequestTask').val(1);
                var currFormData = $("#currForm_ReqMT").serialize();
                // var oTask = 1 //save  taskIndx

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,
                  //  url: "/ChurchTransfer/AddOrEdit_MT",

                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {


                        if (res.taskSuccess == true) {

                            @*  var ReloadCurrPageReq_CT = function (currCBId, _dxn, _svc_ndx, _blReqHist, _strTrxTP, _oCMid) *@
                            ReloadCurrPageReq_CT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.blReqHis);   // res.oCMid, currId... via AJAX...

                            // var ures = confirm("Add new member?");

                            //alert($('#btnSaveChanges').text())

                            if ($('#btnSaveChanges').text().includes('Save')) {  // newly added...
                                // alert('adding new...')
                                $.confirm({
                                    title: 'Done!',
                                    content: res.userMess,
                                    type: 'green',
                                    typeAnimated: true,
                                    closeIcon: true,
                                    closeIconClass: 'fa fa-close',
                                    ///
                                    buttons: {
                                        close: function () {
                                            /// AddEditCurrDataReq_CT = function (currCBId, currDxn = 2, currSvc_ndx = 1, currId, strItemName)
                                            /// ReloadCurrPageReq_CT(res.currCBId, res.dxn, res.svc_ndx, res.blReqHis, res.strTrxTP, res.oCMid);   // res.taskSuccess,  currId
                                            AddEditCurrDataReq_CT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId, res.strItemName);
                                            document.querySelector('#btnSaveChanges_CT').innerHTML = '<i class="fas fa-database text-bold mr-1"></i> Update';

                                            ///
                                           /// $("#btnSaveChanges_CT_SendReq").prop('hidden', false);
                                        },

                                        'ok, add new' : function () {
                                            var strCT_Type = "Member Transfer";
                                            if (res.strTrxTP == "CT") strCT_Type = "Clergy Transfer";
                                            else if (res.strTrxTP == "RT") strCT_Type = "Role Transfer";

                                            // AddEditCurrDataReq_CT = function (currCBId, currCMid, currId, _strItemName)       ///////  AddEditCurrDataReq_CT(res.currCBId, res.oCMid, 0, "'[New] " + strCT_Type + " Request'");

                                            //AddEditCurrDataReq_CT(res.currCBId, res.dxn, res.svc_ndx, 0, "'[New] " + strCT_Type + " Request'");

                                            AddEditCurrDataReq_CT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 1, 0, "'[New] " + strCT_Type + " Request'");
                                            //

                                            document.querySelector('#btnSaveChanges_CT').innerHTML = '<i class="fas fa-database text-bold text-sm mr-1"></i> Save changes';
                                        }
                                    }
                                });
                            }

                            else {   // update..
                                // alert('updating...')
                                DisplaySuccessInfo(res.userMess);
                                $("#divPopModal_AddEdit .close").click();
                            }
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }



                        //if (res.taskSuccess == true) {
                        //    var currChuBodyId = $("#_RequestorChurchBodyId").val();
                        //    // var currId = $("#_hdnCurrId_MT").val();
                        //    var dxn = $("#_dxn").val();

                        //    DisplaySuccessInfo(res.userMess, "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&dxn=" + dxn);
                        //    //'Member transfer request details saved.'  window.location.href = "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;
                        //}
                        //else {
                        //    alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                        //}
                    }
                })
        }



        $(document).on('click', '#btnSaveChanges_CTMod_SendReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to submit member transfer request ?")
                if (res) SaveChanges_CTMod_SendReq();

            })

        var SaveChanges_CTMod_SendReq = function () {
                alert('send... saving req');

                $('#_userRequestTask').val(2);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({

                    type: 'POST',
                    // data: formdata,
                    // processData: false,
                  //  url: "/ChurchTransfer/AddOrEdit_MT",

                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',


                    @*type: 'POST',
                    // data: formdata,
                    // processData: false,

                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',

                    // url: "/ChurchMembers/AddModCM_BD",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    //contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    contentType: false,
                    processData: false,*@

                    success: function (res) {

                        if (res.taskSuccess == true) {

                            ReloadCurrPageReq_CT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.blReqHist);  //currId... via AJAX...

                            if ($('#btnSaveChanges_SendReq').text().includes('Send')) {  // newly added...
                                // alert('adding new...')
                                $.confirm({
                                    title: 'Done!',
                                    content: res.userMess,
                                    type: 'green',
                                    typeAnimated: true,
                                    closeIcon: true,
                                    closeIconClass: 'fa fa-close',
                                    ///
                                    buttons: {
                                        ok: function () {

                                            @*  var ReloadCurrPageReq_CT = function (currCBId, _dxn, _svc_ndx, _blReqHist, _strTrxTP, _oCMid) *@
                                            ReloadCurrPageReq_CT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.blReqHis);   // res.oCMid, currId... via AJAX...


                                            // alert('updating...')
                                            //DisplaySuccessInfo(res.userMess);
                                            $("#divPopModal_AddEdit .close").click();


                                            // AddEditCurrDataReq_CT = function (currCBId, currCMid, currId, _strItemName)
                                            /// AddEditCurrDataReq_CT(res.currCBId, res.oCMid, res.currId, res.strItemName);

                                            // document.querySelector('#btnSaveChanges_CT_SendReq').innerHTML = '<i class="fas fa-arrow-right text-bold text-sm mr-1"></i> Send Request';
                                            // document.querySelector('#btnSaveChanges_CT').innerHTML = '<i class="fas fa-database text-bold text-sm mr-1"></i> Save changes';

                                            ///
                                            // Save 1
                                            //$("#btnSaveChanges_CT_SendReq").prop('hidden', 'hidden');   // 2  ...
                                            //$("#btnSaveChanges_CT_RecallReq").prop('hidden', false);    // 3  ... when Send is not available
                                            //$("#btnSaveChanges_CT_CancelReq").prop('hidden', false);    // 4  ... terminate!
                                            //Resubmit  // 5  ... Fail, Declined
                                        },
                                    }
                                });
                            }

                            else {   // update..
                                DisplaySuccessInfo(res.userMess);
                                $("#divPopModal_AddEdit .close").click();
                            }
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                });

            }


    </script>



    <script>
        $(document).ready(function () {


            //var PerformCurrTask = function () {
            //    var oTask = $('#_userRequestTask').val();
            //    alert('oTask: ' + oTask);

            //    $("#divPopModal_Confirm .close").click();

            //    switch (oTask) {
            //        case 2: SendCurr_CT_SendReq(); break;
            //        case 3: SendCurr_CT_RecallReq(); break;
            //        case 4: SendCurr_CT_CancelReq(); break;
            //        case 5: SendCurr_CT_ResubmitReq(); break;

            //        //case 6: SendCurr_CT_SendReq(); break;
            //        //case 7: SendCurr_CT_SendReq(); break;
            //        //case 8: SendCurr_CT_SendReq(); break;
            //        //case 9: SendCurr_CT_SendReq(); break;
            //        //case 10: SendCurr_CT_SendReq(); break;
            //    }
            //}


            $(document).on('click', '#btnSaveChanges_CT', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to save transfer details -- as draft ?");
                if (res) SaveChanges_CT_Gen(1);

               // if (res) SaveCurr_CT();
            })

            @*var SaveCurr_CT = function () {
                // alert('save... new');

                $('#_userRequestTask').val(1);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({
                    type: 'POST',

                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {

                        if (res.taskSuccess == true) {

                            DisplaySuccessInfo(res.userMess);
                            OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);

                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }

                    }
                })
            }*@



            $(document).on('click', '#btnSaveChanges_CT_SendReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to submit member transfer request ?")
                if (res) SaveChanges_CT_Gen(2);

               // if (res) SaveChanges_CT_SendReq();

            })

            @*var SaveChanges_CT_SendReq = function () {
                alert('send... saving req');

                $('#_userRequestTask').val(2);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({

                    type: 'POST',

                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',

                    success: function (res) {

                        if (res.taskSuccess == true) {

                            if (res.taskSuccess == true) {

                                DisplaySuccessInfo(res.userMess);
                                OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);

                            }

                            else //if (res.taskSuccess == false)
                            {
                                DisplayErrorInfo(res.userMess);
                            }
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                });

            }*@


            //var OpenCurrReq_MT = function (currCBId, currDxn = 2, currSvc_ndx = 1, _strTrxTP = 'MT', currCMid, currVw, currId) {   //  currVw, currCMid,
            //    return Json(new {
            //        taskSuccess = true, currId = _oChangesMT.Id, currCBId = _oChangesMT.ChurchBodyId, userMess = oUserMsg, signOutToLogIn = false, resetNew = false,
            //        dxn = vm.numTransferDxn, svc_ndx = vm.serviceTask, blReqHis = false, strTrxTP = _oChangesMT.TransferType, oCMid  = _oChangesMT.ChurchMemberId, strItemName = oMTModel.strTransfMemberDesc
            //    });



            $(document).on('click', '#btnSaveChanges_CT_RecallReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to recall the member transfer request ?")
                if (res) SaveChanges_CT_Gen(3);

                //if (res) SaveChanges_CT_RecallReq();
            })

            @*var SaveChanges_CT_RecallReq = function () {   // recall if 1st approval yet to act

                $('#_userRequestTask').val(3);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,

                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',  //url: "/ChurchTransfer/AddOrEdit_MT",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {
                        if (res.taskSuccess == true) {

                            DisplaySuccessInfo(res.userMess);
                            OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                })
            }*@

            $(document).on('click', '#btnSaveChanges_CT_CancelReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to cancel the member transfer request ?")
                if (res) SaveChanges_CT_Gen(4);

                //if (res) SaveChanges_CT_CancelReq();
            })

            @*var SaveChanges_CT_CancelReq = function () {   // cancel to stop the transfer process -- any time

                $('#_userRequestTask').val(4);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,
                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',  //url: "/ChurchTransfer/AddOrEdit_MT",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {
                        if (res.taskSuccess == true) {

                            DisplaySuccessInfo(res.userMess);
                            OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                })
            }*@

            $(document).on('click', '#btnSaveChanges_CT_ResubmitReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to re-submit member transfer request ?")
                if (res) SaveChanges_CT_Gen(5);

                //if (res) SaveChanges_CT_ResubmitReq();
            })

            @*var SaveChanges_CT_ResubmitReq = function () {  // resubmit if 1st request failed, approval declined ---

                $('#_userRequestTask').val(5);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,
                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',  //url: "/ChurchTransfer/AddOrEdit_MT",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {
                        if (res.taskSuccess == true) {

                            DisplaySuccessInfo(res.userMess);
                            OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                })
            }*@


            /////
            ///// Approvers fxn...
            /////

            $(document).on('click', '#btnSaveChanges_CT_AckReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to acknowledge member transfer request ?")
                if (res) SaveChanges_CT_Gen(6);

                //if (res) SaveChanges_CT_AckReq();
            })

            @*var SaveChanges_CT_AckReq = function () {  // acknowledge when member sends request to From CB or when member request is forwarded to ToCB or when ToCB finishes the transfer, and informs FromCB

                $('#_userRequestTask').val(6);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,
                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',  //url: "/ChurchTransfer/AddOrEdit_MT",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {
                        if (res.taskSuccess == true) {

                            DisplaySuccessInfo(res.userMess);
                            OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                })
            }*@


            $(document).on('click', '#btnSaveChanges_CT_AckReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to approve member transfer request ?")
                if (res) SaveChanges_CT_Gen(6);
            })

            $(document).on('click', '#btnSaveChanges_CT_ApproveReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to approve member transfer request ?")
                if (res) SaveChanges_CT_Gen(7);
            })

            $(document).on('click', '#btnSaveChanges_CT_SuspendReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to suspend member transfer request ?")
                if (res) SaveChanges_CT_Gen(8);
            })

            $(document).on('click', '#btnSaveChanges_CT_DeclineReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to decline member transfer request ?")
                if (res) SaveChanges_CT_Gen(9);
            })

            $(document).on('click', '#btnSaveChanges_CT_ForceCompReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to force complete (waive) member transfer request ?")
                if (res) SaveChanges_CT_Gen(10);
            })

            $(document).on('click', '#btnSaveChanges_CT_CloseReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to close member transfer request ?")
                if (res) SaveChanges_CT_Gen(11);
            })

            $(document).on('click', '#btnSaveChanges_CT_ReOpenReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to re-open member transfer request ?")
                if (res) SaveChanges_CT_Gen(14);
            })

            $(document).on('click', '#btnSaveChanges_CT_ArchReq', function (e) {
                e.preventDefault();

                var res = confirm("Are you sure you want to archive member transfer request ?")
                if (res) SaveChanges_CT_Gen(15);
            })


            var SaveChanges_CT_Gen = function (reqTask) {  // acknowledge when member sends request to From CB or when member request is forwarded to ToCB or when ToCB finishes the transfer, and informs FromCB

                $('#_userRequestTask').val(reqTask);
                var currFormData = $("#currForm_ReqMT").serialize();

                $.ajax({
                    type: 'POST',
                    // data: formdata,
                    // processData: false,
                    url: '@Url.Action("AddOrEdit_MT", "ChurchTransfer")',  //url: "/ChurchTransfer/AddOrEdit_MT",
                    data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (res) {
                        if (res.taskSuccess == true) {

                            DisplaySuccessInfo(res.userMess);
                            OpenCurrReq_MT(res.currCBId, res.dxn, res.svc_ndx, res.strTrxTP, res.oCMid, 2, res.currId);
                        }

                        else //if (res.taskSuccess == false)
                        {
                            DisplayErrorInfo(res.userMess);
                        }
                    }
                })
            }































            /////////////////////////
            ///////////////////////////



            $(document).on('change', '#chkRequireApproval', function (e) {
                var chk = this.checked;

                //$('#divRequireApproval').hide();
                //$('#divChurchAssociate').hide();
                //    alert('require approval: ' + chk);

                $('#divApprovalAction').prop('hidden', !chk)

                //if (chk) {
                //    //  alert('clicked 1');
                //    $('#divApprovalAction').show();
                //} else {
                //    // alert('not clicked 1');
                //    $('#divApprovalAction').hide();
                //}
            })

        });


        var AddEditCurrData_ChuTransf = function (currChuBodyId, currId, transfIndx) {  //, currMdl
            //  alert('edit...');
            // alert("currId add: " + currId + "  : " + transfIndx);
            if (transfIndx == 1) { //member transfer
                var url = "/ChurchTransfer/AddOrEdit_CT?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;  // + "&oCurrMdl=" + currMdl; //id=" + currId;

                //var url = "/MemberPane/AddOrEdit?id=" + currId;
                // alert("clicked mem  pane: " + url);

                $('#divPopModal_AddEdit_xl').modal({
                    backdrop: 'static',
                    keyboard: false
                });

                $("#divModalBody_AddEdit_xl").load(url, function () {
                    $("#divPopModal_AddEdit_xl").modal('show');
                    //$(this).modal('show');
                });
            }

            else if (transfIndx == 2) { // clergy transfer
                var url = "/ChurchTransfer/AddOrEdit_CLGTransf?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;  // + "&oCurrMdl=" + currMdl; //id=" + currId;

                //var url = "/MemberPane/AddOrEdit?id=" + currId;
                // alert("clicked mem  pane: " + url);

                $('#divPopModal_AddEdit_xl_CLG').modal({
                    backdrop: 'static',
                    keyboard: false
                });

                $("#divModalBody_AddEdit_xl_CLG").load(url, function () {
                    $("#divPopModal_AddEdit_xl_CLG").modal('show');
                    //$(this).modal('show');
                });
            }
            else if (transfIndx == 3) {

            }

        };

        var AddEditCurrData_ChuTransf_CLG = function (currChuBodyId, currId) {
            // alert('edit...' + currChuBodyId + ' ... ' + currId);
            var url = "/ChurchTransfer/AddOrEdit_CLGTransf?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;  // + "&oCurrMdl=" + currMdl; //id=" + currId;

            //var url = "/MemberPane/AddOrEdit?id=" + currId;
            // alert("clicked mem  pane: " + url);

            $('#divPopModal_AddEdit_xl_CLG').modal({
                backdrop: 'static',
                keyboard: false
            });

            $("#divModalBody_AddEdit_xl_CLG").load(url, function () {
                $("#divPopModal_AddEdit_xl_CLG").modal('show');
                //$(this).modal('show');
            });
        }

        $(document).on('click', '#btnShowMemInfo_CLGTransf', function (e) {
            e.preventDefault();

            //var currId = $("#TransfMemberId").val(); alert('searching.. ' + currId);
            var url = "/ChurchMembers/AddOrEdit?id=" + currId;  // + "&oCurrMdl=" + currMdl; //id=" + currId;
            window.open(url, "_blank"); //"_self"); //
            // location.href = _url;




            //         $.ajax({
            //    url: "https://jsonplaceholder.typicode.com/todos/" + todoId,
            //    success: function(data) {
            //        debugger;
            //        console.log("Response:", data);
            //        if (data) {
            //            debugger;
            //            var userId = data.userId;
            //            var url = "https://jsonplaceholder.typicode.com/users/" + userId;
            //            window.open(url, "_blank");
            //        }
            //    },
            //    error: function(error) {
            //        debugger;
            //        alert("Error:" + error);
            //    }
            //})


        })

        $(document).on('click', '#btnSaveChanges_CLGTransf', function (e) {
            e.preventDefault();

            SaveCurr_CLGTransf();
        })

        var SaveCurr_CLGTransf = function () {
           // alert('save... ');

            var subType = '';
            if ($("#chk_TransfMem").is(":checked")) {
                subType = 'M';
            } else { subType += '-'; }
            if ($("#chk_TransfRol").is(":checked")) {
                subType += 'R';
            } else { subType += '-'; }
            if ($("#chk_TransfFam").is(":checked")) {
                subType += 'F';
            } else { subType += '-'; }

            // alert('save... subType: ' + subType);

            var data_desig = '';
            var _arrCong = [];

            $("#_tblDesigRole").find('tr').each(function (i, el) {
                var $tds = $(this).find('td'),
                    desigChurchBodyId = $tds.eq(0).attr('id'), //.id, //.text(),
                    toRoleSectorId = $tds.eq(1).attr('id'), //.text(),
                    toLeaderRoleId = $tds.eq(2).attr('id'); //.text();
                var _desig = '';
                if (desigChurchBodyId != null && desigChurchBodyId != '') {
                    _desig += desigChurchBodyId + '|' + toRoleSectorId + '|' + toLeaderRoleId;    // churchBody|SectorId|RoleId
                    _arrCong.push(_desig);
                }
                // alert(_desig);
            });

            if (_arrCong.length != 0) {
                data_desig = _arrCong.toString();
            }

            //  alert('save... data_desig: ' + data_desig);
            //get checked ids...

            var arrCong = [];
            var commaSepIds = "";
            $("#_ChkLstToCong li input[type=checkbox]").each(function (index, val) {
                //alert('in 1');
                //debugger
                var checkId = $(val).attr("Id");
                //var arr =checkId.split('_');
                //var currentCheckboxId = arr[1];
                var IsChecked = $("#" + checkId).is(":checked", true);
                if (IsChecked) {
                    arrCong.push(checkId);
                }
            });

            if (arrCong.length != 0) {
                commaSepIds = arrCong.toString();

                // alert('save... tolist: ' + commaSepIds);

                //$.ajax({
                //    url: "",
                //    url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                //    data: { checkedCong: commaSepIds },
                //    success: function (res) {
                //        //code ..
                //    }
                //})
            }

            //alert('done...');
            //alert('cong: ' + arrCong.length);


            $('#_userRequestTask').val(1);
            $('#_selectCong').val(commaSepIds);
            $('#_desigRoles').val(data_desig);
            $('#_TransferSubType').val(subType);

            var currFormData = $("#currForm_CLGTransf").serialize();
            // var oTask = 1 //save  taskIndx


            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                data: currFormData,   //{ data: currFormData, checkedCong: commaSepIds },  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (res) {

                    if (res.taskSuccess == true) {
                        var currChuBodyId = $("#_RequestorChurchBodyId").val();
                        // var currId = $("#_hdnCurrId_CLGTransf").val();
                        var dxn = $("#_dxn").val();

                        DisplaySuccessInfo(res.userMess, "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&dxn=" + dxn);
                        //'Member transfer request details saved.'  window.location.href = "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;
                    }
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }

        $(document).on('click', '#btnSendCurr_CLGTransf_SendReq', function (e) {
            e.preventDefault();

            SendCurr_CLGTransf_SendReq();
        })

        var SendCurr_CLGTransf_SendReq = function () {
            alert('send... saving req');



            var subType = '';
            if ($("#chk_TransfMem").is(":checked")) {
                subType = 'M';
            } else { subType += '-'; }
            if ($("#chk_TransfRol").is(":checked")) {
                subType += 'R';
            } else { subType += '-'; }
            if ($("#chk_TransfFam").is(":checked")) {
                subType += 'F';
            } else { subType += '-'; }

            // alert('save... subType: ' + subType);

            var data_desig = '';
            var _arrCong = [];

            $("#_tblDesigRole").find('tr').each(function (i, el) {
                var $tds = $(this).find('td'),
                    desigChurchBodyId = $tds.eq(0).attr('id'), //.id, //.text(),
                    toRoleSectorId = $tds.eq(1).attr('id'), //.text(),
                    toLeaderRoleId = $tds.eq(2).attr('id'); //.text();
                var _desig = '';
                if (desigChurchBodyId != null && desigChurchBodyId != '') {
                    _desig += desigChurchBodyId + '|' + toRoleSectorId + '|' + toLeaderRoleId;    // churchBody|SectorId|RoleId
                    _arrCong.push(_desig);
                }
                // alert(_desig);
            });

            if (_arrCong.length != 0) {
                data_desig = _arrCong.toString();
            }

            //  alert('save... data_desig: ' + data_desig);
            //get checked ids...

            var arrCong = [];
            var commaSepIds = "";
            $("#_ChkLstToCong li input[type=checkbox]").each(function (index, val) {
                //alert('in 1');
                //debugger
                var checkId = $(val).attr("Id");
                //var arr =checkId.split('_');
                //var currentCheckboxId = arr[1];
                var IsChecked = $("#" + checkId).is(":checked", true);
                if (IsChecked) {
                    arrCong.push(checkId);
                }
            });

            if (arrCong.length != 0) {
                commaSepIds = arrCong.toString();

                // alert('save... tolist: ' + commaSepIds);

                //$.ajax({
                //    url: "",
                //    url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                //    data: { checkedCong: commaSepIds },
                //    success: function (res) {
                //        //code ..
                //    }
                //})
            }

            //alert('done...');
            //alert('cong: ' + arrCong.length);


            $('#_userRequestTask').val(1);
            $('#_selectCong').val(commaSepIds);
            $('#_desigRoles').val(data_desig);
            $('#_TransferSubType').val(subType);





            $('#_userRequestTask').val(2);
            var currFormData = $("#currForm_CLGTransf").serialize();

            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (res) {
                    // $("#divLoader").hide();
                    if (res.taskSuccess == true) {
                        // alert(res.userMess);
                        var currChuBodyId = $("#_RequestorChurchBodyId").val();
                        // var currId = $("#_hdnCurrId_CLGTransf").val();
                        var dxn = $("#_dxn").val();

                        DisplaySuccessInfo(res.userMess, "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&dxn=" + dxn);
                    }  // 'Member transfer request details saved.'
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }

        $(document).on('click', '#btnSendCurr_CLGTransf_RecallReq', function (e) {
            e.preventDefault();

            SendCurr_CLGTransf_RecallReq();
        })

        var SendCurr_CLGTransf_RecallReq = function () {

            $('#_userRequestTask').val(3);
            var currFormData = $("#currForm_CLGTransf").serialize();

            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (res) {
                    // $("#divLoader").hide();
                    if (res.taskSuccess == true) {
                        // alert(res.userMess);
                        var currChuBodyId = $("#_RequestorChurchBodyId").val();
                        // var currId = $("#_hdnCurrId_CLGTransf").val();
                        var dxn = $("#_dxn").val();

                        DisplaySuccessInfo(res.userMess, "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&dxn=" + dxn);
                    } //'Member transfer request details saved.'
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }

        $(document).on('click', '#btnSendCurr_CLGTransf_CancelReq', function (e) {
            e.preventDefault();

            SendCurr_CLGTransf_CancelReq();
        })

        var SendCurr_CLGTransf_CancelReq = function () {

            $('#_userRequestTask').val(4);
            var currFormData = $("#currForm_CLGTransf").serialize();

            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (res) {
                    // $("#divLoader").hide();
                    if (res.taskSuccess == true) {
                        // alert(res.userMess);
                        var currChuBodyId = $("#_RequestorChurchBodyId").val();
                        // var currId = $("#_hdnCurrId_CLGTransf").val();
                        var dxn = $("#_dxn").val();

                        DisplaySuccessInfo(res.userMess, "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&dxn=" + dxn);
                    }//'Member transfer request details saved.'
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }

        $(document).on('click', '#btnSendCurr_CLGTransf_ResubmitReq', function (e) {
            e.preventDefault();

            SendCurr_CLGTransf_ResubmitReq();
        })

        var SendCurr_CLGTransf_ResubmitReq = function () {

            $('#_userRequestTask').val(5);
            var currFormData = $("#currForm_CLGTransf").serialize();

            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                url: "/ChurchTransfer/AddOrEdit_CLGTransf",
                data: currFormData,   //{ data: currFormData, taskIndx: oTask },  //
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (res) {
                    // $("#divLoader").hide();
                    if (res.taskSuccess == true) {
                        // alert(res.userMess);
                        var currChuBodyId = $("#_RequestorChurchBodyId").val();
                        // var currId = $("#_hdnCurrId_CLGTransf").val();
                        var dxn = $("#_dxn").val();

                        DisplaySuccessInfo(res.userMess, "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&dxn=" + dxn);
                    }  // 'Member transfer request details saved.'
                    else {
                        alert(res.userMess); //"Member transfer request failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }


        var AcknowledgeCurrRequest = function (currChuBodyId, currId) {
            //$(document).on('click', '#AcknowledgeCurrRequest', function (e) {
            // e.preventDefault();

            //var currId = $("#_hdnCurrId_ChuTransf").val();
            // alert(1);
            //$("#divLoader").show();

            // var currFormData = $("#currForm_ChuTransf").serialize(); // + "&churchLogoFile="+currFile;
            // var formdata = new FormData($("#currForm").get(0));

            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                //contentType: false,
                url: "/ChurchTransfer/AcknowledgeTransferRequest",
                data: { oCurrChuBodyId: currChuBodyId, oChurchTransferId: currId }, //currFormData,
                success: function (res) {
                    //alert("saved upd: " + res);

                    $("#divLoader").hide();
                    if (res == true) {
                        alert("Transfer request acknowledged. If it requires Approval, follow up on the Steps complete the transfer.");

                    }
                    else {
                        alert("Request acknowledgment failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }

        var CloseCurrRequest = function (currChuBodyId, currId) {
            //$(document).on('click', '#AcknowledgeCurrRequest', function (e) {
            // e.preventDefault();

            //var currId = $("#_hdnCurrId_ChuTransf").val();
            // alert(1);
            //$("#divLoader").show();

            // var currFormData = $("#currForm_ChuTransf").serialize(); // + "&churchLogoFile="+currFile;
            // var formdata = new FormData($("#currForm").get(0));

            $.ajax({
                type: 'POST',
                // data: formdata,
                // processData: false,
                //contentType: false,
                url: "/ChurchTransfer/CloseTransferRequest",
                data: { oCurrChuBodyId: currChuBodyId, oChurchTransferId: currId }, //currFormData,
                success: function (res) {
                    //alert("saved upd: " + res);

                    $("#divLoader").hide();
                    if (res == true) {
                        //alert("Transfer request acknowledged. If it requires Approval, follow up on the Steps complete the transfer.");
                        DisplaySuccessInfo();
                    }
                    else {
                        alert("Request acknowledgment failed. Details: " + ViewBag.UserMsg);
                    }
                }
            })
        }


        var ReloadCurrPage = function () {
            window.location.reload();
        }

        var ReloadCurrPage_ChuTransf = function (currId_CB, strTransType = "MT") {
            window.location.href = '/ChurchTransfer/Index?oCurrChuBodyId=' + currId_CB + '&strTransType=' + strTransType;
        }


        var ConfirmDeleteCurr_ChuTransf = function (currChuBodyId, currId) {
            $("#hdnCurrId_CT").val(currId);
            $("#_hdnChuBodyId").val(currChuBodyId);
            $("#divPopModal_Del").modal('show');
        };

        var ConfirmTaskCurr_ChuTransf = function (currTask) {
            //$("#hdnCurrId_CT").val(currId);
            //$("#_hdnChuBodyId").val(currChuBodyId);
            alert('confirm... ' + currtTask);

            $('#_userRequestTask').val(currTask);
            $("#divPopModal_Confirm").modal('show');
        };

        //var _DisplaySuccessInfo = function () {

        //    $("#divPopModal_Success").modal('show');
        //};


        //var DisplaySuccessInfo = function (msg, reloadUrl) {

        //    $("#lblUserMessage").text(msg);
        //    $("#_urlSuccessOK").val(reloadUrl);

        //    $("#divPopModal_Success").modal('show');
        //    //window.location.href = "/ChurchTransfer/Index?oCurrChuBodyId=" + currChuBodyId + "&id=" + currId;

        //};

        //$(document).on('click', '#_btnSuccessOK', function (e) {
        //    e.preventDefault();

        //    var url = $("#_urlSuccessOK").val();
        //    if (url != null && url != '') {
        //        window.location.href = url;
        //    }
        //})


        var DeleteCurr = function () {
            $("#divPopModal_Del .close").click();
            $("#divLoader").show();

            var currId = $("#hdnCurrId_CT").val();
            var currId_CB = $("#_hdnChuBodyId").val();

            $.ajax({
                type: "POST",
                url: '/ChurchTransfer/Delete_ChuTransf?oCurrChuBodyId=' + currId_CB + '&id=' + currId,
                success: function (res) {
                    $("#divLoader").hide();
                    if (res == true) {
                        alert('Church transfer request deleted successfully.');
                        // DisplaySuccessInfo();

                        //  ReloadCurrPage_ChuTransf(currId_CB);
                        // window.location.href = '/ChurchTransfer/Index_ChuTransf?oCurrChuBodyId=' + currId_CB;
                    }
                    else {
                        alert('Church transfer request failed to delete. Details:' + ViewBag.UserDelMsg);
                    }
                },

                error: function () {
                    alert('Delete failed. Err: ' + ViewBag.UserDelMsg);
                }
            })
        }


    </script>



    <!-- utilities fxn -->
    <script>
          $(document).on('click', '#_btnPickMembersDirect_MT', function (e) {
                e.preventDefault();

            var _oAppGloOwnId = $("#_AppGlobalOwnerId").val();
            if (_oAppGloOwnId == null) _oAppGloOwnId = $("#_oAppGloOwnId_Logged").data("value");


              var currCBId = $("#_numFromChurchBodyId_par_MT").val();

            //    public JsonResult GetMemberListByCB(int? oAGOid, int? oCBid, bool addEmpty = false)
            var url = '@Url.Content("~/")' + 'ChurchTransfer/GetMemberListByCB';

             //var tempRegId = $('#_RegionId_MT').val();
             //alert('tempRegId: ' + tempRegId)
             //alert('hdnTempRegId: ' + hdnTempRegId)

            var hdn_RelaMemberId_MT = $('#_hdnChurchMemberId_MT').val();

            $('#_ChurchMemberId_MT').empty();
             //public JsonResult GetCountryRegionsByCountry(string ctryId, int? defCtryRegid = null, bool addEmpty = false)
            $.getJSON(url, { oAGOid: _oAppGloOwnId, oCBid: currCBId, addEmpty: true }, function (data) {
                    if (Object.keys(data).length > 0)
                    {
                        var items = '';
                        $.each(data, function (i, currItem) {
                            items += "<option value='" + currItem.value + "'>" + currItem.text + "</option>";   // alert(items);
                        });
                       // items += "<option value=''> Select </option>";
                        $('#_ChurchMemberId_MT').html(items);
                        $('#_ChurchMemberId_MT').val(hdn_RelaMemberId_MT);
                    }
                });

         });


        var calcMemAge = function (dob) {
            var strAge = '';
            if (dob != null) {
                var dt = dob.value;
                //alert("dob: " + dt);
                strAge = calcMemDateDiff(dt, new Date());
            }

            // alert('age: ' + strAge);
            $("#_strMemberAge").val(strAge);
        }

        var calcMemAgeByVal = function (dob) {
            var strAge = '';
            if (dob != null) {
                var dt = dob;
              //  alert("dob: " + dt);
                strAge = calcMemDateDiff(dt, new Date());
            }

            // alert('age: ' + strAge);
            $("#_strMemberAge").val(strAge);
        }

        var calcMemLongevity = function (dt_enroll) {
            var strLong = '';
            if (dt_enroll != null) {
                var dt = dt_enroll.value;
                // alert("dt_enroll: " + dt);
                strLong = calcMemDateDiff(dt, new Date());
            }
            // alert('long: ' + strLong);
            $("#_strLongevity").val(strLong);
        }


        var ___calcMemDateDiff = function (dt1, dt2) {

            if (dt2 < dt1)
                if (castToString)
                    return "N/A";
                else
                    return 0;


            // var dt = dt1.value;
            //    alert("dt conv: " + dt1);
            //var mdate = $("#birth_date").val().toString();
            var mdate = dt1.toString();
            var yearThen = parseInt(mdate.substring(0, 4), 10);
            var monthThen = parseInt(mdate.substring(5, 7), 10);
            var dayThen = parseInt(mdate.substring(8, 10), 10);

            //var dt2 = new Date();
            var birthday = new Date(yearThen, monthThen, dayThen);

            var differenceInMilisecond = dt2.valueOf() - birthday.valueOf();

            var year_age = Math.floor(differenceInMilisecond / 31536000000);
            //  var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

            //if ((today.getMonth() == birthday.getMonth()) && (today.getDate() == birthday.getDate())) {
            //    alert("Happy B'day!!!");
            //}
            var strDiff = '';
            if (year_age >= 0) {
                //var month_age = Math.floor(day_age / 30);

                //day_age = day_age % 30;

                if (isNaN(year_age)) { // || isNaN(month_age) || isNaN(day_age)) {
                    strDiff = 'N/A';

                    // $("#_strMemberAge").text("Invalid birthday - Please try again!");
                }
                else {
                    strDiff = year_age + ' yrs';

                    //$("#exact_age").html("You are<br/><span id=\"age\">" + year_age + " years " + month_age + " months " + day_age + " days</span> old");
                }
            }

            return strDiff;

            // alert('age: ' + strAge);
            //$("#_strMemberAge").val(strAge);
        }


        var calcMemDateDiff = function (dt1, dt2) {
            // var dt = dt1.value;
         //    alert("dt conv: " + dt1);
            //var mdate = $("#birth_date").val().toString();
            var mdate = dt1.toString();
            var yearThen = parseInt(mdate.substring(0, 4), 10);
            var monthThen = parseInt(mdate.substring(5, 7), 10);
            var dayThen = parseInt(mdate.substring(8, 10), 10);

            //var dt2 = new Date();
            var birthday = new Date(yearThen, monthThen - 1, dayThen);

            var differenceInMilisecond = dt2.valueOf() - birthday.valueOf();

            var year_age = Math.floor(differenceInMilisecond / 31536000000);
            //  var day_age = Math.floor((differenceInMilisecond % 31536000000) / 86400000);

            //if ((today.getMonth() == birthday.getMonth()) && (today.getDate() == birthday.getDate())) {
            //    alert("Happy B'day!!!");
            //}
            var strDiff = '';
            if (year_age >= 0) {
                //var month_age = Math.floor(day_age / 30);

                //day_age = day_age % 30;

                if (isNaN(year_age)) { // || isNaN(month_age) || isNaN(day_age)) {
                    strDiff = 'N/A';

                    // $("#_strMemberAge").text("Invalid birthday - Please try again!");
                }
                else {
                    strDiff = year_age + ' years';

                    //$("#exact_age").html("You are<br/><span id=\"age\">" + year_age + " years " + month_age + " months " + day_age + " days</span> old");
                }
            }

            return strDiff;

            // alert('age: ' + strAge);
            //$("#_strMemberAge").val(strAge);
        }



    </script>


    <!-- CB Browser -->
    <script>
        ////// invoke this piece to browse for CB...
        ///

         $(document).on('click', '#btnOK_ImpCB', function (e) {
            e.preventDefault();

            //  alert('clicked... ')

            $('#_divAlertUser').prop('hidden', 'hidden');


            var _resId = $('#_oTargetCBId_TCB').val();
            // alert('_resId: ' + _resId);
            if (_resId == null || _resId == '') {

                var res = document.getElementById('_lblTargetCB_TCB').innerHTML;
                DisplayErrorInfo("Please select the " + res.toLowerCase() + " to insert.");

                return false;
            }

            //  alert('... inserting')  ... CB
            if ($("#_strName_TCB").val() != null) {
                var _strCB = document.getElementById('_strTargetCB_TCB').innerHTML;   // value to insert
                if (_strCB == null || _strCB == '') _strCB = 'None. (choose congregation)';
                ///
                var _strName = "#" + $("#_strName_TCB").val();  // target field to insert
                $(_strName).prop("disabled", false);
                $(_strName).val(_strCB);
                $(_strName).prop("disabled", true)
            }

            if ($("#_strId_TCB").val() != null) {
                var _numCBId = $('#_oTargetCBId_TCB').val(); // value to insert
                ///
                var _strId = "#" + $("#_strId_TCB").val();  // target field to insert
                $(_strId).val(_numCBId);
            }

            //  alert('... inserting')  ... CL    "Church Body (" + Model.strTargetCL + ")";
            if ($("#_strCLName_TCB").val() != '') {
                var _strTag = 'Church Body';
                if ($("#_strCLTag_TCB").val() != '')
                    _strTag = $("#_strCLTag_TCB").val();
                var _strCL = _strTag;  // "Church Body";
                if ($('#_oTargetCLId_TCB').val() != '') {
                    _strCL = document.getElementById("_oTargetCLId_TCB").options[document.getElementById('_oTargetCLId_TCB').selectedIndex].text;
                    _strCL = _strTag + " (" + _strCL + ")"; // value to insert
                }
                ///
                var _strCLName = "#" + $("#_strCLName_TCB").val();  // target field to insert
                $(_strCLName).prop("disabled", false);
                $(_strCLName).val(_strCL);
                $(_strCLName).prop("disabled", true)
            }

            if ($("#_strCLId_TCB").val() != '') {
                var _numCLId = $('#_oTargetCLId_TCB').val();  // value to insert
                ///
                var _strCLId = "#" + $("#_strCLId_TCB").val();  // target field to insert
                $(_strCLId).val(_numCLId);
            }


             $('#_divAlertUser').prop('hidden', false);

         })

         $(document).on('click', '#_btnLoadTargetCLId_TCB', function (e) {
                e.preventDefault();

            //    alert('reload clicked... ')
            $('#_divAlertUser').prop('hidden', 'hidden');

                triggerChurchLevel_TCB();
               // document.getElementById("_btnLoadTargetCLId_TCB").click();
            })

         var ImportTargetCB = function (_oAppGloOwnId, _oChurchBodyId, _strId_TCB, _strName_TCB, _strCLId_TCB, _strCLName_TCB, _strCLTag_TCB = "Church Body") {

          // alert('importing...');
           // alert('addORedit.. ' + currId + ' ..currDenomId: ' + currDenomId + ' ..currChurchBodyId: ' + currChurchBodyId + ' .._strItemName: ' + _strItemName);

            //alert('currDenomId... ' + currDenomId)
            //alert('currChurchBodyId... ' + currChurchBodyId)

            //var currAGOId_Logged = $("#_oAppGloOwnId_Logged").data("value");   // _hdnAppGlobalOwnerId
            //var currCBId_Logged = $("#_oChurchBodyId_Logged").data("value");

             if (_oAppGloOwnId == null) _oAppGloOwnId = $("#_AppGlobalOwnerId").val();
             if (_oAppGloOwnId == null) _oAppGloOwnId = $("#_oAppGloOwnId_Logged").data("value");  //

             if (_oChurchBodyId == null) _oChurchBodyId = $("#_ChurchBodyId").val();
             if (_oChurchBodyId == null) _oChurchBodyId = $("#_oChurchBodyId_Logged").data("value");

            //var currUserId_Logged = $("#_oUserId_Logged").data("value");
            //
            var strId = "#" + _strId_TCB;
             var _currTargetCBId = $(strId).val();

             //var strCLId = "#" + _strCLId_TCB;
             //var _currTargetCLId = $(strCLId).val();

           //alert('strId: ' + strId)
           //alert('_oAppGloOwnId: ' + _oAppGloOwnId)
           //alert('_oChurchBodyId: ' + _oChurchBodyId)
           //alert('currTargetCBId: ' + _currTargetCBId)
           //alert('_strCLTag_TCB: ' + _strCLTag_TCB)
          // alert('_strCLId_TCB: ' + _strCLId_TCB)

            if (_oAppGloOwnId < 0) _oAppGloOwnId = null;
            if (_oChurchBodyId < 0) _oChurchBodyId = null;
            if (_currTargetCBId < 0) _currTargetCBId = null;
           //  if (_currTargetCLId < 0) _currTargetCLId = null;

           // public IActionResult GetTargetCB(int ? oAppGloOwnId = null, int ? oChurchBodyId = null, int ? oTargetCBId = null,
             //   string strId_TCB = "", string strName_TCB = "", string strCLId_TCB = "", string strCLName_TCB = "", string strCLTag_TCB = "Church Body")

             var url = "@Url.Action("GetTargetCB", "ChurchTransfer")?oAppGloOwnId=" + _oAppGloOwnId + "&oChurchBodyId=" + _oChurchBodyId + "&oTargetCBId=" + _currTargetCBId +  // "&oTargetCLId=" + _currTargetCLId +
                "&strId_TCB=" + _strId_TCB + "&strName_TCB=" + _strName_TCB + "&strCLId_TCB=" + _strCLId_TCB + "&strCLName_TCB=" + _strCLName_TCB + "&strCLTag_TCB=" + _strCLTag_TCB;

       //alert(url)

            // if (currId > 0) { document.querySelector('#btnSaveChanges').innerHTML = 'Update'; }
          //  if (currId > 0) { $('#btnSaveChanges').html('Update'); }

                      //  alert(url)

            //$('#divPopModal_AddEdit').modal({
            //                backdrop: 'static',
            //                keyboard: false
            //            });

                        //$('#divPopModal_AddEdit').modal({
                        //    backdrop: false,
                        //    show: true
                        //});

            $('#divPopModal_ImpCB .modal-dialog').draggable({
                            handle: ".modal-header"
                        });

                        //alert('loading modal...')
                        //$("#_setIndex").val(setIndex);
                        //$('#divModalBody_AddEdit').load(url, function () {

         var _strTitle = 'Browse Congregation (or Head-unit)';

            $('#divPopModal_ImpCB .modal-body').load(url, function () {
                $('#divPopModal_ImpCB .modal-title').html(_strTitle);

               ///
              //  $('#_oTargetCLId_TCB').val(_currTargetCLId);

                triggerChurchLevel_TCB();


                //$('#_strTargetCB_TCB').change();
               //triggerParentUnitCL_CU();
               //triggerChurchLevel_sup_CU();
               //$('#_OrgType_CU').change();

             $("#divPopModal_ImpCB").modal('show');
           });

        };


         $(document).on('change', '#_ChurchBodyId_10_TCB', function (e) {
            e.preventDefault();

            // alert(' CB10 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 10) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_10_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_10_TCB").options[document.getElementById('_ChurchBodyId_10_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_10_TCB').val());
                return false;
            }

           @*//  alert('_ChurchBodyId_10_TCB: ' + $("#_ChurchBodyId_10_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_10_TCB").val();

             var hdn_ChurchBodyId_11 = $('#_ChurchBodyId_11').val();
           //  var hdn_ChurchBodyId_11 = $('#hdn_ChurchBodyId_11').val();
           //  alert('10. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_11').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_11').html(items);
                   // alert('hdn11: ' + hdn_ChurchBodyId_11)
                    $('#_ChurchBodyId_11').val(hdn_ChurchBodyId_11);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 10) {
                        $('#_ChurchBodyId_10_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_10_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_10_TCB").options[document.getElementById('_ChurchBodyId_10_TCB').selectedIndex].text;
                        }

                     //   alert('str assem: ' + str1)
                      //  alert('str assem id: ' + $('#_ChurchBodyId_10_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'choose congregation';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_10_TCB').val());
                    }

                }
            });*@
        })

         $(document).on('change', '#_ChurchBodyId_9_TCB', function (e) {
            e.preventDefault();

            // alert(' CB9 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 9) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_9_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_9_TCB").options[document.getElementById('_ChurchBodyId_9_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_9_TCB').val());
                return false;
            }

           //  alert('_ChurchBodyId_9_TCB: ' + $("#_ChurchBodyId_9_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_9_TCB").val();

             //  var hdn_ChurchBodyId_10_TCB = $('#_ChurchBodyId_10_TCB').val();
           var hdn_ChurchBodyId_10_TCB = $('#hdn_ChurchBodyId_10_TCB').val();
           //  alert('9. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_10_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_10_TCB').html(items);
                   // alert('hdn10: ' + hdn_ChurchBodyId_10_TCB)
                    $('#_ChurchBodyId_10_TCB').val(hdn_ChurchBodyId_10_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 9) {
                        $('#_ChurchBodyId_9_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_9_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_9_TCB").options[document.getElementById('_ChurchBodyId_9_TCB').selectedIndex].text;
                        }

                     //   alert('str assem: ' + str1)
                      //  alert('str assem id: ' + $('#_ChurchBodyId_9_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_9_TCB').val());
                    }

                }
            });
        })

         $(document).on('change', '#_ChurchBodyId_8_TCB', function (e) {
            e.preventDefault();

            // alert(' CB8 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 8) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_8_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_8_TCB").options[document.getElementById('_ChurchBodyId_8_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_8_TCB').val());
                return false;
            }

           //  alert('_ChurchBodyId_8_TCB: ' + $("#_ChurchBodyId_8_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_8_TCB").val();

            //   var hdn_ChurchBodyId_9_TCB = $('#_ChurchBodyId_9_TCB').val();
           var hdn_ChurchBodyId_9_TCB = $('#hdn_ChurchBodyId_9_TCB').val();
           //  alert('8. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_9_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_9_TCB').html(items);
                   // alert('hdn9: ' + hdn_ChurchBodyId_9_TCB)
                    $('#_ChurchBodyId_9_TCB').val(hdn_ChurchBodyId_9_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 8) {
                        $('#_ChurchBodyId_8_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_8_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_8_TCB").options[document.getElementById('_ChurchBodyId_8_TCB').selectedIndex].text;
                        }

                     //   alert('str assem: ' + str1)
                      //  alert('str assem id: ' + $('#_ChurchBodyId_8_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_8_TCB').val());
                    }

                }
            });
        })

         $(document).on('change', '#_ChurchBodyId_7_TCB', function (e) {
            e.preventDefault();

            // alert(' CB7 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 7) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_7_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_7_TCB").options[document.getElementById('_ChurchBodyId_7_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_7_TCB').val());
                return false;
            }

           //  alert('_ChurchBodyId_7_TCB: ' + $("#_ChurchBodyId_7_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_7_TCB").val();

            //   var hdn_ChurchBodyId_8_TCB = $('#_ChurchBodyId_8_TCB').val();
           var hdn_ChurchBodyId_8_TCB = $('#hdn_ChurchBodyId_8_TCB').val();
           //  alert('7. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_8_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_8_TCB').html(items);
                   // alert('hdn8: ' + hdn_ChurchBodyId_8_TCB)
                    $('#_ChurchBodyId_8_TCB').val(hdn_ChurchBodyId_8_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 7) {
                        $('#_ChurchBodyId_7_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_7_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_7_TCB").options[document.getElementById('_ChurchBodyId_7_TCB').selectedIndex].text;
                        }

                     //   alert('str assem: ' + str1)
                      //  alert('str assem id: ' + $('#_ChurchBodyId_7_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_7_TCB').val());
                    }

                }
            });
        })

         $(document).on('change', '#_ChurchBodyId_6_TCB', function (e) {
            e.preventDefault();

            // alert(' CB6 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 6) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_6_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_6_TCB").options[document.getElementById('_ChurchBodyId_6_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_6_TCB').val());
                return false;
            }

           //  alert('_ChurchBodyId_6_TCB: ' + $("#_ChurchBodyId_6_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_6_TCB").val();

             // var hdn_ChurchBodyId_7_TCB = $('#_ChurchBodyId_7_TCB').val();
            var hdn_ChurchBodyId_7_TCB = $('#hdn_ChurchBodyId_7_TCB').val();
           //  alert('6. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_7_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_7_TCB').html(items);
                   // alert('hdn7: ' + hdn_ChurchBodyId_7_TCB)
                    $('#_ChurchBodyId_7_TCB').val(hdn_ChurchBodyId_7_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 6) {
                        $('#_ChurchBodyId_6_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_6_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_6_TCB").options[document.getElementById('_ChurchBodyId_6_TCB').selectedIndex].text;
                        }

                     //   alert('str assem: ' + str1)
                      //  alert('str assem id: ' + $('#_ChurchBodyId_6_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_6_TCB').val());
                    }

                }
            });
        })

         $(document).on('change', '#_ChurchBodyId_5_TCB', function (e) {
            e.preventDefault();

            // alert(' CB5 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 5) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_5_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_5_TCB").options[document.getElementById('_ChurchBodyId_5_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_5_TCB').val());
                return false;
            }

           //  alert('_ChurchBodyId_5_TCB: ' + $("#_ChurchBodyId_5_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_5_TCB").val();

            //    var hdn_ChurchBodyId_6_TCB = $('#_ChurchBodyId_6_TCB').val();
          var hdn_ChurchBodyId_6_TCB = $('#hdn_ChurchBodyId_6_TCB').val();
           //  alert('5. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_6_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_6_TCB').html(items);
                   // alert('hdn6: ' + hdn_ChurchBodyId_6_TCB)
                    $('#_ChurchBodyId_6_TCB').val(hdn_ChurchBodyId_6_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 5) {
                        $('#_ChurchBodyId_5_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_5_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_5_TCB").options[document.getElementById('_ChurchBodyId_5_TCB').selectedIndex].text;
                        }

                     //   alert('str assem: ' + str1)
                      //  alert('str assem id: ' + $('#_ChurchBodyId_5_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_5_TCB').val());
                    }

                }
            });
        })

         $(document).on('change', '#_ChurchBodyId_4_TCB', function (e) {
            e.preventDefault();

            // alert(' CB4 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('con oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 4) {  // Congregation
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_4_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_4_TCB").options[document.getElementById('_ChurchBodyId_4_TCB').selectedIndex].text;
                }
               // alert('str CON: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_4_TCB').val());
                return false;
            }

           //  alert('_ChurchBodyId_4_TCB: ' + $("#_ChurchBodyId_4_TCB").val())

             var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_4_TCB").val();

            //   var hdn_ChurchBodyId_5_TCB = $('#_ChurchBodyId_5_TCB').val();
           var hdn_ChurchBodyId_5_TCB = $('#hdn_ChurchBodyId_5_TCB').val();
           //  alert('4. parentCBId: ' + parentCBId);

             var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_5_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_5_TCB').html(items);
                   // alert('hdn5: ' + hdn_ChurchBodyId_5_TCB)
                    $('#_ChurchBodyId_5_TCB').val(hdn_ChurchBodyId_5_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 5) {
                        $('#_ChurchBodyId_5_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_5_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_5_TCB").options[document.getElementById('_ChurchBodyId_5_TCB').selectedIndex].text;
                        }

                       // alert('str assem: ' + str1)
                     //   alert('str assem id: ' + $('#_ChurchBodyId_5_TCB').val())
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_5_TCB').val());
                    }

                    //if ($("#_div_ChurchBodyId_6_TCB").is(":hidden") == false) {
                   // var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                   // if (oCBLevelCount > 4) {
                    //    $('#_ChurchBodyId_5_TCB').change();
                    //}
                }
            });


        })

         $(document).on('change', '#_ChurchBodyId_3_TCB', function (e) {
            e.preventDefault();

           //  alert(' CB3 triggered...')

              var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
           // alert('dis oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 3) {  // district
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_3_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_3_TCB").options[document.getElementById('_ChurchBodyId_3_TCB').selectedIndex].text;
                }
               // alert('str DIS: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_3_TCB').val());
                return false;
            }

            var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_3_TCB").val();

             //var hdn_ChurchBodyId_4_TCB = $('#_ChurchBodyId_4_TCB').val();
             var hdn_ChurchBodyId_4_TCB = $('#hdn_ChurchBodyId_4_TCB').val();
           //  alert('_ChurchBodyId_3_TCB: ' + $("#_ChurchBodyId_3_TCB").val())

            var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_4_TCB').empty();

             //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";   // <option selected disabled value=""> Select Church level </option>
                    $('#_ChurchBodyId_4_TCB').html(items);
                   // alert('hdn4: ' + hdn_ChurchBodyId_4_TCB)
                    $('#_ChurchBodyId_4_TCB').val(hdn_ChurchBodyId_4_TCB);

                  //  if ($("#_div_ChurchBodyId_5_TCB").is(":hidden") == false) {
                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 4) {
                        $('#_ChurchBodyId_4_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_4_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_4_TCB").options[document.getElementById('_ChurchBodyId_4_TCB').selectedIndex].text;
                        }
                        //  alert('str PRB: ' + str1)
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_4_TCB').val());
                    }
                }
            });

         })

         $(document).on('change', '#_ChurchBodyId_2_TCB', function (e) {
            e.preventDefault();
           // alert(' CB2 triggered...')


                var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
          //  alert('PRS. oCBLevelCount: ' + oCBLevelCount);
            if (oCBLevelCount == 2) {  // presbytery
                var str1 = "None. (choose congregation)";
                if ($('#_ChurchBodyId_2_TCB').val() != '') {
                    str1 = document.getElementById("_ChurchBodyId_2_TCB").options[document.getElementById('_ChurchBodyId_2_TCB').selectedIndex].text;
                }
              //  alert('str PRB: ' + str1)
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_2_TCB').val());
                return false;
            }

            var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
             var parentCBId = $("#_ChurchBodyId_2_TCB").val();

           //  var hdn_ChurchBodyId_3_TCB = $('#_ChurchBodyId_3_TCB').val();
             var hdn_ChurchBodyId_3_TCB = $('#hdn_ChurchBodyId_3_TCB').val();
          //   alert('_ChurchBodyId_2_TCB: ' + $("#_ChurchBodyId_3_TCB").val())

            var url = '@Url.Action("GetChurchBodyListByParentBody", "ChurchTransfer")';
            $('#_ChurchBodyId_3_TCB').empty();

            //  public JsonResult GetChurchBodyListByParentBody(int? oParentCBId, int? oAppGloOwnId, string strOrgType = null, bool addEmpty = false)
             $.getJSON(url, { oParentCBId: parentCBId, oAppGloOwnId: currDenomId, strOrgType: 'CH', addEmpty: true }, function (data) {
                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_3_TCB').html(items);

                   // alert('hdn3: ' + hdn_ChurchBodyId_3_TCB)
                    $('#_ChurchBodyId_3_TCB').val(hdn_ChurchBodyId_3_TCB);

                   // if ($("#_div_ChurchBodyId_4_TCB").is(":hidden") == false) {
                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 3) {
                        $('#_ChurchBodyId_3_TCB').change();
                    }
                    else {
                        if ($('#_ChurchBodyId_3_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_3_TCB").options[document.getElementById('_ChurchBodyId_3_TCB').selectedIndex].text;
                        }
                        //  alert('str PRB: ' + str1)
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_3_TCB').val());
                    }
                }
            });

        })

         $(document).on('change', '#_oTargetCLId_TCB', function (e) {
             e.preventDefault();

           // alert('CL ...')

             $('#_divAlertUser').prop('hidden', 'hidden');

            var str1 = document.getElementById("_oTargetCLId_TCB").options[document.getElementById('_oTargetCLId_TCB').selectedIndex].text;
             document.getElementById('_lblTargetCB_TCB').innerHTML = "Church Body (" + str1 + ")";
            //$('#_strChurchLevel').val(str1);

            // triggerChurchLevel_TCB();

             //
             var itemIndex = document.getElementById("_oTargetCLId_TCB").selectedIndex;
            // alert('itemIndex: ' + itemIndex)
             var limCount = $('#_numCLIndex_TCB').val();
            // alert('limCount: ' + limCount)
             var CHLevelIndex = limCount - itemIndex;  // + 1   ... 1 is highest levelIndex /db != selected Index
             $('#_oCBLevelCount_TCB').val(CHLevelIndex);

             //
           //  alert('CHLevelIndex: ' + CHLevelIndex)
             if (CHLevelIndex >= 0 && CHLevelIndex <= limCount) {
                $('#_div_ChurchBodyId_1_TCB').prop('hidden', !(CHLevelIndex >= 1));
                $('#_div_ChurchBodyId_2_TCB').prop('hidden', !(CHLevelIndex >= 2));
                $('#_div_ChurchBodyId_3_TCB').prop('hidden', !(CHLevelIndex >= 3));
                $('#_div_ChurchBodyId_4_TCB').prop('hidden', !(CHLevelIndex >= 4));
                $('#_div_ChurchBodyId_5_TCB').prop('hidden', !(CHLevelIndex >= 5));
                $('#_div_ChurchBodyId_6_TCB').prop('hidden', !(CHLevelIndex >= 6));
                $('#_div_ChurchBodyId_7_TCB').prop('hidden', !(CHLevelIndex >= 7));
                $('#_div_ChurchBodyId_8_TCB').prop('hidden', !(CHLevelIndex >= 8));
                $('#_div_ChurchBodyId_9_TCB').prop('hidden', !(CHLevelIndex >= 9));
                $('#_div_ChurchBodyId_10_TCB').prop('hidden', !(CHLevelIndex >= 10));

                ///
                 var numArbId = '_ChurchBodyId_' + CHLevelIndex + '_TCB';
                 var _strCBDisp = '';
                 if (CHLevelIndex == 1) {  // hq level... load into selected auto...
                  //   alert('strArbId: ' + strArbId)
                    // strArbId = '#_strChurchBody_' + CHLevelIndex + '_TCB';

                     $('#_strChurchBody_1_TCB').prop("disabled", false);
                     _strCBDisp = $('#_strChurchBody_1_TCB').val();
                     $('#_strChurchBody_1_TCB').prop("disabled", true)

                     //alert('_strCBDisp: ' + _strCBDisp)
                 }
                 else {
                     _strCBDisp = document.getElementById(numArbId).options[document.getElementById(numArbId).selectedIndex].text;
                 }

                // alert('numArbId: ' + numArbId) ...

              //  alert('str1: ' + str1)
                 if (_strCBDisp == null || _strCBDisp == '') _strCBDisp = 'None. (choose congregation)';
                 document.getElementById('_strTargetCB_TCB').innerHTML = _strCBDisp;

               //  alert('numArbId: ' + numArbId)   alert('val: ' + $(numArbId).val())
                $('#_oTargetCBId_TCB').val($('#' + numArbId).val());
             }

        })

         var triggerChurchLevel_TCB = function () {

         //    alert('CL triggered')
            //var numCBId = $('#_numParentUnitCBId').val();
            //var strCBName = $('#_strParentUnitCB').val();
            //$('#_numParentUnitCBId').val(numCBId);
            //$('#_strParentUnitCB').val(strCBName);

            var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
            var churchLevelId = $("#_oTargetCLId_TCB").val();

          // alert('_numParentUnitCLId: ' + churchLevelId);
        //  alert('currDenomId: ' + currDenomId);

             var url = '@Url.Action("GetChurchLevelIndexesByChurchLevel", "ChurchTransfer")';
            //  public JsonResult GetChurchLevelIndexByChurchLevel(int? oChurchLevelId, int? oAppGloOwnId, bool addEmpty = false)
            @*var url = '@Url.Action("GetChurchLevelIndexByChurchLevel", "ChurchTransfer")';*@

             //   $('#_ChurchBodyId_2_TCB').empty();

             //document.getElementById('_CountryId').value = '';

            //  public JsonResult GetChurchLevelIndexesByChurchLevel(int? oChurchLevelId, int? oAppGloOwnId, bool addEmpty = false)
            $.getJSON(url, { oChurchLevelId: churchLevelId, oAppGloOwnId: currDenomId }, function (res) {
                if (res != null) {  // alert(res.taskSuccess);  alert(res.strResId); alert(res.strRes);
                    // document.getElementById('_CountryId').value = res.strResId;    // return Json(new { taskSuccess = res, numResLev = _numResLev, strRes = _strRes });

                    var CHLevelIndex = 0;
                     if (res.numResLev != null) {
                         CHLevelIndex = res.numResLev; // - 1;
                        // $('#_numCLIndex_TCB').val(res.numResLev);
                         $('#_oCBLevelCount_TCB').val(CHLevelIndex);
                    }

                  //  alert('CHLevelIndex: ' + CHLevelIndex);
                    //
                    $('#_div_ChurchBodyId_1_TCB').prop('hidden', !(CHLevelIndex >= 1));
                    $('#_div_ChurchBodyId_2_TCB').prop('hidden', !(CHLevelIndex >= 2));
                    $('#_div_ChurchBodyId_3_TCB').prop('hidden', !(CHLevelIndex >= 3));
                    $('#_div_ChurchBodyId_4_TCB').prop('hidden', !(CHLevelIndex >= 4));
                    $('#_div_ChurchBodyId_5_TCB').prop('hidden', !(CHLevelIndex >= 5));
                    $('#_div_ChurchBodyId_6_TCB').prop('hidden', !(CHLevelIndex >= 6));
                    $('#_div_ChurchBodyId_7_TCB').prop('hidden', !(CHLevelIndex >= 7));
                    $('#_div_ChurchBodyId_8_TCB').prop('hidden', !(CHLevelIndex >= 8));
                    $('#_div_ChurchBodyId_9_TCB').prop('hidden', !(CHLevelIndex >= 9));
                    $('#_div_ChurchBodyId_10_TCB').prop('hidden', !(CHLevelIndex >= 10));

                    ///
                    //if ($("#_div_ChurchBodyId_2_TCB").is(":hidden") == false) {

                  //  alert('visible... trigger init')

                    initChurchBodyListLookUp();

                    //  $('#_CountryId').change();

                    // $('#_CountryId').trigger('change');
                    //}
                }
                else {
                  //  var numCHLevelIndex = $('#_numCLIndex_TCB').val();
                  //  alert('HQ...CL numCHLevelIndex: ' + numCHLevelIndex);
                    //var str1 = "None. (choose congregation)";
                   // if ($('#_ChurchBodyId_1_TCB').val() != '') {
                   //     str1 = document.getElementById("_ChurchBodyId_1_TCB").options[document.getElementById('_ChurchBodyId_1_TCB').selectedIndex].text;
                   // }
                   //// alert('str1: ' + str1)
                   // document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                   // $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_1_TCB').val());

                    var str1 = "None. (choose congregation)";
                    document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                    $('#_oTargetCBId_TCB').val(null);
                }
            });
        }

         var initChurchBodyListLookUp = function () {

            //var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
             var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
          //  alert('HQ. oCBLevelCount: ' + oCBLevelCount);

             if (oCBLevelCount == 1) {  // HQ
            //    var str1 = "None. (choose congregation)";
            //    if ($('#_ChurchBodyId_1_TCB').val() != '') {
            //        str1 = document.getElementById("_ChurchBodyId_1_TCB").options[document.getElementById('_ChurchBodyId_1_TCB').selectedIndex].text;
            //    }
            ////    alert('str1 HQ: ' + str1)
            //    document.getElementById('_strTargetCB_TCB').innerHTML = str1;
            //    $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_1_TCB').val());
            //    return false;

                //var str1 = "None. (choose congregation)";
                //if ($('#_strTargetCB_TCB_1').text() != '') {
                //    str1 = $('#_strChurchBody_1').text();
                //}

                $('#_strChurchBody_1_TCB').prop("disabled", false);
                var str1 = $('#_strChurchBody_1_TCB').val();
                $('#_strChurchBody_1_TCB').prop("disabled", true)

                // alert('str1 HQ: ' + str1)
                if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_1_TCB').val());

                return false;
            }

             var url = '@Url.Action("GetInitChurchBodyListByAppGloOwn", "ChurchTransfer")';

            var currDenomId = $("#_oAppGloOwnId_TCB").val();
           // var currDenomId = $("#_hdnAppGloOwnId").val();
           // var churchLevelId = $("#_numParentUnitCLId").val();

          //  var hdn_ChurchBodyId_2_TCB = $('#_ChurchBodyId_2_TCB').val();
            var hdn_ChurchBodyId_2_TCB = $('#hdn_ChurchBodyId_2_TCB').val();
           // var hdn_ChurchBodyId_2_TCB = $('#_ChurchBodyId_2_TCB').val();

           // alert('bf: ' + hdn_ChurchBodyId_2_TCB)
           // alert('bf hdn: ' + _hdn_ChurchBodyId_2_TCB)

            $('#_ChurchBodyId_2_TCB').empty();
            //   public JsonResult GetInitChurchBodyListByAppGloOwn(int? oAppGloOwnId, bool addEmpty = false)
            $.getJSON(url, { oAppGloOwnId: currDenomId, addEmpty: true }, function (data) {

                if (Object.keys(data).length > 0) {
                    var items = '';
                    $.each(data, function (i, oData) {
                        items += "<option value='" + oData.value + "'>" + oData.text + "</option>";   // alert(items);
                    });

                 //   alert ('clearing...')
                    // items += "<option value=''> Select </option>";
                    $('#_ChurchBodyId_2_TCB').html(items);

                   // alert('hdn2: ' + hdn_ChurchBodyId_2_TCB)
                    $('#_ChurchBodyId_2_TCB').val(hdn_ChurchBodyId_2_TCB);

                    var oCBLevelCount = $('#_oCBLevelCount_TCB').val();
                    if (oCBLevelCount > 2) {
                      //  alert('trig 2...')
                        $('#_ChurchBodyId_2_TCB').change();
                    }
                    else {
                        var str1 = "None. (choose congregation)";
                        if ($('#_ChurchBodyId_2_TCB').val() != '') {
                            str1 = document.getElementById("_ChurchBodyId_2_TCB").options[document.getElementById('_ChurchBodyId_2_TCB').selectedIndex].text;
                        }
                        //  alert('str PRB: ' + str1)
                        if (str1 == null || str1 == '') str1 = 'None. (choose congregation)';
                        document.getElementById('_strTargetCB_TCB').innerHTML = str1;
                        $('#_oTargetCBId_TCB').val($('#_ChurchBodyId_2_TCB').val());
                    }

                }
            });
        }

    </script>


    <!-- CM Browser -->
    <script>

         $(document).on('click', '#btnOK_ImpCB', function (e) {
            e.preventDefault();

            //  alert('clicked... ')

            $('#_divAlertUser').prop('hidden', 'hidden');


            var _resId = $('#_oTargetCBId_TCM').val();
            // alert('_resId: ' + _resId);
            if (_resId == null || _resId == '') {

                var res = document.getElementById('_lblTargetCB_TCM').innerHTML;
                DisplayErrorInfo("Please select the " + res.toLowerCase() + " to insert.");

                return false;
            }

            //  alert('... inserting')  ... CB
            if ($("#_strName_TCM").val() != null) {
                var _strCB = document.getElementById('_strTargetCB_TCM').innerHTML;   // value to insert
                if (_strCB == null || _strCB == '') _strCB = 'None. (choose congregation)';
                ///
                var _strName = "#" + $("#_strName_TCM").val();  // target field to insert
                $(_strName).prop("disabled", false);
                $(_strName).val(_strCB);
                $(_strName).prop("disabled", true)
            }

            if ($("#_strId_TCM").val() != null) {
                var _numCBId = $('#_oTargetCBId_TCM').val(); // value to insert
                ///
                var _strId = "#" + $("#_strId_TCM").val();  // target field to insert
                $(_strId).val(_numCBId);
            }

            //  alert('... inserting')  ... CL    "Church Body (" + Model.strTargetCL + ")";
            if ($("#_strCLName_TCM").val() != '') {
                var _strTag = 'Church Body';
                if ($("#_strCLTag_TCM").val() != '')
                    _strTag = $("#_strCLTag_TCM").val();
                var _strCL = _strTag;  // "Church Body";
                if ($('#_oTargetCLId_TCM').val() != '') {
                    _strCL = document.getElementById("_oTargetCLId_TCM").options[document.getElementById('_oTargetCLId_TCM').selectedIndex].text;
                    _strCL = _strTag + " (" + _strCL + ")"; // value to insert
                }
                ///
                var _strCLName = "#" + $("#_strCLName_TCM").val();  // target field to insert
                $(_strCLName).prop("disabled", false);
                $(_strCLName).val(_strCL);
                $(_strCLName).prop("disabled", true)
            }

            if ($("#_strCLId_TCM").val() != '') {
                var _numCLId = $('#_oTargetCLId_TCM').val();  // value to insert
                ///
                var _strCLId = "#" + $("#_strCLId_TCM").val();  // target field to insert
                $(_strCLId).val(_numCLId);
            }


             $('#_divAlertUser').prop('hidden', false);

         })

         $(document).on('click', '#_btnLoadTargetCLId_TCM', function (e) {
                e.preventDefault();

            //    alert('reload clicked... ')
            $('#_divAlertUser').prop('hidden', 'hidden');

                triggerChurchLevel_TCM();
               // document.getElementById("_btnLoadTargetCLId_TCM").click();
            })

         var ImportTargetCM = function (_oAppGloOwnId, _oChurchBodyId, _strId_TCM, _strName_TCM) {

          // alert('importing...');
           // alert('addORedit.. ' + currId + ' ..currDenomId: ' + currDenomId + ' ..currChurchBodyId: ' + currChurchBodyId + ' .._strItemName: ' + _strItemName);


             if (_oAppGloOwnId == null) _oAppGloOwnId = $("#_AppGlobalOwnerId").val();
             if (_oAppGloOwnId == null) _oAppGloOwnId = $("#_oAppGloOwnId_Logged").data("value");  //

             if (_oChurchBodyId == null) _oChurchBodyId = $("#_ChurchBodyId").val();
             if (_oChurchBodyId == null) _oChurchBodyId = $("#_oChurchBodyId_Logged").data("value");

            //var currUserId_Logged = $("#_oUserId_Logged").data("value");
            //
            var strId = "#" + _strId_TCM;
             var _currTargetCBId = $(strId).val();


            if (_oAppGloOwnId < 0) _oAppGloOwnId = null;
            if (_oChurchBodyId < 0) _oChurchBodyId = null;
            if (_currTargetCBId < 0) _currTargetCBId = null;
           //  if (_currTargetCLId < 0) _currTargetCLId = null;               

             var url = "@Url.Action("GetTargetCM", "ChurchTransfer")?oAppGloOwnId=" + _oAppGloOwnId + "&oChurchBodyId=" + _oChurchBodyId + "&oTargetCMId=" + _currTargetCBId +  // "&oTargetCLId=" + _currTargetCLId +
                        "&strId_TCM=" + _strId_TCM + "&strName_TCM=" + _strName_TCM ;

       //alert(url)

            // if (currId > 0) { document.querySelector('#btnSaveChanges').innerHTML = 'Update'; }
          //  if (currId > 0) { $('#btnSaveChanges').html('Update'); }

                      //  alert(url)

            //$('#divPopModal_AddEdit').modal({
            //                backdrop: 'static',
            //                keyboard: false
            //            });

                        //$('#divPopModal_AddEdit').modal({
                        //    backdrop: false,
                        //    show: true
                        //});

            $('#divPopModal_ImpCB .modal-dialog').draggable({
                            handle: ".modal-header"
                        });

                        //alert('loading modal...')
                        //$("#_setIndex").val(setIndex);
                        //$('#divModalBody_AddEdit').load(url, function () {

         var _strTitle = 'Browse Congregation (or Head-unit)';

            $('#divPopModal_ImpCB .modal-body').load(url, function () {
                $('#divPopModal_ImpCB .modal-title').html(_strTitle);

               ///
              //  $('#_oTargetCLId_TCM').val(_currTargetCLId);

                triggerChurchLevel_TCM();


                //$('#_strTargetCB_TCM').change();
               //triggerParentUnitCL_CU();
               //triggerChurchLevel_sup_CU();
               //$('#_OrgType_CU').change();

             $("#divPopModal_ImpCB").modal('show');
           });

        };


    </script>
}
